---
title: "系统架构设计师论文"
date: 2023-11-03T17:21:12+08:00
draft: true
---

## 大数据架构

长期以来，我国公共医疗资源严重失衡，医保机构与医疗机构之间立场和利益的不一致，所导致的医疗机构所进行的分解收费、超标准收费、重复收费、套用收费、不合理诊疗及其他违法违规行为的凸显，使得医疗医保费用过快增长，医保基金收支压力增大。2019 年国家医保局下发了《关于做好医疗保障基金监管工作的通知》要求各省、自治区、直辖市做好医疗保障基金监管工作。随后因为疫情原因，国家医保基金收支压力进一步增大，2020 年国务院办公厅下发了《关于推进医疗保障基金监管制度体系改革的指导意见》进一步要求各省、自治区、直辖市全面建立智能监控制度，加快推进医保标准化和信息化建设，使得医保大数据智能监管系统应运而生。

我所在的公司在中标某市医保大数据智能监管平台项目后，于 2021 年 6 月启动了该项目的建设工作，我被任命为该项目的架构设计师，负责系统的架构设计工作。该项目历时 14 个月，于 2022 年 8 月正式交付运行至今。为了实现监督检查的全覆盖，加强医疗保障基金监管，切实保障基金安全。该项目主要建设内容围绕三个方面：一、事前违规提醒：为医疗机构提供实时医保信息审核接口，对医疗机构所产生的违规行为进行实时的预警提醒，做到违规的早发现、早处理；二、事中审核管理：对医疗机构上报数据审核产生的初审结果，医疗机构应及时上报举证材料处理，由医保专家审核后按月下发终审结果；三、事后挖掘分析：对各个医疗机构的医保违规情况进行挖掘分析，为了医疗保障基金的飞行检查提供参考。考虑到需要对全市海量 PB 级的医疗信息数据进行处理，该项目的技术上整体采用大数据架构，主要分为：数据采集层、数据处理层、数据存储层、数据挖掘分析层、数据展现层和安全监控层。下面我将分层介绍下各层的设计与作用。

回应问题

数据采集层主要负责实时接收医疗信息数据流，并将其传输到后续处理阶段。对于门诊上报信息，直接传输到后续处理阶段进行患者医疗医保信息的质控，并实时返回质控结果给医疗机构。对于住院上报信息，则是放到 Kafka 队列中异步处理，Kafka 能够处理大量实时数据，提供持久性消息队列和容错性，适用于高吞吐量和低延迟的场景。本层还实现了上报数据的 Transform ，负责将上报数据标准化，以确保一致性和可处理性。因为监管规则会灵活新增，本层还支持对消息进行重放，以达到历史数据的批处理审核。

数据处理层负责接收、处理和分析来自数据采集层的海量数据流，识别违规行为，生成预警提醒。该层主要使用 Flink 和规则引擎实现，Flink 支持实时数据处理、复杂事件处理、状态管理等功能，适用于大规模数据流的处理和分析。识别医疗机构产生的实时数据中潜在的违规行为则通过规则引擎。规则引擎采用支持编译执行的表达式语言 MVEL 实现，保证规则灵活性和执行速度。实现了 MVEL 的 Microsoft Language Server Protocol 支持了该表达式语言的语法分析、自动完成和调试等功能，并采用在线编辑器 Monaco Editor 进行在线的规则维护，保证规则开发、修改、调试的效率。同时实现了规则的版本控制，每个规则提交时必须通过其单元测试校验，保证了规则的可靠性和可修改性。

数据存储层用于持久化患者医疗数据、处理结果数据、分析数据等。考虑到项目需要存储 PB 级别的数据，使用了分布式存储系统 Hadoop 来进行存储，以确保数据的高可用性和可靠性。同时还使用基于 Hadoop 的 Hive 实现来数据仓库，为数据挖掘分析提供数据支持。同时为了保证系统的效率，使用 Redis Sentinel 进行对实时热点数据进行了缓存，减少存储系统压力。数据挖掘分析层则对数据仓库中的数据进行分析，使用 NLP 将非结构化数据转换成结构化数据，同时调用数据处理层规则引擎进行挖掘。因为 NLP 技术不能保证百分百准确性，本层挖掘内容主要是返还给数据仓库，以通过后续 BI 模块进行数据分析。

数据展现层是用户和系统交互的窗口，需要保证一定的界面美观同时还要有良好的交互设计。用户界面层，经过项目组评审选择采用 Vue 作为主要框架，进行了前后端分离。Vue 作为当前主流的前端框架之一，支持组件化，十分轻量级，支持双向数据绑定，并且前端组成员对 Vue 比较熟悉学习成本较低。前端组件库采用 Element UI 作为基础组件库，其美观度很好并且主题适合该系统的业务，减少了基础组件的封装工作。安全和监控层则负责管理和监控整个系统，确保数据流畅、系统运行稳定。使用 Zabbix 保证系统的可用性，其具有全面的监控功能，包括主机和服务状态、性能监控、事件管理和报警功能。

经过了 14 个月的项目开发，该医保大数据智能监管平台已投入使用，协助客户对医疗机构的违规行为进行监管审查，运行至今反馈良好，并多次收到客户的表扬信。该系统由于保密性高、专业性高、技术实现难度高等原因，建设过程困难重重。项目初期由于对国家医保规则的理解不足，部分规则逻辑复杂程度高，使用表达式语言进行规则的实现，虽然保证了灵活性，但是其可读性、可修改性则与其实现者的专业水平高度相关。针对这一问题，我们实现了 MVEL 的 LSP，支持了该语言的语法分析、自动补全和调试等功能，同时引入规则的版本控制和强制的单元测试，在保证规则灵活性的同时，将可读性、可修改性也提升到较高的水平。还有当时设计数据挖掘分析模块时，AI 大模型还没有经过市场的验证，我想如果采用 AI 大模型使用海量数据进行训练后再进行数据挖掘分析，可以获取到更准确、更有价值的数据。这个项目通过设计上选用合适的架构风格，技术实现上践行标准解决方案，加上医保局各位医保专家老师在专业知识上的指导和各项目组成员的不懈努力，最终保证了项目的按时按量顺利交付。


## 结构化分析

2021 年 6 月我参与某市医疗保障信息智能监管平台项目，担任该项目的架构设计师，负责系统的架构设计工作。该项目主要为了加强医疗保障基金监管工作，实现监督检查的全覆盖。业务建设内容主要围绕三个方面：事前违规提醒、事中审核管理、事后挖掘分析。该项目技术上采用分层架构，医保规则通过规则引擎实现。本文以医疗保障信息智能监管平台项目为例，简述结构化分析在架构设计中的应用。功能模型用于完成需求的分析工作；行为模型描述系统行为状态的转变；数据模型抽象实体与它们之间的关系以及为关系模型创建提供参考；数据字典是统一的规范和标准。通过结构化分析，最终项目按时保质保量的顺利交付，并收到用户一致好评。

---

长期以来，我国公共医疗资源严重失衡，医保机构与医疗机构之间立场和利益的不一致，所导致的医疗机构进行的超标准收费、重复收费、套用收费、分解收费、不合理诊疗以及其他违法违规行为的凸显，使得医疗医保费用过快增长，医保基金收支压力增大。2019年国家医保局下发了《关于做好医疗保障基金监管工作的通知》要求各省、自治区、直辖市做好医疗保障基金监管工作。随后因为疫情的原因，国家医保基金收支压力进一步增大，2020年国务院办公厅下发了《关于推进医疗保障基金监管制度体系改革的指导意见》进一步要求各省、自治区、直辖市全面建设智能监控制度，加快推进医保标准化和信息化建设，使得医疗保障信息智能监管系统应运而生。

我所在的公司在中标某市医疗保障信息智能监管平台项目后，于 2021 年 6 月启动了该项目的建设工作，我被任命为该项目的架构设计师，负责系统的架构设计工作。该项目历史 8 个月，于 2022 年 2 月正式交付上线运行至今。为了实现监督检查的全覆盖，加强医疗保障基金监管，切实保障基金安全。该项目建设内容主要围绕三个方面：一、事前违规提醒：为医疗机构提供实时医保信息审核接口，对医疗机构所产生的违规行为进行实时的预警提醒，做到违规的早发现、早处理；二、事中审核管理：对医疗机构上报数据进行审核产生初审结果，医疗机构应及时上报举证材料处理，由医保专家审核后按月下发终审结果；三、事后挖掘分析：对各个医疗机构的医保违规数据进行挖掘分析，提供给 BI 模块展示，为医疗保障基金的飞行检查提供参考。该项目技术上采用分层架构，医保规则通过规则引擎实现。

结构化的设计是自顶向下、逐步分解、面向数据的。结构化的模型有功能模型、行为模型和数据模型。下面我分别介绍下三大模型及数据字典在本系统中的应用。

功能模型：主要是通过数据流图创建项目的功能模型，从而完成项目的需求分析工作。对于事前违规提醒业务，顶层数据流图有两大实体，分别是医疗机构和医保机构。医疗机构输出患者医疗信息数据流，输入患者医疗信息上报加工输出患者上报数据，输入到医保机构；医保机构输出上报数据，输入到规则审核质控加工输出患者违规结果，输入到医疗结构。展开医保机构部分，作为第二层数据流图，外部输入患者上报数据数据流到上报数据处理加工，输出患者基础信息、诊断信息、手术信息、费用信息等到患者信息数据存储，同时输出这些信息到规则审核质控加工。规则审核质控加工输出患者违规结果，到违规结果数据存储，同时输出到外部。

数据字典：数据字典是对数据流图中出现的元素加以定义说明，使得数据流图中的每个名词都有一个确切的解释。于数据流图配合，是所有人工作的依据和统一的标准，可以确保数据在系统中的完整性和一致性。比如上述提到的患者违规结果数据流条目，其数据字典相关字段有，名称：患者违规结果；说明：通过医疗机构上报的患者信息使用规则引擎质控出的违规结果；组成：违规结果=违规流水号、违规提示信息、违规金额、违规明细等；来源：规则审核质控加工；去处：医疗机构。对于规则审核质控加工有，名称：规则审核质控加工；激发条件：医疗机构上报数据；输入：上报的患者数据；输出：患者医保违规结果，以及加工的伪代码逻辑。

行为模型：主要是通过状态转换图创建系统的行为模型，从而描述系统行为状态的转换。对于事中的违规审核管理，违规结果有这么几种状态：初审待举证、放弃申诉、举证待审核、终审通过、终审不通过。上报的患者信息产生的违规结果的初始状态是初审待举证，医疗机构通过上传举证材料会使状态改变为举证待审核，医疗机构通过放弃举证会使状态变为放弃申诉。对于举证待审核的状态，医保机构的专家老师经过审核后，通过的状态变为终审通过，不通过的状态变为终审不通过。只有一次上报举证材料的机会，无退回的流程。

数据模型：主要是通过 E-R 图创建数据模型，一是为了从现实世界抽象出数据实体和它们之间的关系，而是数据规范化为关系模型的创建提供参考。首先是业务相关的实体有：患者基础信息、患者费用明细信息、患者结算信息、患者首页信息、患者诊断信息、患者手术信息等；在患者基础信息实体和其他实体之间的联系中，患者基础信息是1，其他实体是N。在患者结算信息和患者费用明细信息的联系中，患者结算信息实体是1，患者费用明细实体是N。然后是规则引擎相关的实体有：任务、规则、数据集、数据集元数据、数据集行数据、代码片段、代码片段提交记录等实体。其中任务和规则是1对N，规则和数据集是1对N，数据集和数据集元数据、行数据之间是1对N，代码片段和代码片段提交记录是1对N。同时代码片段和任务、规则、数据集之前是1对1。

经过了 8 个月的项目开发，该医疗保障信息智能监管平台已投入使用，协助客户对医疗机构医保违规行为进行监管审核，运行至今反馈良好，并多次收到客户的表扬信。该系统由于保密性高、专业性高、技术实现难度大等原因，建设过程困难重重。项目初期由于对国家医保规则的理解不足，和部分规则逻辑复杂度高的原因，使用规则引擎进行规则的实现虽然保证了规则的灵活性和可配置性。但是其可读性、可修改性则与其实现者的开发水平高度相关。针对这一问题，我们实现了规则引擎表达式语言的 Microsoft Language Server Protocol 支持了该表达式语言的语法分析、自动完成和调试功能，同时引入了规则的版本控制和强制的单元测试，在保证了灵活性的同时，将可读性、可修改性也提高到了较高的水平。这个项目通过设计上选用适合的架构风格，技术实现上践行标准的解决方案，加上医保局各位专家老师在专业领域的指导意见和项目组成员的不懈努力，最终保证了项目按时保质保量的顺利交付。
