

<!DOCTYPE html>
<html lang="zh-CN">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" /><title>Mybatis 的使用 - 向之礼的个人博客</title><meta name="Description" content="不能记住过去的人，被判重复过去。"><meta property="og:title" content="Mybatis 的使用" />
<meta property="og:description" content="简介 MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/mybatis/" /><meta property="og:image" content="https://og-image.dramacat.top/Mybatis 的使用?images=https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/mybatis-banner.1d2d148o1y1s.webp" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-04T11:29:00+08:00" />
<meta property="article:modified_time" content="2024-04-06T15:20:04+08:00" /><meta property="og:site_name" content="向之礼的个人博客" />

<meta name="twitter:title" content="Mybatis 的使用"/>
<meta name="twitter:card" content="summary_large_image"/><meta property="twitter:image" content="https://og-image.dramacat.top/Mybatis 的使用?images=https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/mybatis-banner.1d2d148o1y1s.webp" /><meta name="twitter:description" content="简介 MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。"/>
<meta name="application-name" content="Humble.X">
<meta name="apple-mobile-web-app-title" content="Humble.X">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><meta name="referrer" content="never"></meta>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest">

<link rel="canonical" href="http://localhost:1313/mybatis/" /><link rel="prev" href="http://localhost:1313/flutter/" /><link rel="next" href="http://localhost:1313/spring-initializr/" />
<link rel="stylesheet" href="/css/main.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">{"@context": "https://schema.org","@type": "BlogPosting",
        "headline": "Mybatis 的使用",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http://localhost:1313/mybatis/"
        },"image": ["https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/mybatis-banner.1d2d148o1y1s.webp"],"genre": "posts","keywords":["Backend FrameWork"],"wordcount":  50172 ,
        "url": "http://localhost:1313/mybatis/","datePublished": "2020-04-04T11:29:00+08:00","dateModified": "2024-04-06T15:20:04+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Humble.Xiang","logo": "http://localhost:1313/images/avatar.jpg"},"author": {
                "@type": "Person",
                "name": "Humble.Xiang",
                "url": "https://github.com/Humble-Xiang"
            },"description": ""
    }</script></head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {
          document.body.setAttribute('theme', theme); 
          document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');
          if (theme === 'light') {
            document.documentElement.classList.remove('tw-dark')
          } else {
            document.documentElement.classList.add('tw-dark')
          }
          window.theme = theme;   
          window.isDark = window.theme !== 'light' 
        }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop print:!tw-hidden" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="向之礼的个人博客"><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item"
                    href="/posts/" > 所有文章 </a><a class="menu-item"
                    href="/tags/" > 标签 </a><a class="menu-item"
                    href="/categories/" > 分类 </a><a class="menu-item"
                    href="/series/" > 系列 </a><a class="menu-item"
                    href="https://github.com/Humble-Xiang"  title="GitHub" 
                    rel="noopener noreferrer" target="_blank" ><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 496 512'><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d='M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z'/></svg>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                    <input type="text"
                        placeholder="搜索文章标题或内容..."
                        id="search-input-desktop">
                    <button class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
                    </button>
                    <button class="search-button search-clear" id="search-clear-desktop" title="清空">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>
                    </button>
                    <span class="search-button search-loading tw-animate-spin" id="search-loading-desktop">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"/></svg>
                    </span>
                </span><button class="menu-item theme-select" aria-label="切换主题">
                    <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
                    <select class="color-theme-select" id="theme-select-desktop" aria-label="切换主题">
                        <option value="light">浅色</option>
                        <option value="dark">深色</option>
                        <option value="black">黑色</option>
                        <option value="auto">跟随系统</option>
                    </select>
                </button></div>
        </div>
    </div>
</header><header class="mobile print:!tw-hidden" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="向之礼的个人博客"><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                <div class="search mobile" id="search-mobile">
                    <input type="text"
                        placeholder="搜索文章标题或内容..."
                        id="search-input-mobile">
                    <button class="search-button search-toggle tw-h-10" id="search-toggle-mobile" title="搜索">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
                    </button>
                    <button class="search-button search-clear" id="search-clear-mobile" title="清空">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>
                    </button>
                    <span class="search-button search-loading tw-animate-spin" id="search-loading-mobile">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"/></svg>
                    </span>
                </div>
                <button class="search-cancel" id="search-cancel-mobile">
                    取消
                </button>
            </div><a class="menu-item" href="/posts/" title="" >所有文章</a><a class="menu-item" href="/tags/" title="" >标签</a><a class="menu-item" href="/categories/" title="" >分类</a><a class="menu-item" href="/series/" title="" >系列</a><a class="menu-item" href="https://github.com/Humble-Xiang" title="GitHub" 
                rel="noopener noreferrer" target="_blank" ><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 496 512'><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d='M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z'/></svg></a><button class="menu-item theme-select tw-w-full" aria-label="切换主题">
                <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
                <select class="color-theme-select" id="theme-select-mobile" aria-label="切换主题">
                    <option value="light">浅色</option>
                    <option value="dark">深色</option>
                    <option value="black">黑色</option>
                    <option value="auto">跟随系统</option>
                </select>
            </button></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
            <div class="container"><div class="toc print:!tw-hidden" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#基础">基础</a>
      <ul>
        <li><a href="#入门">入门</a>
          <ul>
            <li><a href="#安装">安装</a></li>
            <li><a href="#从-xml-中构建-sqlsessionfactory">从 XML 中构建 SqlSessionFactory</a></li>
            <li><a href="#不使用-xml-构建-sqlsessionfactory">不使用 XML 构建 SqlSessionFactory</a></li>
            <li><a href="#从-sqlsessionfactory-中获取-sqlsession">从 SqlSessionFactory 中获取 SqlSession</a></li>
            <li><a href="#探究已映射的-sql-语句">探究已映射的 SQL 语句</a></li>
            <li><a href="#作用域scope和生命周期">作用域（Scope）和生命周期</a>
              <ul>
                <li><a href="#sqlsessionfactorybuilder">SqlSessionFactoryBuilder</a></li>
                <li><a href="#sqlsessionfactory">SqlSessionFactory</a></li>
                <li><a href="#sqlsession">SqlSession</a></li>
                <li><a href="#映射器实例">映射器实例</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#xml-配置">XML 配置</a>
          <ul>
            <li><a href="#属性properties">属性（properties）</a></li>
            <li><a href="#设置settings">设置（settings）</a></li>
            <li><a href="#类型别名typealiases">类型别名（typeAliases）</a></li>
            <li><a href="#类型处理器typehandlers">类型处理器（typeHandlers）</a></li>
            <li><a href="#处理枚举类型">处理枚举类型</a></li>
            <li><a href="#对象工厂objectfactory">对象工厂（objectFactory）</a></li>
            <li><a href="#插件plugins">插件（plugins）</a></li>
            <li><a href="#环境配置environments">环境配置（environments）</a></li>
            <li><a href="#数据库厂商标识databaseidprovider">数据库厂商标识（databaseIdProvider）</a></li>
            <li><a href="#映射器mappers">映射器（mappers）</a></li>
          </ul>
        </li>
        <li><a href="#xml-映射器">XML 映射器</a>
          <ul>
            <li><a href="#select">select</a></li>
            <li><a href="#insert-update-和-delete">insert, update 和 delete</a></li>
            <li><a href="#sql">sql</a></li>
            <li><a href="#参数">参数</a>
              <ul>
                <li><a href="#字符串替换">字符串替换</a></li>
              </ul>
            </li>
            <li><a href="#结果映射">结果映射</a>
              <ul>
                <li><a href="#高级结果映射">高级结果映射</a></li>
                <li><a href="#结果映射resultmap">结果映射（resultMap）</a></li>
                <li><a href="#id--result">id &amp; result</a></li>
                <li><a href="#支持的-jdbc-类型">支持的 JDBC 类型</a></li>
                <li><a href="#构造方法">构造方法</a></li>
                <li><a href="#关联">关联</a></li>
                <li><a href="#关联的嵌套-select-查询">关联的嵌套 Select 查询</a></li>
                <li><a href="#关联的嵌套结果映射">关联的嵌套结果映射</a></li>
                <li><a href="#关联的多结果集resultset">关联的多结果集（ResultSet）</a></li>
                <li><a href="#集合">集合</a></li>
                <li><a href="#集合的嵌套-select-查询">集合的嵌套 Select 查询</a></li>
                <li><a href="#集合的嵌套结果映射">集合的嵌套结果映射</a></li>
                <li><a href="#集合的多结果集resultset">集合的多结果集（ResultSet）</a></li>
                <li><a href="#鉴别器">鉴别器</a></li>
              </ul>
            </li>
            <li><a href="#自动映射">自动映射</a></li>
            <li><a href="#缓存">缓存</a>
              <ul>
                <li><a href="#使用自定义缓存">使用自定义缓存</a></li>
                <li><a href="#cache-ref">cache-ref</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#动态-sql">动态 SQL</a>
          <ul>
            <li><a href="#if">if</a></li>
            <li><a href="#choosewhenotherwise">choose、when、otherwise</a></li>
            <li><a href="#trimwhereset">trim、where、set</a></li>
            <li><a href="#foreach">foreach</a></li>
            <li><a href="#script">script</a></li>
            <li><a href="#bind">bind</a></li>
            <li><a href="#多数据库支持">多数据库支持</a></li>
            <li><a href="#动态-sql-中的插入脚本语言">动态 SQL 中的插入脚本语言</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#扩展">扩展</a>
      <ul>
        <li><a href="#mybatis-plus">MyBatis-Plus</a></li>
        <li><a href="#java-api">Java API</a>
          <ul>
            <li><a href="#目录结构">目录结构</a></li>
            <li><a href="#sqlsession-1">SqlSession</a>
              <ul>
                <li><a href="#sqlsessionfactorybuilder-1">SqlSessionFactoryBuilder</a></li>
                <li><a href="#sqlsessionfactory-1">SqlSessionFactory</a></li>
                <li><a href="#sqlsession-2">SqlSession</a>
                  <ul>
                    <li><a href="#语句执行方法">语句执行方法</a></li>
                    <li><a href="#立即批量更新方法">立即批量更新方法</a></li>
                    <li><a href="#事务控制方法">事务控制方法</a></li>
                    <li><a href="#本地缓存">本地缓存</a></li>
                    <li><a href="#确保-sqlsession-被关闭">确保 SqlSession 被关闭</a></li>
                    <li><a href="#使用映射器">使用映射器</a></li>
                    <li><a href="#映射器注解">映射器注解</a></li>
                    <li><a href="#映射注解示例">映射注解示例</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#sql-语句构建器">SQL 语句构建器</a>
          <ul>
            <li><a href="#问题">问题</a></li>
            <li><a href="#解决方案">解决方案</a></li>
            <li><a href="#sql-类">SQL 类</a></li>
          </ul>
        </li>
        <li><a href="#spring-整合-mybatis-时mybatis-的一级缓存为何失效">Spring 整合 Mybatis 时，Mybatis 的一级缓存为何“失效”?</a></li>
      </ul>
    </li>
    <li><a href="#应用场景">应用场景</a>
      <ul>
        <li><a href="#spring-boot-如何整合-mybatis">Spring Boot 如何整合 Mybatis?</a></li>
        <li><a href="#如何使用逆向工程">如何使用逆向工程？</a></li>
        <li><a href="#如何用-mybatis-实现一对多分页">如何用 MyBatis 实现一对多分页</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single print:!tw-w-full print:!tw-max-w-none print:!tw-m-0 print:!tw-p-0"><h1 class="single-title animate__animated animate__flipInX">Mybatis 的使用</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><img src="http://localhost:1313/images/avatar.jpg" alt="Humble.Xiang avatar" class="tw-inline-block tw-max-h-4 tw-rounded-full tw-translate-y-[-2px] tw-mr-1"><a href="https://github.com/Humble-Xiang" title="Author" target="_blank" rel="noopener noreferrer author" class="author">Humble.Xiang</a>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/development/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>Development</a></span></div>
            <div class="post-meta-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;<time datetime="2020-04-04">2020-04-04</time>&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg>&nbsp;<time datetime="2024-04-06">2024-04-06</time>&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;约 50172 字&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;预计阅读 101 分钟&nbsp;</div>
        </div><div class="featured-image"><img
        
        loading="eager"
        src="https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/mybatis-banner.1d2d148o1y1s.webp"
        srcset="https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/mybatis-banner.1d2d148o1y1s.webp, https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/mybatis-banner.1d2d148o1y1s.webp 1.5x, https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/mybatis-banner.1d2d148o1y1s.webp 2x"
        title="https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/mybatis-banner.1d2d148o1y1s.webp" ></div><div class="details toc print:!tw-block" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#基础">基础</a>
      <ul>
        <li><a href="#入门">入门</a>
          <ul>
            <li><a href="#安装">安装</a></li>
            <li><a href="#从-xml-中构建-sqlsessionfactory">从 XML 中构建 SqlSessionFactory</a></li>
            <li><a href="#不使用-xml-构建-sqlsessionfactory">不使用 XML 构建 SqlSessionFactory</a></li>
            <li><a href="#从-sqlsessionfactory-中获取-sqlsession">从 SqlSessionFactory 中获取 SqlSession</a></li>
            <li><a href="#探究已映射的-sql-语句">探究已映射的 SQL 语句</a></li>
            <li><a href="#作用域scope和生命周期">作用域（Scope）和生命周期</a>
              <ul>
                <li><a href="#sqlsessionfactorybuilder">SqlSessionFactoryBuilder</a></li>
                <li><a href="#sqlsessionfactory">SqlSessionFactory</a></li>
                <li><a href="#sqlsession">SqlSession</a></li>
                <li><a href="#映射器实例">映射器实例</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#xml-配置">XML 配置</a>
          <ul>
            <li><a href="#属性properties">属性（properties）</a></li>
            <li><a href="#设置settings">设置（settings）</a></li>
            <li><a href="#类型别名typealiases">类型别名（typeAliases）</a></li>
            <li><a href="#类型处理器typehandlers">类型处理器（typeHandlers）</a></li>
            <li><a href="#处理枚举类型">处理枚举类型</a></li>
            <li><a href="#对象工厂objectfactory">对象工厂（objectFactory）</a></li>
            <li><a href="#插件plugins">插件（plugins）</a></li>
            <li><a href="#环境配置environments">环境配置（environments）</a></li>
            <li><a href="#数据库厂商标识databaseidprovider">数据库厂商标识（databaseIdProvider）</a></li>
            <li><a href="#映射器mappers">映射器（mappers）</a></li>
          </ul>
        </li>
        <li><a href="#xml-映射器">XML 映射器</a>
          <ul>
            <li><a href="#select">select</a></li>
            <li><a href="#insert-update-和-delete">insert, update 和 delete</a></li>
            <li><a href="#sql">sql</a></li>
            <li><a href="#参数">参数</a>
              <ul>
                <li><a href="#字符串替换">字符串替换</a></li>
              </ul>
            </li>
            <li><a href="#结果映射">结果映射</a>
              <ul>
                <li><a href="#高级结果映射">高级结果映射</a></li>
                <li><a href="#结果映射resultmap">结果映射（resultMap）</a></li>
                <li><a href="#id--result">id &amp; result</a></li>
                <li><a href="#支持的-jdbc-类型">支持的 JDBC 类型</a></li>
                <li><a href="#构造方法">构造方法</a></li>
                <li><a href="#关联">关联</a></li>
                <li><a href="#关联的嵌套-select-查询">关联的嵌套 Select 查询</a></li>
                <li><a href="#关联的嵌套结果映射">关联的嵌套结果映射</a></li>
                <li><a href="#关联的多结果集resultset">关联的多结果集（ResultSet）</a></li>
                <li><a href="#集合">集合</a></li>
                <li><a href="#集合的嵌套-select-查询">集合的嵌套 Select 查询</a></li>
                <li><a href="#集合的嵌套结果映射">集合的嵌套结果映射</a></li>
                <li><a href="#集合的多结果集resultset">集合的多结果集（ResultSet）</a></li>
                <li><a href="#鉴别器">鉴别器</a></li>
              </ul>
            </li>
            <li><a href="#自动映射">自动映射</a></li>
            <li><a href="#缓存">缓存</a>
              <ul>
                <li><a href="#使用自定义缓存">使用自定义缓存</a></li>
                <li><a href="#cache-ref">cache-ref</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#动态-sql">动态 SQL</a>
          <ul>
            <li><a href="#if">if</a></li>
            <li><a href="#choosewhenotherwise">choose、when、otherwise</a></li>
            <li><a href="#trimwhereset">trim、where、set</a></li>
            <li><a href="#foreach">foreach</a></li>
            <li><a href="#script">script</a></li>
            <li><a href="#bind">bind</a></li>
            <li><a href="#多数据库支持">多数据库支持</a></li>
            <li><a href="#动态-sql-中的插入脚本语言">动态 SQL 中的插入脚本语言</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#扩展">扩展</a>
      <ul>
        <li><a href="#mybatis-plus">MyBatis-Plus</a></li>
        <li><a href="#java-api">Java API</a>
          <ul>
            <li><a href="#目录结构">目录结构</a></li>
            <li><a href="#sqlsession-1">SqlSession</a>
              <ul>
                <li><a href="#sqlsessionfactorybuilder-1">SqlSessionFactoryBuilder</a></li>
                <li><a href="#sqlsessionfactory-1">SqlSessionFactory</a></li>
                <li><a href="#sqlsession-2">SqlSession</a>
                  <ul>
                    <li><a href="#语句执行方法">语句执行方法</a></li>
                    <li><a href="#立即批量更新方法">立即批量更新方法</a></li>
                    <li><a href="#事务控制方法">事务控制方法</a></li>
                    <li><a href="#本地缓存">本地缓存</a></li>
                    <li><a href="#确保-sqlsession-被关闭">确保 SqlSession 被关闭</a></li>
                    <li><a href="#使用映射器">使用映射器</a></li>
                    <li><a href="#映射器注解">映射器注解</a></li>
                    <li><a href="#映射注解示例">映射注解示例</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#sql-语句构建器">SQL 语句构建器</a>
          <ul>
            <li><a href="#问题">问题</a></li>
            <li><a href="#解决方案">解决方案</a></li>
            <li><a href="#sql-类">SQL 类</a></li>
          </ul>
        </li>
        <li><a href="#spring-整合-mybatis-时mybatis-的一级缓存为何失效">Spring 整合 Mybatis 时，Mybatis 的一级缓存为何“失效”?</a></li>
      </ul>
    </li>
    <li><a href="#应用场景">应用场景</a>
      <ul>
        <li><a href="#spring-boot-如何整合-mybatis">Spring Boot 如何整合 Mybatis?</a></li>
        <li><a href="#如何使用逆向工程">如何使用逆向工程？</a></li>
        <li><a href="#如何用-mybatis-实现一对多分页">如何用 MyBatis 实现一对多分页</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="简介" class="headerLink">
    <a href="#%e7%ae%80%e4%bb%8b" class="header-mark"></a>简介</h2><blockquote>
<p><a href="https://mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noopener noreferrer">MyBatis</a> 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</p>
</blockquote>
<iframe
  class="website-card-embed"
  data-src="https://website-card-embed.dramacat.top/?url=https%3a%2f%2fmybatis.org%2fmybatis-3%2fzh%2findex.html"
  style="width: 100%; height: 124px"
  frameborder="no"
></iframe>
<p>优点：</p>
<ul>
<li>简单易学：本身就很小且简单。没有任何第三方依赖，最简单安装只要两个 jar 文件+配置几个 sql 映射文件易于学习，易于使用，通过文档和源代码，可以比较完全的掌握它的设计思路和实现。</li>
<li>灵活：mybatis 不会对应用程序或者数据库的现有设计强加任何影响。 sql 写在 xml 里，便于统一管理和优化。通过 sql 基本上可以实现我们不使用数据访问框架可以实现的所有功能，或许更多。</li>
<li>解除 sql 与程序代码的耦合：通过提供 DAL 层，将业务逻辑和数据访问逻辑分离，使系统的设计更清晰，更易维护，更易单元测试。sql 和代码的分离，提高了可维护性。</li>
<li>提供映射标签，支持对象与数据库的 orm 字段关系映射</li>
<li>提供对象关系映射标签，支持对象关系组建维护</li>
<li>提供 xml 标签，支持编写动态 sql。</li>
</ul>
<p>缺点：</p>
<ul>
<li>编写 SQL 语句时工作量很大，尤其是字段多、关联表多时，更是如此。</li>
<li>SQL 语句依赖于数据库，导致数据库移植性差，不能更换数据库。</li>
<li>框架还是比较简陋，功能尚有缺失，虽然简化了数据绑定代码，但是整个底层数据库查询实际还是要自己写的，工作量也比较大，而且不太容易适应快速数据库修改。</li>
<li>二级缓存机制不佳</li>
</ul>
<h2 id="基础" class="headerLink">
    <a href="#%e5%9f%ba%e7%a1%80" class="header-mark"></a>基础</h2><h3 id="入门" class="headerLink">
    <a href="#%e5%85%a5%e9%97%a8" class="header-mark"></a>入门</h3><h4 id="安装" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85" class="header-mark"></a>安装</h4><p>要使用 MyBatis， 只需将 <a href="https://github.com/mybatis/mybatis-3/releases" target="_blank" rel="noopener noreferrer">mybatis-x.x.x.jar</a> 文件置于类路径（classpath）中即可。</p>
<p>如果使用 Maven 来构建项目，则需将下面的依赖代码置于 pom.xml 文件中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;dependency&gt;
</span></span><span class="line"><span class="cl">  &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
</span></span><span class="line"><span class="cl">  &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
</span></span><span class="line"><span class="cl">  &lt;version&gt;x.x.x&lt;/version&gt;
</span></span><span class="line"><span class="cl">&lt;/dependency&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="从-xml-中构建-sqlsessionfactory" class="headerLink">
    <a href="#%e4%bb%8e-xml-%e4%b8%ad%e6%9e%84%e5%bb%ba-sqlsessionfactory" class="header-mark"></a>从 XML 中构建 SqlSessionFactory</h4><p>每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为核心的。SqlSessionFactory 的实例可以通过 SqlSessionFactoryBuilder 获得。而 SqlSessionFactoryBuilder 则可以从 XML 配置文件或一个预先配置的 Configuration 实例来构建出 SqlSessionFactory 实例。</p>
<p>从 XML 文件中构建 SqlSessionFactory 的实例非常简单，建议使用类路径下的资源文件进行配置。 但也可以使用任意的输入流（InputStream）实例，比如用文件路径字符串或 file:// URL 构造的输入流。MyBatis 包含一个名叫 Resources 的工具类，它包含一些实用方法，使得从类路径或其它位置加载资源文件更加容易。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">String resource = &#34;org/mybatis/example/mybatis-config.xml&#34;;
</span></span><span class="line"><span class="cl">InputStream inputStream = Resources.getResourceAsStream(resource);
</span></span><span class="line"><span class="cl">SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
</span></span></code></pre></td></tr></table>
</div>
</div><p>XML 配置文件中包含了对 MyBatis 系统的核心设置，包括获取数据库连接实例的数据源（DataSource）以及决定事务作用域和控制方式的事务管理器（TransactionManager）。后面会再探讨 XML 配置文件的详细内容，这里先给出一个简单的示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE configuration
</span></span><span class="line"><span class="cl">  PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span><span class="line"><span class="cl">  &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;configuration&gt;
</span></span><span class="line"><span class="cl">  &lt;environments default=&#34;development&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;environment id=&#34;development&#34;&gt;
</span></span><span class="line"><span class="cl">      &lt;transactionManager type=&#34;JDBC&#34;/&gt;
</span></span><span class="line"><span class="cl">      &lt;dataSource type=&#34;POOLED&#34;&gt;
</span></span><span class="line"><span class="cl">        &lt;property name=&#34;driver&#34; value=&#34;${driver}&#34;/&gt;
</span></span><span class="line"><span class="cl">        &lt;property name=&#34;url&#34; value=&#34;${url}&#34;/&gt;
</span></span><span class="line"><span class="cl">        &lt;property name=&#34;username&#34; value=&#34;${username}&#34;/&gt;
</span></span><span class="line"><span class="cl">        &lt;property name=&#34;password&#34; value=&#34;${password}&#34;/&gt;
</span></span><span class="line"><span class="cl">      &lt;/dataSource&gt;
</span></span><span class="line"><span class="cl">    &lt;/environment&gt;
</span></span><span class="line"><span class="cl">  &lt;/environments&gt;
</span></span><span class="line"><span class="cl">  &lt;mappers&gt;
</span></span><span class="line"><span class="cl">    &lt;mapper resource=&#34;org/mybatis/example/BlogMapper.xml&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;/mappers&gt;
</span></span><span class="line"><span class="cl">&lt;/configuration&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然，还有很多可以在 XML 文件中配置的选项，上面的示例仅罗列了最关键的部分。 注意 XML 头部的声明，它用来验证 XML 文档的正确性。environment 元素体中包含了事务管理和连接池的配置。mappers 元素则包含了一组映射器（mapper），这些映射器的 XML 映射文件包含了 SQL 代码和映射定义信息。</p>
<h4 id="不使用-xml-构建-sqlsessionfactory" class="headerLink">
    <a href="#%e4%b8%8d%e4%bd%bf%e7%94%a8-xml-%e6%9e%84%e5%bb%ba-sqlsessionfactory" class="header-mark"></a>不使用 XML 构建 SqlSessionFactory</h4><p>如果你更愿意直接从 Java 代码而不是 XML 文件中创建配置，或者想要创建你自己的配置构建器，MyBatis 也提供了完整的配置类，提供了所有与 XML 文件等价的配置项。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">DataSource dataSource = BlogDataSourceFactory.getBlogDataSource();
</span></span><span class="line"><span class="cl">TransactionFactory transactionFactory = new JdbcTransactionFactory();
</span></span><span class="line"><span class="cl">Environment environment = new Environment(&#34;development&#34;, transactionFactory, dataSource);
</span></span><span class="line"><span class="cl">Configuration configuration = new Configuration(environment);
</span></span><span class="line"><span class="cl">configuration.addMapper(BlogMapper.class);
</span></span><span class="line"><span class="cl">SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(configuration);
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意该例中，configuration 添加了一个映射器类（mapper class）。映射器类是 Java 类，它们包含 SQL 映射注解从而避免依赖 XML 映射文件。不过，由于 Java 注解的一些限制以及某些 MyBatis 映射的复杂性，要使用大多数高级映射（比如：嵌套联合映射），仍然需要使用 XML 映射文件进行映射。有鉴于此，如果存在一个同名 XML 映射文件，MyBatis 会自动查找并加载它（在这个例子中，基于类路径和 BlogMapper.class 的类名，会加载 BlogMapper.xml）。具体细节稍后讨论。</p>
<h4 id="从-sqlsessionfactory-中获取-sqlsession" class="headerLink">
    <a href="#%e4%bb%8e-sqlsessionfactory-%e4%b8%ad%e8%8e%b7%e5%8f%96-sqlsession" class="header-mark"></a>从 SqlSessionFactory 中获取 SqlSession</h4><p>既然有了 SqlSessionFactory，顾名思义，我们可以从中获得 SqlSession 的实例。SqlSession 提供了在数据库执行 SQL 命令所需的所有方法。你可以通过 SqlSession 实例来直接执行已映射的 SQL 语句。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">try (SqlSession session = sqlSessionFactory.openSession()) {
</span></span><span class="line"><span class="cl">  Blog blog = (Blog) session.selectOne(&#34;org.mybatis.example.BlogMapper.selectBlog&#34;, 101);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>诚然，这种方式能够正常工作，对使用旧版本 MyBatis 的用户来说也比较熟悉。但现在有了一种更简洁的方式——使用和指定语句的参数和返回值相匹配的接口（比如 BlogMapper.class），现在你的代码不仅更清晰，更加类型安全，还不用担心可能出错的字符串字面值以及强制类型转换。</p>
<p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">try (SqlSession session = sqlSessionFactory.openSession()) {
</span></span><span class="line"><span class="cl">  BlogMapper mapper = session.getMapper(BlogMapper.class);
</span></span><span class="line"><span class="cl">  Blog blog = mapper.selectBlog(101);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在我们来探究一下这段代码究竟做了些什么。</p>
<h4 id="探究已映射的-sql-语句" class="headerLink">
    <a href="#%e6%8e%a2%e7%a9%b6%e5%b7%b2%e6%98%a0%e5%b0%84%e7%9a%84-sql-%e8%af%ad%e5%8f%a5" class="header-mark"></a>探究已映射的 SQL 语句</h4><p>现在你可能很想知道 SqlSession 和 Mapper 到底具体执行了些什么操作，但 SQL 语句映射是个相当广泛的话题，可能会占去文档的大部分篇幅。 但为了让你能够了解个大概，这里先给出几个例子。</p>
<p>在上面提到的例子中，一个语句既可以通过 XML 定义，也可以通过注解定义。我们先看看 XML 定义语句的方式，事实上 MyBatis 提供的所有特性都可以利用基于 XML 的映射语言来实现，这使得 MyBatis 在过去的数年间得以流行。如果你用过旧版本的 MyBatis，你应该对这个概念比较熟悉。 但相比于之前的版本，新版本改进了许多 XML 的配置，后面我们会提到这些改进。这里给出一个基于 XML 映射语句的示例，它应该可以满足上个示例中 SqlSession 的调用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE mapper
</span></span><span class="line"><span class="cl">  PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span><span class="line"><span class="cl">  &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;mapper namespace=&#34;org.mybatis.example.BlogMapper&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;select id=&#34;selectBlog&#34; resultType=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">    select * from Blog where id = #{id}
</span></span><span class="line"><span class="cl">  &lt;/select&gt;
</span></span><span class="line"><span class="cl">&lt;/mapper&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>为了这个简单的例子，我们似乎写了不少配置，但其实并不多。在一个 XML 映射文件中，可以定义无数个映射语句，这样一来，XML 头部和文档类型声明部分就显得微不足道了。文档的其它部分很直白，容易理解。 它在命名空间 “org.mybatis.example.BlogMapper” 中定义了一个名为 “selectBlog” 的映射语句，这样你就可以用全限定名 “org.mybatis.example.BlogMapper.selectBlog” 来调用映射语句了，就像上面例子中那样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Blog blog = (Blog) session.selectOne(&#34;org.mybatis.example.BlogMapper.selectBlog&#34;, 101);
</span></span></code></pre></td></tr></table>
</div>
</div><p>你可能会注意到，这种方式和用全限定名调用 Java 对象的方法类似。这样，该命名就可以直接映射到在命名空间中同名的映射器类，并将已映射的 select 语句匹配到对应名称、参数和返回类型的方法。因此你就可以像上面那样，不费吹灰之力地在对应的映射器接口调用方法，就像下面这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">BlogMapper mapper = session.getMapper(BlogMapper.class);
</span></span><span class="line"><span class="cl">Blog blog = mapper.selectBlog(101);
</span></span></code></pre></td></tr></table>
</div>
</div><p>第二种方法有很多优势，首先它不依赖于字符串字面值，会更安全一点；其次，如果你的 IDE 有代码补全功能，那么代码补全可以帮你快速选择到映射好的 SQL 语句。</p>
<hr>
<p><strong>提示</strong> <strong>对命名空间的一点补充</strong></p>
<p>在之前版本的 MyBatis 中，**命名空间（Namespaces）**的作用并不大，是可选的。 但现在，随着命名空间越发重要，你必须指定命名空间。</p>
<p>命名空间的作用有两个，一个是利用更长的全限定名来将不同的语句隔离开来，同时也实现了你上面见到的接口绑定。就算你觉得暂时用不到接口绑定，你也应该遵循这里的规定，以防哪天你改变了主意。 长远来看，只要将命名空间置于合适的 Java 包命名空间之中，你的代码会变得更加整洁，也有利于你更方便地使用 MyBatis。</p>
<p>**命名解析：**为了减少输入量，MyBatis 对所有具有名称的配置元素（包括语句，结果映射，缓存等）使用了如下的命名解析规则。</p>
<ul>
<li>全限定名（比如 “com.mypackage.MyMapper.selectAllThings）将被直接用于查找及使用。</li>
<li>短名称（比如 “selectAllThings”）如果全局唯一也可以作为一个单独的引用。 如果不唯一，有两个或两个以上的相同名称（比如 “com.foo.selectAllThings” 和 “com.bar.selectAllThings”），那么使用时就会产生“短名称不唯一”的错误，这种情况下就必须使用全限定名。</li>
</ul>
<hr>
<p>对于像 BlogMapper 这样的映射器类来说，还有另一种方法来完成语句映射。 它们映射的语句可以不用 XML 来配置，而可以使用 Java 注解来配置。比如，上面的 XML 示例可以被替换成如下的配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">org</span><span class="p">.</span><span class="nx">mybatis</span><span class="p">.</span><span class="nx">example</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">public</span> <span class="kd">interface</span> <span class="nx">BlogMapper</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="nf">Select</span><span class="p">(</span><span class="s">&#34;SELECT * FROM blog WHERE id = #{id}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Blog</span> <span class="nf">selectBlog</span><span class="p">(</span><span class="kt">int</span> <span class="nx">id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用注解来映射简单语句会使代码显得更加简洁，但对于稍微复杂一点的语句，Java 注解不仅力不从心，还会让本就复杂的 SQL 语句更加混乱不堪。 因此，如果你需要做一些很复杂的操作，最好用 XML 来映射语句。</p>
<p>选择何种方式来配置映射，以及是否应该要统一映射语句定义的形式，完全取决于你和你的团队。 换句话说，永远不要拘泥于一种方式，你可以很轻松地在基于注解和 XML 的语句映射方式间自由移植和切换。</p>
<h4 id="作用域scope和生命周期" class="headerLink">
    <a href="#%e4%bd%9c%e7%94%a8%e5%9f%9fscope%e5%92%8c%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" class="header-mark"></a>作用域（Scope）和生命周期</h4><p>理解我们之前讨论过的不同作用域和生命周期类别是至关重要的，因为错误的使用会导致非常严重的并发问题。</p>
<hr>
<p><strong>提示</strong> <strong>对象生命周期和依赖注入框架</strong></p>
<p>依赖注入框架可以创建线程安全的、基于事务的 SqlSession 和映射器，并将它们直接注入到你的 bean 中，因此可以直接忽略它们的生命周期。 如果对如何通过依赖注入框架使用 MyBatis 感兴趣，可以研究一下 MyBatis-Spring 或 MyBatis-Guice 两个子项目。</p>
<hr>
<h5 id="sqlsessionfactorybuilder" class="headerLink">
    <a href="#sqlsessionfactorybuilder" class="header-mark"></a>SqlSessionFactoryBuilder</h5><p>这个类可以被实例化、使用和丢弃，一旦创建了 SqlSessionFactory，就不再需要它了。 因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是局部方法变量）。 你可以重用 SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，但最好还是不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情。</p>
<h5 id="sqlsessionfactory" class="headerLink">
    <a href="#sqlsessionfactory" class="header-mark"></a>SqlSessionFactory</h5><p>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例。 使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次，多次重建 SqlSessionFactory 被视为一种代码“坏习惯”。因此 SqlSessionFactory 的最佳作用域是应用作用域。 有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。</p>
<h5 id="sqlsession" class="headerLink">
    <a href="#sqlsession" class="header-mark"></a>SqlSession</h5><p>每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。 绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。 如果你现在正在使用一种 Web 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中。 换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。 下面的示例就是一个确保 SqlSession 关闭的标准模式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">try (SqlSession session = sqlSessionFactory.openSession()) {
</span></span><span class="line"><span class="cl">  // 你的应用逻辑代码
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在所有代码中都遵循这种使用模式，可以保证所有数据库资源都能被正确地关闭。</p>
<h5 id="映射器实例" class="headerLink">
    <a href="#%e6%98%a0%e5%b0%84%e5%99%a8%e5%ae%9e%e4%be%8b" class="header-mark"></a>映射器实例</h5><p>映射器是一些绑定映射语句的接口。映射器接口的实例是从 SqlSession 中获得的。虽然从技术层面上来讲，任何映射器实例的最大作用域与请求它们的 SqlSession 相同。但方法作用域才是映射器实例的最合适的作用域。 也就是说，映射器实例应该在调用它们的方法中被获取，使用完毕之后即可丢弃。 映射器实例并不需要被显式地关闭。尽管在整个请求作用域保留映射器实例不会有什么问题，但是你很快会发现，在这个作用域上管理太多像 SqlSession 的资源会让你忙不过来。 因此，最好将映射器放在方法作用域内。就像下面的例子一样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">try (SqlSession session = sqlSessionFactory.openSession()) {
</span></span><span class="line"><span class="cl">  BlogMapper mapper = session.getMapper(BlogMapper.class);
</span></span><span class="line"><span class="cl">  // 你的应用逻辑代码
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="xml-配置" class="headerLink">
    <a href="#xml-%e9%85%8d%e7%bd%ae" class="header-mark"></a>XML 配置</h3><p>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。</p>
<h4 id="属性properties" class="headerLink">
    <a href="#%e5%b1%9e%e6%80%a7properties" class="header-mark"></a>属性（properties）</h4><p>这些属性可以在外部进行配置，并可以进行动态替换。你既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;properties resource=&#34;org/mybatis/example/config.properties&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;username&#34; value=&#34;dev_user&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;password&#34; value=&#34;F2Fa3!33TYyg&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/properties&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置好的属性可以在整个配置文件中用来替换需要动态配置的属性值。比如:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;dataSource type=&#34;POOLED&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;driver&#34; value=&#34;${driver}&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;url&#34; value=&#34;${url}&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;username&#34; value=&#34;${username}&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;password&#34; value=&#34;${password}&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/dataSource&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子中的 username 和 password 将会由 properties 元素中设置的相应值来替换。 driver 和 url 属性将会由 config.properties 文件中对应的值来替换。这样就为配置提供了诸多灵活选择。</p>
<p>也可以在 SqlSessionFactoryBuilder.build() 方法中传入属性值。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, props);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// ... 或者 ...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, environment, props);
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果一个属性在不只一个地方进行了配置，那么，MyBatis 将按照下面的顺序来加载：</p>
<ul>
<li>首先读取在 properties 元素体内指定的属性。</li>
<li>然后根据 properties 元素中的 resource 属性读取类路径下属性文件，或根据 url 属性指定的路径读取属性文件，并覆盖之前读取过的同名属性。</li>
<li>最后读取作为方法参数传递的属性，并覆盖之前读取过的同名属性。</li>
</ul>
<p>因此，通过方法参数传递的属性具有最高优先级，resource/url 属性中指定的配置文件次之，最低优先级的则是 properties 元素中指定的属性。</p>
<p>从 MyBatis 3.4.2 开始，你可以为占位符指定一个默认值。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;dataSource type=&#34;POOLED&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;!-- ... --&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;username&#34; value=&#34;${username:ut_user}&#34;/&gt; &lt;!-- 如果属性 &#39;username&#39; 没有被配置，&#39;username&#39; 属性的值将为 &#39;ut_user&#39; --&gt;
</span></span><span class="line"><span class="cl">&lt;/dataSource&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个特性默认是关闭的。要启用这个特性，需要添加一个特定的属性来开启这个特性。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;properties resource=&#34;org/mybatis/example/config.properties&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;!-- ... --&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;org.apache.ibatis.parsing.PropertyParser.enable-default-value&#34; value=&#34;true&#34;/&gt; &lt;!-- 启用默认值特性 --&gt;
</span></span><span class="line"><span class="cl">&lt;/properties&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>提示</strong> 如果你在属性名中使用了 <code>&quot;:&quot;</code> 字符（如：<code>db:username</code>），或者在 SQL 映射中使用了 OGNL 表达式的三元运算符（如： <code>${tableName != null ? tableName : 'global_constants'}</code>），就需要设置特定的属性来修改分隔属性名和默认值的字符。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;properties resource=&#34;org/mybatis/example/config.properties&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;!-- ... --&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;org.apache.ibatis.parsing.PropertyParser.default-value-separator&#34; value=&#34;?:&#34;/&gt; &lt;!-- 修改默认值的分隔符 --&gt;
</span></span><span class="line"><span class="cl">&lt;/properties&gt;
</span></span><span class="line"><span class="cl">&lt;dataSource type=&#34;POOLED&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;!-- ... --&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;username&#34; value=&#34;${db:username?:ut_user}&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/dataSource&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="设置settings" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%aesettings" class="header-mark"></a>设置（settings）</h4><p>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。 下表描述了设置中各项设置的含义、默认值等。</p>
<table>
<thead>
<tr>
<th style="text-align:left">设置名</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">有效值</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">cacheEnabled</td>
<td style="text-align:left">全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">lazyLoadingEnabled</td>
<td style="text-align:left">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">aggressiveLazyLoading</td>
<td style="text-align:left">开启时，任一方法的调用都会加载该对象的所有延迟加载属性。 否则，每个延迟加载属性会按需加载（参考 <code>lazyLoadTriggerMethods</code>)。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">false （在 3.4.1 及之前的版本中默认为 true）</td>
</tr>
<tr>
<td style="text-align:left">multipleResultSetsEnabled</td>
<td style="text-align:left">是否允许单个语句返回多结果集（需要数据库驱动支持）。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">useColumnLabel</td>
<td style="text-align:left">使用列标签代替列名。实际表现依赖于数据库驱动，具体可参考数据库驱动的相关文档，或通过对比测试来观察。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">useGeneratedKeys</td>
<td style="text-align:left">允许 JDBC 支持自动生成主键，需要数据库驱动支持。如果设置为 true，将强制使用自动生成主键。尽管一些数据库驱动不支持此特性，但仍可正常工作（如 Derby）。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">False</td>
</tr>
<tr>
<td style="text-align:left">autoMappingBehavior</td>
<td style="text-align:left">指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套）。</td>
<td style="text-align:left">NONE, PARTIAL, FULL</td>
<td style="text-align:left">PARTIAL</td>
</tr>
<tr>
<td style="text-align:left">autoMappingUnknownColumnBehavior</td>
<td style="text-align:left">指定发现自动映射目标未知列（或未知属性类型）的行为。<code>NONE</code>: 不做任何反应<code>WARNING</code>: 输出警告日志（<code>'org.apache.ibatis.session.AutoMappingUnknownColumnBehavior'</code> 的日志等级必须设置为 <code>WARN</code>）<code>FAILING</code>: 映射失败 (抛出 <code>SqlSessionException</code>)</td>
<td style="text-align:left">NONE, WARNING, FAILING</td>
<td style="text-align:left">NONE</td>
</tr>
<tr>
<td style="text-align:left">defaultExecutorType</td>
<td style="text-align:left">配置默认的执行器。SIMPLE 就是普通的执行器；REUSE 执行器会重用预处理语句（PreparedStatement）； BATCH 执行器不仅重用语句还会执行批量更新。</td>
<td style="text-align:left">SIMPLE REUSE BATCH</td>
<td style="text-align:left">SIMPLE</td>
</tr>
<tr>
<td style="text-align:left">defaultStatementTimeout</td>
<td style="text-align:left">设置超时时间，它决定数据库驱动等待数据库响应的秒数。</td>
<td style="text-align:left">任意正整数</td>
<td style="text-align:left">未设置 (null)</td>
</tr>
<tr>
<td style="text-align:left">defaultFetchSize</td>
<td style="text-align:left">为驱动的结果集获取数量（fetchSize）设置一个建议值。此参数只可以在查询设置中被覆盖。</td>
<td style="text-align:left">任意正整数</td>
<td style="text-align:left">未设置 (null)</td>
</tr>
<tr>
<td style="text-align:left">defaultResultSetType</td>
<td style="text-align:left">指定语句默认的滚动策略。（新增于 3.5.2）</td>
<td style="text-align:left">FORWARD_ONLY | SCROLL_SENSITIVE | SCROLL_INSENSITIVE | DEFAULT（等同于未设置）</td>
<td style="text-align:left">未设置 (null)</td>
</tr>
<tr>
<td style="text-align:left">safeRowBoundsEnabled</td>
<td style="text-align:left">是否允许在嵌套语句中使用分页（RowBounds）。如果允许使用则设置为 false。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">False</td>
</tr>
<tr>
<td style="text-align:left">safeResultHandlerEnabled</td>
<td style="text-align:left">是否允许在嵌套语句中使用结果处理器（ResultHandler）。如果允许使用则设置为 false。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">True</td>
</tr>
<tr>
<td style="text-align:left">mapUnderscoreToCamelCase</td>
<td style="text-align:left">是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">False</td>
</tr>
<tr>
<td style="text-align:left">localCacheScope</td>
<td style="text-align:left">MyBatis 利用本地缓存机制（Local Cache）防止循环引用和加速重复的嵌套查询。 默认值为 SESSION，会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地缓存将仅用于执行语句，对相同 SqlSession 的不同查询将不会进行缓存。</td>
<td style="text-align:left">SESSION | STATEMENT</td>
<td style="text-align:left">SESSION</td>
</tr>
<tr>
<td style="text-align:left">jdbcTypeForNull</td>
<td style="text-align:left">当没有为参数指定特定的 JDBC 类型时，空值的默认 JDBC 类型。 某些数据库驱动需要指定列的 JDBC 类型，多数情况直接用一般类型即可，比如 NULL、VARCHAR 或 OTHER。</td>
<td style="text-align:left">JdbcType 常量，常用值：NULL、VARCHAR 或 OTHER。</td>
<td style="text-align:left">OTHER</td>
</tr>
<tr>
<td style="text-align:left">lazyLoadTriggerMethods</td>
<td style="text-align:left">指定对象的哪些方法触发一次延迟加载。</td>
<td style="text-align:left">用逗号分隔的方法列表。</td>
<td style="text-align:left">equals,clone,hashCode,toString</td>
</tr>
<tr>
<td style="text-align:left">defaultScriptingLanguage</td>
<td style="text-align:left">指定动态 SQL 生成使用的默认脚本语言。</td>
<td style="text-align:left">一个类型别名或全限定类名。</td>
<td style="text-align:left">org.apache.ibatis.scripting.xmltags.XMLLanguageDriver</td>
</tr>
<tr>
<td style="text-align:left">defaultEnumTypeHandler</td>
<td style="text-align:left">指定 Enum 使用的默认 <code>TypeHandler</code> 。（新增于 3.4.5）</td>
<td style="text-align:left">一个类型别名或全限定类名。</td>
<td style="text-align:left">org.apache.ibatis.type.EnumTypeHandler</td>
</tr>
<tr>
<td style="text-align:left">callSettersOnNulls</td>
<td style="text-align:left">指定当结果集中值为 null 的时候是否调用映射对象的 setter（map 对象时为 put）方法，这在依赖于 Map.keySet() 或 null 值进行初始化时比较有用。注意基本类型（int、boolean 等）是不能设置成 null 的。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">returnInstanceForEmptyRow</td>
<td style="text-align:left">当返回行的所有列都是空时，MyBatis 默认返回 <code>null</code>。 当开启这个设置时，MyBatis 会返回一个空实例。 请注意，它也适用于嵌套的结果集（如集合或关联）。（新增于 3.4.2）</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">logPrefix</td>
<td style="text-align:left">指定 MyBatis 增加到日志名称的前缀。</td>
<td style="text-align:left">任何字符串</td>
<td style="text-align:left">未设置</td>
</tr>
<tr>
<td style="text-align:left">logImpl</td>
<td style="text-align:left">指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td>
<td style="text-align:left">SLF4J | LOG4J（3.5.9 起废弃） | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td>
<td style="text-align:left">未设置</td>
</tr>
<tr>
<td style="text-align:left">proxyFactory</td>
<td style="text-align:left">指定 Mybatis 创建可延迟加载对象所用到的代理工具。</td>
<td style="text-align:left">CGLIB （3.5.10 起废弃） | JAVASSIST</td>
<td style="text-align:left">JAVASSIST （MyBatis 3.3 以上）</td>
</tr>
<tr>
<td style="text-align:left">vfsImpl</td>
<td style="text-align:left">指定 VFS 的实现</td>
<td style="text-align:left">自定义 VFS 的实现的类全限定名，以逗号分隔。</td>
<td style="text-align:left">未设置</td>
</tr>
<tr>
<td style="text-align:left">useActualParamName</td>
<td style="text-align:left">允许使用方法签名中的名称作为语句参数名称。 为了使用该特性，你的项目必须采用 Java 8 编译，并且加上 <code>-parameters</code> 选项。（新增于 3.4.1）</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">configurationFactory</td>
<td style="text-align:left">指定一个提供 <code>Configuration</code> 实例的类。 这个被返回的 Configuration 实例用来加载被反序列化对象的延迟加载属性值。 这个类必须包含一个签名为<code>static Configuration getConfiguration()</code> 的方法。（新增于 3.2.3）</td>
<td style="text-align:left">一个类型别名或完全限定类名。</td>
<td style="text-align:left">未设置</td>
</tr>
<tr>
<td style="text-align:left">shrinkWhitespacesInSql</td>
<td style="text-align:left">从 SQL 中删除多余的空格字符。请注意，这也会影响 SQL 中的文字字符串。 (新增于 3.5.5)</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">defaultSqlProviderType</td>
<td style="text-align:left">指定一个拥有 provider 方法的 sql provider 类 （新增于 3.5.6）. 这个类适用于指定 sql provider 注解上的<code>type</code>（或 <code>value</code>） 属性（当这些属性在注解中被忽略时）。 (e.g. <code>@SelectProvider</code>)</td>
<td style="text-align:left">类型别名或者全限定名</td>
<td style="text-align:left">未设置</td>
</tr>
<tr>
<td style="text-align:left">nullableOnForEach</td>
<td style="text-align:left">为 &lsquo;foreach&rsquo; 标签的 &rsquo;nullable&rsquo; 属性指定默认值。（新增于 3.5.9）</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">argNameBasedConstructorAutoMapping</td>
<td style="text-align:left">当应用构造器自动映射时，参数名称被用来搜索要映射的列，而不再依赖列的顺序。（新增于 3.5.10）</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">false</td>
</tr>
</tbody>
</table>
<p>一个配置完整的 settings 元素的示例如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;settings&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;cacheEnabled&#34; value=&#34;true&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;lazyLoadingEnabled&#34; value=&#34;true&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;multipleResultSetsEnabled&#34; value=&#34;true&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;useColumnLabel&#34; value=&#34;true&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;useGeneratedKeys&#34; value=&#34;false&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;autoMappingBehavior&#34; value=&#34;PARTIAL&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;autoMappingUnknownColumnBehavior&#34; value=&#34;WARNING&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;defaultExecutorType&#34; value=&#34;SIMPLE&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;defaultStatementTimeout&#34; value=&#34;25&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;defaultFetchSize&#34; value=&#34;100&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;safeRowBoundsEnabled&#34; value=&#34;false&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;mapUnderscoreToCamelCase&#34; value=&#34;false&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;localCacheScope&#34; value=&#34;SESSION&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;jdbcTypeForNull&#34; value=&#34;OTHER&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;lazyLoadTriggerMethods&#34; value=&#34;equals,clone,hashCode,toString&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/settings&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="类型别名typealiases" class="headerLink">
    <a href="#%e7%b1%bb%e5%9e%8b%e5%88%ab%e5%90%8dtypealiases" class="header-mark"></a>类型别名（typeAliases）</h4><p>类型别名可为 Java 类型设置一个缩写名字。 它仅用于 XML 配置，意在降低冗余的全限定类名书写。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;typeAliases&gt;
</span></span><span class="line"><span class="cl">  &lt;typeAlias alias=&#34;Author&#34; type=&#34;domain.blog.Author&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;typeAlias alias=&#34;Blog&#34; type=&#34;domain.blog.Blog&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;typeAlias alias=&#34;Comment&#34; type=&#34;domain.blog.Comment&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;typeAlias alias=&#34;Post&#34; type=&#34;domain.blog.Post&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;typeAlias alias=&#34;Section&#34; type=&#34;domain.blog.Section&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;typeAlias alias=&#34;Tag&#34; type=&#34;domain.blog.Tag&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/typeAliases&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>当这样配置时，<code>Blog</code> 可以用在任何使用 <code>domain.blog.Blog</code> 的地方。</p>
<p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nx">typeAliases</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="kn">package</span> <span class="nx">name</span><span class="p">=</span><span class="s">&#34;domain.blog&#34;</span><span class="o">/</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="o">/</span><span class="nx">typeAliases</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>每一个在包 <code>domain.blog</code> 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。 比如 <code>domain.blog.Author</code> 的别名为 <code>author</code>；若有注解，则别名为其注解值。见下面的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Alias(&#34;author&#34;)
</span></span><span class="line"><span class="cl">public class Author {
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>下面是一些为常见的 Java 类型内建的类型别名。它们都是不区分大小写的，注意，为了应对原始类型的命名重复，采取了特殊的命名风格。</p>
<table>
<thead>
<tr>
<th style="text-align:left">别名</th>
<th style="text-align:left">映射的类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">_byte</td>
<td style="text-align:left">byte</td>
</tr>
<tr>
<td style="text-align:left">_char (since 3.5.10)</td>
<td style="text-align:left">char</td>
</tr>
<tr>
<td style="text-align:left">_character (since 3.5.10)</td>
<td style="text-align:left">char</td>
</tr>
<tr>
<td style="text-align:left">_long</td>
<td style="text-align:left">long</td>
</tr>
<tr>
<td style="text-align:left">_short</td>
<td style="text-align:left">short</td>
</tr>
<tr>
<td style="text-align:left">_int</td>
<td style="text-align:left">int</td>
</tr>
<tr>
<td style="text-align:left">_integer</td>
<td style="text-align:left">int</td>
</tr>
<tr>
<td style="text-align:left">_double</td>
<td style="text-align:left">double</td>
</tr>
<tr>
<td style="text-align:left">_float</td>
<td style="text-align:left">float</td>
</tr>
<tr>
<td style="text-align:left">_boolean</td>
<td style="text-align:left">boolean</td>
</tr>
<tr>
<td style="text-align:left">string</td>
<td style="text-align:left">String</td>
</tr>
<tr>
<td style="text-align:left">byte</td>
<td style="text-align:left">Byte</td>
</tr>
<tr>
<td style="text-align:left">char (since 3.5.10)</td>
<td style="text-align:left">Character</td>
</tr>
<tr>
<td style="text-align:left">character (since 3.5.10)</td>
<td style="text-align:left">Character</td>
</tr>
<tr>
<td style="text-align:left">long</td>
<td style="text-align:left">Long</td>
</tr>
<tr>
<td style="text-align:left">short</td>
<td style="text-align:left">Short</td>
</tr>
<tr>
<td style="text-align:left">int</td>
<td style="text-align:left">Integer</td>
</tr>
<tr>
<td style="text-align:left">integer</td>
<td style="text-align:left">Integer</td>
</tr>
<tr>
<td style="text-align:left">double</td>
<td style="text-align:left">Double</td>
</tr>
<tr>
<td style="text-align:left">float</td>
<td style="text-align:left">Float</td>
</tr>
<tr>
<td style="text-align:left">boolean</td>
<td style="text-align:left">Boolean</td>
</tr>
<tr>
<td style="text-align:left">date</td>
<td style="text-align:left">Date</td>
</tr>
<tr>
<td style="text-align:left">decimal</td>
<td style="text-align:left">BigDecimal</td>
</tr>
<tr>
<td style="text-align:left">bigdecimal</td>
<td style="text-align:left">BigDecimal</td>
</tr>
<tr>
<td style="text-align:left">biginteger</td>
<td style="text-align:left">BigInteger</td>
</tr>
<tr>
<td style="text-align:left">object</td>
<td style="text-align:left">Object</td>
</tr>
<tr>
<td style="text-align:left">date[]</td>
<td style="text-align:left">Date[]</td>
</tr>
<tr>
<td style="text-align:left">decimal[]</td>
<td style="text-align:left">BigDecimal[]</td>
</tr>
<tr>
<td style="text-align:left">bigdecimal[]</td>
<td style="text-align:left">BigDecimal[]</td>
</tr>
<tr>
<td style="text-align:left">biginteger[]</td>
<td style="text-align:left">BigInteger[]</td>
</tr>
<tr>
<td style="text-align:left">object[]</td>
<td style="text-align:left">Object[]</td>
</tr>
<tr>
<td style="text-align:left">map</td>
<td style="text-align:left">Map</td>
</tr>
<tr>
<td style="text-align:left">hashmap</td>
<td style="text-align:left">HashMap</td>
</tr>
<tr>
<td style="text-align:left">list</td>
<td style="text-align:left">List</td>
</tr>
<tr>
<td style="text-align:left">arraylist</td>
<td style="text-align:left">ArrayList</td>
</tr>
<tr>
<td style="text-align:left">collection</td>
<td style="text-align:left">Collection</td>
</tr>
<tr>
<td style="text-align:left">iterator</td>
<td style="text-align:left">Iterator</td>
</tr>
</tbody>
</table>
<h4 id="类型处理器typehandlers" class="headerLink">
    <a href="#%e7%b1%bb%e5%9e%8b%e5%a4%84%e7%90%86%e5%99%a8typehandlers" class="header-mark"></a>类型处理器（typeHandlers）</h4><p>MyBatis 在设置预处理语句（PreparedStatement）中的参数或从结果集中取出一个值时， 都会用类型处理器将获取到的值以合适的方式转换成 Java 类型。下表描述了一些默认的类型处理器。</p>
<p><strong>提示</strong> 从 3.4.5 开始，MyBatis 默认支持 JSR-310（日期和时间 API） 。</p>
<table>
<thead>
<tr>
<th style="text-align:left">类型处理器</th>
<th style="text-align:left">Java 类型</th>
<th style="text-align:left">JDBC 类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>BooleanTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.Boolean</code>, <code>boolean</code></td>
<td style="text-align:left">数据库兼容的 <code>BOOLEAN</code></td>
</tr>
<tr>
<td style="text-align:left"><code>ByteTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.Byte</code>, <code>byte</code></td>
<td style="text-align:left">数据库兼容的 <code>NUMERIC</code> 或 <code>BYTE</code></td>
</tr>
<tr>
<td style="text-align:left"><code>ShortTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.Short</code>, <code>short</code></td>
<td style="text-align:left">数据库兼容的 <code>NUMERIC</code> 或 <code>SMALLINT</code></td>
</tr>
<tr>
<td style="text-align:left"><code>IntegerTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.Integer</code>, <code>int</code></td>
<td style="text-align:left">数据库兼容的 <code>NUMERIC</code> 或 <code>INTEGER</code></td>
</tr>
<tr>
<td style="text-align:left"><code>LongTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.Long</code>, <code>long</code></td>
<td style="text-align:left">数据库兼容的 <code>NUMERIC</code> 或 <code>BIGINT</code></td>
</tr>
<tr>
<td style="text-align:left"><code>FloatTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.Float</code>, <code>float</code></td>
<td style="text-align:left">数据库兼容的 <code>NUMERIC</code> 或 <code>FLOAT</code></td>
</tr>
<tr>
<td style="text-align:left"><code>DoubleTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.Double</code>, <code>double</code></td>
<td style="text-align:left">数据库兼容的 <code>NUMERIC</code> 或 <code>DOUBLE</code></td>
</tr>
<tr>
<td style="text-align:left"><code>BigDecimalTypeHandler</code></td>
<td style="text-align:left"><code>java.math.BigDecimal</code></td>
<td style="text-align:left">数据库兼容的 <code>NUMERIC</code> 或 <code>DECIMAL</code></td>
</tr>
<tr>
<td style="text-align:left"><code>StringTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.String</code></td>
<td style="text-align:left"><code>CHAR</code>, <code>VARCHAR</code></td>
</tr>
<tr>
<td style="text-align:left"><code>ClobReaderTypeHandler</code></td>
<td style="text-align:left"><code>java.io.Reader</code></td>
<td style="text-align:left">-</td>
</tr>
<tr>
<td style="text-align:left"><code>ClobTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.String</code></td>
<td style="text-align:left"><code>CLOB</code>, <code>LONGVARCHAR</code></td>
</tr>
<tr>
<td style="text-align:left"><code>NStringTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.String</code></td>
<td style="text-align:left"><code>NVARCHAR</code>, <code>NCHAR</code></td>
</tr>
<tr>
<td style="text-align:left"><code>NClobTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.String</code></td>
<td style="text-align:left"><code>NCLOB</code></td>
</tr>
<tr>
<td style="text-align:left"><code>BlobInputStreamTypeHandler</code></td>
<td style="text-align:left"><code>java.io.InputStream</code></td>
<td style="text-align:left">-</td>
</tr>
<tr>
<td style="text-align:left"><code>ByteArrayTypeHandler</code></td>
<td style="text-align:left"><code>byte[]</code></td>
<td style="text-align:left">数据库兼容的字节流类型</td>
</tr>
<tr>
<td style="text-align:left"><code>BlobTypeHandler</code></td>
<td style="text-align:left"><code>byte[]</code></td>
<td style="text-align:left"><code>BLOB</code>, <code>LONGVARBINARY</code></td>
</tr>
<tr>
<td style="text-align:left"><code>DateTypeHandler</code></td>
<td style="text-align:left"><code>java.util.Date</code></td>
<td style="text-align:left"><code>TIMESTAMP</code></td>
</tr>
<tr>
<td style="text-align:left"><code>DateOnlyTypeHandler</code></td>
<td style="text-align:left"><code>java.util.Date</code></td>
<td style="text-align:left"><code>DATE</code></td>
</tr>
<tr>
<td style="text-align:left"><code>TimeOnlyTypeHandler</code></td>
<td style="text-align:left"><code>java.util.Date</code></td>
<td style="text-align:left"><code>TIME</code></td>
</tr>
<tr>
<td style="text-align:left"><code>SqlTimestampTypeHandler</code></td>
<td style="text-align:left"><code>java.sql.Timestamp</code></td>
<td style="text-align:left"><code>TIMESTAMP</code></td>
</tr>
<tr>
<td style="text-align:left"><code>SqlDateTypeHandler</code></td>
<td style="text-align:left"><code>java.sql.Date</code></td>
<td style="text-align:left"><code>DATE</code></td>
</tr>
<tr>
<td style="text-align:left"><code>SqlTimeTypeHandler</code></td>
<td style="text-align:left"><code>java.sql.Time</code></td>
<td style="text-align:left"><code>TIME</code></td>
</tr>
<tr>
<td style="text-align:left"><code>ObjectTypeHandler</code></td>
<td style="text-align:left">Any</td>
<td style="text-align:left"><code>OTHER</code> 或未指定类型</td>
</tr>
<tr>
<td style="text-align:left"><code>EnumTypeHandler</code></td>
<td style="text-align:left">Enumeration Type</td>
<td style="text-align:left">VARCHAR 或任何兼容的字符串类型，用来存储枚举的名称（而不是索引序数值）</td>
</tr>
<tr>
<td style="text-align:left"><code>EnumOrdinalTypeHandler</code></td>
<td style="text-align:left">Enumeration Type</td>
<td style="text-align:left">任何兼容的 <code>NUMERIC</code> 或 <code>DOUBLE</code> 类型，用来存储枚举的序数值（而不是名称）。</td>
</tr>
<tr>
<td style="text-align:left"><code>SqlxmlTypeHandler</code></td>
<td style="text-align:left"><code>java.lang.String</code></td>
<td style="text-align:left"><code>SQLXML</code></td>
</tr>
<tr>
<td style="text-align:left"><code>InstantTypeHandler</code></td>
<td style="text-align:left"><code>java.time.Instant</code></td>
<td style="text-align:left"><code>TIMESTAMP</code></td>
</tr>
<tr>
<td style="text-align:left"><code>LocalDateTimeTypeHandler</code></td>
<td style="text-align:left"><code>java.time.LocalDateTime</code></td>
<td style="text-align:left"><code>TIMESTAMP</code></td>
</tr>
<tr>
<td style="text-align:left"><code>LocalDateTypeHandler</code></td>
<td style="text-align:left"><code>java.time.LocalDate</code></td>
<td style="text-align:left"><code>DATE</code></td>
</tr>
<tr>
<td style="text-align:left"><code>LocalTimeTypeHandler</code></td>
<td style="text-align:left"><code>java.time.LocalTime</code></td>
<td style="text-align:left"><code>TIME</code></td>
</tr>
<tr>
<td style="text-align:left"><code>OffsetDateTimeTypeHandler</code></td>
<td style="text-align:left"><code>java.time.OffsetDateTime</code></td>
<td style="text-align:left"><code>TIMESTAMP</code></td>
</tr>
<tr>
<td style="text-align:left"><code>OffsetTimeTypeHandler</code></td>
<td style="text-align:left"><code>java.time.OffsetTime</code></td>
<td style="text-align:left"><code>TIME</code></td>
</tr>
<tr>
<td style="text-align:left"><code>ZonedDateTimeTypeHandler</code></td>
<td style="text-align:left"><code>java.time.ZonedDateTime</code></td>
<td style="text-align:left"><code>TIMESTAMP</code></td>
</tr>
<tr>
<td style="text-align:left"><code>YearTypeHandler</code></td>
<td style="text-align:left"><code>java.time.Year</code></td>
<td style="text-align:left"><code>INTEGER</code></td>
</tr>
<tr>
<td style="text-align:left"><code>MonthTypeHandler</code></td>
<td style="text-align:left"><code>java.time.Month</code></td>
<td style="text-align:left"><code>INTEGER</code></td>
</tr>
<tr>
<td style="text-align:left"><code>YearMonthTypeHandler</code></td>
<td style="text-align:left"><code>java.time.YearMonth</code></td>
<td style="text-align:left"><code>VARCHAR</code> 或 <code>LONGVARCHAR</code></td>
</tr>
<tr>
<td style="text-align:left"><code>JapaneseDateTypeHandler</code></td>
<td style="text-align:left"><code>java.time.chrono.JapaneseDate</code></td>
<td style="text-align:left"><code>DATE</code></td>
</tr>
</tbody>
</table>
<p>你可以重写已有的类型处理器或创建你自己的类型处理器来处理不支持的或非标准的类型。 具体做法为：实现 <code>org.apache.ibatis.type.TypeHandler</code> 接口， 或继承一个很便利的类 <code>org.apache.ibatis.type.BaseTypeHandler</code>， 并且可以（可选地）将它映射到一个 JDBC 类型。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span> <span class="n">ExampleTypeHandler</span><span class="o">.</span><span class="n">java</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">MappedJdbcTypes</span><span class="p">(</span><span class="n">JdbcType</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">public</span> <span class="k">class</span> <span class="n">ExampleTypeHandler</span> <span class="k">extends</span> <span class="n">BaseTypeHandler</span><span class="o">&lt;</span><span class="ne">String</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="n">void</span> <span class="n">setNonNullParameter</span><span class="p">(</span><span class="n">PreparedStatement</span> <span class="n">ps</span><span class="p">,</span> <span class="ne">int</span> <span class="n">i</span><span class="p">,</span> <span class="ne">String</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">JdbcType</span> <span class="n">jdbcType</span><span class="p">)</span> <span class="n">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ps</span><span class="o">.</span><span class="n">setString</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">parameter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="ne">String</span> <span class="n">getNullableResult</span><span class="p">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="p">,</span> <span class="ne">String</span> <span class="n">columnName</span><span class="p">)</span> <span class="n">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">columnName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="ne">String</span> <span class="n">getNullableResult</span><span class="p">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="p">,</span> <span class="ne">int</span> <span class="n">columnIndex</span><span class="p">)</span> <span class="n">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">columnIndex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="ne">String</span> <span class="n">getNullableResult</span><span class="p">(</span><span class="n">CallableStatement</span> <span class="n">cs</span><span class="p">,</span> <span class="ne">int</span> <span class="n">columnIndex</span><span class="p">)</span> <span class="n">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cs</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">columnIndex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;!--</span> <span class="n">mybatis</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">xml</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">typeHandlers</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">typeHandler</span> <span class="n">handler</span><span class="o">=</span><span class="s2">&#34;org.mybatis.example.ExampleTypeHandler&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">typeHandlers</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用上述的类型处理器将会覆盖已有的处理 Java String 类型的属性以及 VARCHAR 类型的参数和结果的类型处理器。 要注意 MyBatis 不会通过检测数据库元信息来决定使用哪种类型，所以你必须在参数和结果映射中指明字段是 VARCHAR 类型， 以使其能够绑定到正确的类型处理器上。这是因为 MyBatis 直到语句被执行时才清楚数据类型。</p>
<p>通过类型处理器的泛型，MyBatis 可以得知该类型处理器处理的 Java 类型，不过这种行为可以通过两种方法改变：</p>
<ul>
<li>在类型处理器的配置元素（typeHandler 元素）上增加一个 <code>javaType</code> 属性（比如：<code>javaType=&quot;String&quot;</code>）；</li>
<li>在类型处理器的类上增加一个 <code>@MappedTypes</code> 注解指定与其关联的 Java 类型列表。 如果在 <code>javaType</code> 属性中也同时指定，则注解上的配置将被忽略。</li>
</ul>
<p>可以通过两种方式来指定关联的 JDBC 类型：</p>
<ul>
<li>在类型处理器的配置元素上增加一个 <code>jdbcType</code> 属性（比如：<code>jdbcType=&quot;VARCHAR&quot;</code>）；</li>
<li>在类型处理器的类上增加一个 <code>@MappedJdbcTypes</code> 注解指定与其关联的 JDBC 类型列表。 如果在 <code>jdbcType</code> 属性中也同时指定，则注解上的配置将被忽略。</li>
</ul>
<p>当在 <code>ResultMap</code> 中决定使用哪种类型处理器时，此时 Java 类型是已知的（从结果类型中获得），但是 JDBC 类型是未知的。 因此 Mybatis 使用 <code>javaType=[Java 类型], jdbcType=null</code> 的组合来选择一个类型处理器。 这意味着使用 <code>@MappedJdbcTypes</code> 注解可以<em>限制</em>类型处理器的作用范围，并且可以确保，除非显式地设置，否则类型处理器在 <code>ResultMap</code> 中将不会生效。 如果希望能在 <code>ResultMap</code> 中隐式地使用类型处理器，那么设置 <code>@MappedJdbcTypes</code> 注解的 <code>includeNullJdbcType=true</code> 即可。 然而从 Mybatis 3.4.0 开始，如果某个 Java 类型<strong>只有一个</strong>注册的类型处理器，即使没有设置 <code>includeNullJdbcType=true</code>，那么这个类型处理器也会是 <code>ResultMap</code> 使用 Java 类型时的默认处理器。</p>
<p>最后，可以让 MyBatis 帮你查找类型处理器：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">&lt;!</span><span class="o">--</span> <span class="nx">mybatis</span><span class="o">-</span><span class="nx">config</span><span class="p">.</span><span class="nx">xml</span> <span class="o">--</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nx">typeHandlers</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="kn">package</span> <span class="nx">name</span><span class="p">=</span><span class="s">&#34;org.mybatis.example&#34;</span><span class="o">/</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="o">/</span><span class="nx">typeHandlers</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意在使用自动发现功能的时候，只能通过注解方式来指定 JDBC 的类型。</p>
<p>你可以创建能够处理多个类的泛型类型处理器。为了使用泛型类型处理器， 需要增加一个接受该类的 class 作为参数的构造器，这样 MyBatis 会在构造一个类型处理器实例的时候传入一个具体的类。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span><span class="n">GenericTypeHandler</span><span class="o">.</span><span class="n">java</span>
</span></span><span class="line"><span class="cl"><span class="n">public</span> <span class="k">class</span> <span class="n">GenericTypeHandler</span><span class="o">&lt;</span><span class="n">E</span> <span class="k">extends</span> <span class="n">MyObject</span><span class="o">&gt;</span> <span class="k">extends</span> <span class="n">BaseTypeHandler</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">private</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="n">GenericTypeHandler</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="n">throw</span> <span class="n">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s2">&#34;Type argument cannot be null&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">this</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>EnumTypeHandler</code> 和 <code>EnumOrdinalTypeHandler</code> 都是泛型类型处理器，我们将会在接下来的部分详细探讨。</p>
<h4 id="处理枚举类型" class="headerLink">
    <a href="#%e5%a4%84%e7%90%86%e6%9e%9a%e4%b8%be%e7%b1%bb%e5%9e%8b" class="header-mark"></a>处理枚举类型</h4><p>若想映射枚举类型 <code>Enum</code>，则需要从 <code>EnumTypeHandler</code> 或者 <code>EnumOrdinalTypeHandler</code> 中选择一个来使用。</p>
<p>比如说我们想存储取近似值时用到的舍入模式。默认情况下，MyBatis 会利用 <code>EnumTypeHandler</code> 来把 <code>Enum</code> 值转换成对应的名字。</p>
<p><strong>注意 <code>EnumTypeHandler</code> 在某种意义上来说是比较特别的，其它的处理器只针对某个特定的类，而它不同，它会处理任意继承了 <code>Enum</code> 的类。</strong></p>
<p>不过，我们可能不想存储名字，相反我们的 DBA 会坚持使用整形值代码。那也一样简单：在配置文件中把 <code>EnumOrdinalTypeHandler</code> 加到 <code>typeHandlers</code> 中即可， 这样每个 <code>RoundingMode</code> 将通过他们的序数值来映射成对应的整形数值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!-- mybatis-config.xml --&gt;
</span></span><span class="line"><span class="cl">&lt;typeHandlers&gt;
</span></span><span class="line"><span class="cl">  &lt;typeHandler handler=&#34;org.apache.ibatis.type.EnumOrdinalTypeHandler&#34; javaType=&#34;java.math.RoundingMode&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/typeHandlers&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>但要是你想在一个地方将 <code>Enum</code> 映射成字符串，在另外一个地方映射成整形值呢？</p>
<p>自动映射器（auto-mapper）会自动地选用 <code>EnumOrdinalTypeHandler</code> 来处理枚举类型， 所以如果我们想用普通的 <code>EnumTypeHandler</code>，就必须要显式地为那些 SQL 语句设置要使用的类型处理器。</p>
<p>（下一节才开始介绍映射器文件，如果你是首次阅读该文档，你可能需要先跳过这里，过会再来看。）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!DOCTYPE mapper
</span></span><span class="line"><span class="cl">    PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span><span class="line"><span class="cl">    &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;mapper namespace=&#34;org.apache.ibatis.submitted.rounding.Mapper&#34;&gt;
</span></span><span class="line"><span class="cl">	&lt;resultMap type=&#34;org.apache.ibatis.submitted.rounding.User&#34; id=&#34;usermap&#34;&gt;
</span></span><span class="line"><span class="cl">		&lt;id column=&#34;id&#34; property=&#34;id&#34;/&gt;
</span></span><span class="line"><span class="cl">		&lt;result column=&#34;name&#34; property=&#34;name&#34;/&gt;
</span></span><span class="line"><span class="cl">		&lt;result column=&#34;funkyNumber&#34; property=&#34;funkyNumber&#34;/&gt;
</span></span><span class="line"><span class="cl">		&lt;result column=&#34;roundingMode&#34; property=&#34;roundingMode&#34;/&gt;
</span></span><span class="line"><span class="cl">	&lt;/resultMap&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	&lt;select id=&#34;getUser&#34; resultMap=&#34;usermap&#34;&gt;
</span></span><span class="line"><span class="cl">		select * from users
</span></span><span class="line"><span class="cl">	&lt;/select&gt;
</span></span><span class="line"><span class="cl">	&lt;insert id=&#34;insert&#34;&gt;
</span></span><span class="line"><span class="cl">	    insert into users (id, name, funkyNumber, roundingMode) values (
</span></span><span class="line"><span class="cl">	    	#{id}, #{name}, #{funkyNumber}, #{roundingMode}
</span></span><span class="line"><span class="cl">	    )
</span></span><span class="line"><span class="cl">	&lt;/insert&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	&lt;resultMap type=&#34;org.apache.ibatis.submitted.rounding.User&#34; id=&#34;usermap2&#34;&gt;
</span></span><span class="line"><span class="cl">		&lt;id column=&#34;id&#34; property=&#34;id&#34;/&gt;
</span></span><span class="line"><span class="cl">		&lt;result column=&#34;name&#34; property=&#34;name&#34;/&gt;
</span></span><span class="line"><span class="cl">		&lt;result column=&#34;funkyNumber&#34; property=&#34;funkyNumber&#34;/&gt;
</span></span><span class="line"><span class="cl">		&lt;result column=&#34;roundingMode&#34; property=&#34;roundingMode&#34; typeHandler=&#34;org.apache.ibatis.type.EnumTypeHandler&#34;/&gt;
</span></span><span class="line"><span class="cl">	&lt;/resultMap&gt;
</span></span><span class="line"><span class="cl">	&lt;select id=&#34;getUser2&#34; resultMap=&#34;usermap2&#34;&gt;
</span></span><span class="line"><span class="cl">		select * from users2
</span></span><span class="line"><span class="cl">	&lt;/select&gt;
</span></span><span class="line"><span class="cl">	&lt;insert id=&#34;insert2&#34;&gt;
</span></span><span class="line"><span class="cl">	    insert into users2 (id, name, funkyNumber, roundingMode) values (
</span></span><span class="line"><span class="cl">	    	#{id}, #{name}, #{funkyNumber}, #{roundingMode, typeHandler=org.apache.ibatis.type.EnumTypeHandler}
</span></span><span class="line"><span class="cl">	    )
</span></span><span class="line"><span class="cl">	&lt;/insert&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/mapper&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意，这里的 select 语句必须指定 <code>resultMap</code> 而不是 <code>resultType</code>。</p>
<h4 id="对象工厂objectfactory" class="headerLink">
    <a href="#%e5%af%b9%e8%b1%a1%e5%b7%a5%e5%8e%82objectfactory" class="header-mark"></a>对象工厂（objectFactory）</h4><p>每次 MyBatis 创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）实例来完成实例化工作。 默认的对象工厂需要做的仅仅是实例化目标类，要么通过默认无参构造方法，要么通过存在的参数映射来调用带有参数的构造方法。 如果想覆盖对象工厂的默认行为，可以通过创建自己的对象工厂来实现。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span> <span class="n">ExampleObjectFactory</span><span class="o">.</span><span class="n">java</span>
</span></span><span class="line"><span class="cl"><span class="n">public</span> <span class="k">class</span> <span class="n">ExampleObjectFactory</span> <span class="k">extends</span> <span class="n">DefaultObjectFactory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="err">p</span><span class="n">ublic</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">create</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">super</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">create</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;</span><span class="err">?</span><span class="o">&gt;&gt;</span> <span class="n">constructorArgTypes</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="ne">Object</span><span class="o">&gt;</span> <span class="n">constructorArgs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">super</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">constructorArgTypes</span><span class="p">,</span> <span class="n">constructorArgs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="n">void</span> <span class="n">setProperties</span><span class="p">(</span><span class="n">Properties</span> <span class="n">properties</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">super</span><span class="o">.</span><span class="n">setProperties</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">boolean</span> <span class="n">isCollection</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Collection</span><span class="o">.</span><span class="k">class</span><span class="o">.</span><span class="n">isAssignableFrom</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;!--</span> <span class="n">mybatis</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">xml</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">objectFactory</span> <span class="n">type</span><span class="o">=</span><span class="s2">&#34;org.mybatis.example.ExampleObjectFactory&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;someProperty&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&#34;100&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">objectFactory</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ObjectFactory 接口很简单，它包含两个创建实例用的方法，一个是处理默认无参构造方法的，另外一个是处理带参数的构造方法的。 另外，setProperties 方法可以被用来配置 ObjectFactory，在初始化你的 ObjectFactory 实例后， objectFactory 元素体中定义的属性会被传递给 setProperties 方法。</p>
<h4 id="插件plugins" class="headerLink">
    <a href="#%e6%8f%92%e4%bb%b6plugins" class="header-mark"></a>插件（plugins）</h4><p>MyBatis 允许你在映射语句执行过程中的某一点进行拦截调用。默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：</p>
<ul>
<li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li>
<li>ParameterHandler (getParameterObject, setParameters)</li>
<li>ResultSetHandler (handleResultSets, handleOutputParameters)</li>
<li>StatementHandler (prepare, parameterize, batch, update, query)</li>
</ul>
<p>这些类中方法的细节可以通过查看每个方法的签名来发现，或者直接查看 MyBatis 发行包中的源代码。 如果你想做的不仅仅是监控方法的调用，那么你最好相当了解要重写的方法的行为。 因为在试图修改或重写已有方法的行为时，很可能会破坏 MyBatis 的核心模块。 这些都是更底层的类和方法，所以使用插件的时候要特别当心。</p>
<p>通过 MyBatis 提供的强大机制，使用插件是非常简单的，只需实现 Interceptor 接口，并指定想要拦截的方法签名即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// ExamplePlugin.java
</span></span><span class="line"><span class="cl">@Intercepts({@Signature(
</span></span><span class="line"><span class="cl">  type= Executor.class,
</span></span><span class="line"><span class="cl">  method = &#34;update&#34;,
</span></span><span class="line"><span class="cl">  args = {MappedStatement.class,Object.class})})
</span></span><span class="line"><span class="cl">public class ExamplePlugin implements Interceptor {
</span></span><span class="line"><span class="cl">  private Properties properties = new Properties();
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  @Override
</span></span><span class="line"><span class="cl">  public Object intercept(Invocation invocation) throws Throwable {
</span></span><span class="line"><span class="cl">    // implement pre processing if need
</span></span><span class="line"><span class="cl">    Object returnObject = invocation.proceed();
</span></span><span class="line"><span class="cl">    // implement post processing if need
</span></span><span class="line"><span class="cl">    return returnObject;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  @Override
</span></span><span class="line"><span class="cl">  public void setProperties(Properties properties) {
</span></span><span class="line"><span class="cl">    this.properties = properties;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">&lt;!-- mybatis-config.xml --&gt;
</span></span><span class="line"><span class="cl">&lt;plugins&gt;
</span></span><span class="line"><span class="cl">  &lt;plugin interceptor=&#34;org.mybatis.example.ExamplePlugin&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;property name=&#34;someProperty&#34; value=&#34;100&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;/plugin&gt;
</span></span><span class="line"><span class="cl">&lt;/plugins&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的插件将会拦截在 Executor 实例中所有的 “update” 方法调用， 这里的 Executor 是负责执行底层映射语句的内部对象。</p>
<p><strong>提示</strong> <strong>覆盖配置类</strong></p>
<p>除了用插件来修改 MyBatis 核心行为以外，还可以通过完全覆盖配置类来达到目的。只需继承配置类后覆盖其中的某个方法，再把它传递到 SqlSessionFactoryBuilder.build(myConfig) 方法即可。再次重申，这可能会极大影响 MyBatis 的行为，务请慎之又慎。</p>
<h4 id="环境配置environments" class="headerLink">
    <a href="#%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%aeenvironments" class="header-mark"></a>环境配置（environments）</h4><p>MyBatis 可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中， 现实情况下有多种理由需要这么做。例如，开发、测试和生产环境需要有不同的配置；或者想在具有相同 Schema 的多个生产数据库中使用相同的 SQL 映射。还有许多类似的使用场景。</p>
<p><strong>不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong></p>
<p>所以，如果你想连接两个数据库，就需要创建两个 SqlSessionFactory 实例，每个数据库对应一个。而如果是三个数据库，就需要三个实例，依此类推，记起来很简单：</p>
<ul>
<li><strong>每个数据库对应一个 SqlSessionFactory 实例</strong></li>
</ul>
<p>为了指定创建哪种环境，只要将它作为可选的参数传递给 SqlSessionFactoryBuilder 即可。可以接受环境配置的两个方法签名是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, environment);
</span></span><span class="line"><span class="cl">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, environment, properties);
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果忽略了环境参数，那么将会加载默认环境，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader);
</span></span><span class="line"><span class="cl">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, properties);
</span></span></code></pre></td></tr></table>
</div>
</div><p>environments 元素定义了如何配置环境。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;environments default=&#34;development&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;environment id=&#34;development&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;transactionManager type=&#34;JDBC&#34;&gt;
</span></span><span class="line"><span class="cl">      &lt;property name=&#34;...&#34; value=&#34;...&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;/transactionManager&gt;
</span></span><span class="line"><span class="cl">    &lt;dataSource type=&#34;POOLED&#34;&gt;
</span></span><span class="line"><span class="cl">      &lt;property name=&#34;driver&#34; value=&#34;${driver}&#34;/&gt;
</span></span><span class="line"><span class="cl">      &lt;property name=&#34;url&#34; value=&#34;${url}&#34;/&gt;
</span></span><span class="line"><span class="cl">      &lt;property name=&#34;username&#34; value=&#34;${username}&#34;/&gt;
</span></span><span class="line"><span class="cl">      &lt;property name=&#34;password&#34; value=&#34;${password}&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;/dataSource&gt;
</span></span><span class="line"><span class="cl">  &lt;/environment&gt;
</span></span><span class="line"><span class="cl">&lt;/environments&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意一些关键点:</p>
<ul>
<li>默认使用的环境 ID（比如：default=&ldquo;development&rdquo;）。</li>
<li>每个 environment 元素定义的环境 ID（比如：id=&ldquo;development&rdquo;）。</li>
<li>事务管理器的配置（比如：type=&ldquo;JDBC&rdquo;）。</li>
<li>数据源的配置（比如：type=&ldquo;POOLED&rdquo;）。</li>
</ul>
<p>默认环境和环境 ID 顾名思义。 环境可以随意命名，但务必保证默认的环境 ID 要匹配其中一个环境 ID。</p>
<p><strong>事务管理器（transactionManager）</strong></p>
<p>在 MyBatis 中有两种类型的事务管理器（也就是 type=&quot;[JDBC|MANAGED]&quot;）：</p>
<ul>
<li>
<p>JDBC – 这个配置直接使用了 JDBC 的提交和回滚功能，它依赖从数据源获得的连接来管理事务作用域。默认情况下，为了与某些驱动程序兼容，它在关闭连接时启用自动提交。然而，对于某些驱动程序来说，启用自动提交不仅是不必要的，而且是一个代价高昂的操作。因此，从 3.5.10 版本开始，你可以通过将 &ldquo;skipSetAutoCommitOnClose&rdquo; 属性设置为 &ldquo;true&rdquo; 来跳过这个步骤。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;transactionManager type=&#34;JDBC&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;skipSetAutoCommitOnClose&#34; value=&#34;true&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/transactionManager&gt;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>MANAGED – 这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接。然而一些容器并不希望连接被关闭，因此需要将 closeConnection 属性设置为 false 来阻止默认的关闭行为。例如:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;transactionManager type=&#34;MANAGED&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;closeConnection&#34; value=&#34;false&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/transactionManager&gt;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p><strong>提示</strong> 如果你正在使用 Spring + MyBatis，则没有必要配置事务管理器，因为 Spring 模块会使用自带的管理器来覆盖前面的配置。</p>
<p>这两种事务管理器类型都不需要设置任何属性。它们其实是类型别名，换句话说，你可以用 TransactionFactory 接口实现类的全限定名或类型别名代替它们。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface TransactionFactory {
</span></span><span class="line"><span class="cl">  default void setProperties(Properties props) { // 从 3.5.2 开始，该方法为默认方法
</span></span><span class="line"><span class="cl">    // 空实现
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  Transaction newTransaction(Connection conn);
</span></span><span class="line"><span class="cl">  Transaction newTransaction(DataSource dataSource, TransactionIsolationLevel level, boolean autoCommit);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在事务管理器实例化后，所有在 XML 中配置的属性将会被传递给 setProperties() 方法。你的实现还需要创建一个 Transaction 接口的实现类，这个接口也很简单：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface Transaction {
</span></span><span class="line"><span class="cl">  Connection getConnection() throws SQLException;
</span></span><span class="line"><span class="cl">  void commit() throws SQLException;
</span></span><span class="line"><span class="cl">  void rollback() throws SQLException;
</span></span><span class="line"><span class="cl">  void close() throws SQLException;
</span></span><span class="line"><span class="cl">  Integer getTimeout() throws SQLException;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用这两个接口，你可以完全自定义 MyBatis 对事务的处理。</p>
<p><strong>数据源（dataSource）</strong></p>
<p>dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。</p>
<ul>
<li>大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。</li>
</ul>
<p>有三种内建的数据源类型（也就是 type=&quot;[UNPOOLED|POOLED|JNDI]&quot;）：</p>
<p><strong>UNPOOLED</strong>– 这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。UNPOOLED 类型的数据源仅仅需要配置以下 5 种属性：</p>
<ul>
<li><code>driver</code> – 这是 JDBC 驱动的 Java 类全限定名（并不是 JDBC 驱动中可能包含的数据源类）。</li>
<li><code>url</code> – 这是数据库的 JDBC URL 地址。</li>
<li><code>username</code> – 登录数据库的用户名。</li>
<li><code>password</code> – 登录数据库的密码。</li>
<li><code>defaultTransactionIsolationLevel</code> – 默认的连接事务隔离级别。</li>
<li><code>defaultNetworkTimeout</code> – 等待数据库操作完成的默认网络超时时间（单位：毫秒）。查看 <code>java.sql.Connection#setNetworkTimeout()</code> 的 API 文档以获取更多信息。</li>
</ul>
<p>作为可选项，你也可以传递属性给数据库驱动。只需在属性名加上“driver.”前缀即可，例如：</p>
<ul>
<li><code>driver.encoding=UTF8</code></li>
</ul>
<p>这将通过 DriverManager.getConnection(url, driverProperties) 方法传递值为 <code>UTF8</code> 的 <code>encoding</code> 属性给数据库驱动。</p>
<p><strong>POOLED</strong>– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。</p>
<p>除了上述提到 UNPOOLED 下的属性外，还有更多属性用来配置 POOLED 的数据源：</p>
<ul>
<li><code>poolMaximumActiveConnections</code> – 在任意时间可存在的活动（正在使用）连接数量，默认值：10</li>
<li><code>poolMaximumIdleConnections</code> – 任意时间可能存在的空闲连接数。</li>
<li><code>poolMaximumCheckoutTime</code> – 在被强制返回之前，池中连接被检出（checked out）时间，默认值：20000 毫秒（即 20 秒）</li>
<li><code>poolTimeToWait</code> – 这是一个底层设置，如果获取连接花费了相当长的时间，连接池会打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直失败且不打印日志），默认值：20000 毫秒（即 20 秒）。</li>
<li><code>poolMaximumLocalBadConnectionTolerance</code> – 这是一个关于坏连接容忍度的底层设置， 作用于每一个尝试从缓存池获取连接的线程。 如果这个线程获取到的是一个坏的连接，那么这个数据源允许这个线程尝试重新获取一个新的连接，但是这个重新尝试的次数不应该超过 <code>poolMaximumIdleConnections</code> 与 <code>poolMaximumLocalBadConnectionTolerance</code> 之和。 默认值：3（新增于 3.4.5）</li>
<li><code>poolPingQuery</code> – 发送到数据库的侦测查询，用来检验连接是否正常工作并准备接受请求。默认是“NO PING QUERY SET”，这会导致多数数据库驱动出错时返回恰当的错误消息。</li>
<li><code>poolPingEnabled</code> – 是否启用侦测查询。若开启，需要设置 <code>poolPingQuery</code> 属性为一个可执行的 SQL 语句（最好是一个速度非常快的 SQL 语句），默认值：false。</li>
<li><code>poolPingConnectionsNotUsedFor</code> – 配置 poolPingQuery 的频率。可以被设置为和数据库连接超时时间一样，来避免不必要的侦测，默认值：0（即所有连接每一时刻都被侦测 — 当然仅当 poolPingEnabled 为 true 时适用）。</li>
</ul>
<p><strong>JNDI</strong> – 这个数据源实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的数据源引用。这种数据源配置只需要两个属性：</p>
<ul>
<li><code>initial_context</code> – 这个属性用来在 InitialContext 中寻找上下文（即，initialContext.lookup(initial_context)）。这是个可选属性，如果忽略，那么将会直接从 InitialContext 中寻找 data_source 属性。</li>
<li><code>data_source</code> – 这是引用数据源实例位置的上下文路径。提供了 initial_context 配置时会在其返回的上下文中进行查找，没有提供时则直接在 InitialContext 中查找。</li>
</ul>
<p>和其他数据源配置类似，可以通过添加前缀“env.”直接把属性传递给 InitialContext。比如：</p>
<ul>
<li><code>env.encoding=UTF8</code></li>
</ul>
<p>这就会在 InitialContext 实例化时往它的构造方法传递值为 <code>UTF8</code> 的 <code>encoding</code> 属性。</p>
<p>你可以通过实现接口 <code>org.apache.ibatis.datasource.DataSourceFactory</code> 来使用第三方数据源实现：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface DataSourceFactory {
</span></span><span class="line"><span class="cl">  void setProperties(Properties props);
</span></span><span class="line"><span class="cl">  DataSource getDataSource();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory</code> 可被用作父类来构建新的数据源适配器，比如下面这段插入 C3P0 数据源所必需的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">ibatis</span><span class="o">.</span><span class="n">datasource</span><span class="o">.</span><span class="n">unpooled</span><span class="o">.</span><span class="n">UnpooledDataSourceFactory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">com</span><span class="o">.</span><span class="n">mchange</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">c3p0</span><span class="o">.</span><span class="n">ComboPooledDataSource</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">public</span> <span class="k">class</span> <span class="n">C3P0DataSourceFactory</span> <span class="k">extends</span> <span class="n">UnpooledDataSourceFactory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="n">C3P0DataSourceFactory</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">this</span><span class="o">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ComboPooledDataSource</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>为了令其工作，记得在配置文件中为每个希望 MyBatis 调用的 setter 方法增加对应的属性。 下面是一个可以连接至 PostgreSQL 数据库的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;dataSource type=&#34;org.myproject.C3P0DataSourceFactory&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;driver&#34; value=&#34;org.postgresql.Driver&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;url&#34; value=&#34;jdbc:postgresql:mydb&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;username&#34; value=&#34;postgres&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;password&#34; value=&#34;root&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/dataSource&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="数据库厂商标识databaseidprovider" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e5%8e%82%e5%95%86%e6%a0%87%e8%af%86databaseidprovider" class="header-mark"></a>数据库厂商标识（databaseIdProvider）</h4><p>MyBatis 可以根据不同的数据库厂商执行不同的语句，这种多厂商的支持是基于映射语句中的 <code>databaseId</code> 属性。 MyBatis 会加载带有匹配当前数据库 <code>databaseId</code> 属性和所有不带 <code>databaseId</code> 属性的语句。 如果同时找到带有 <code>databaseId</code> 和不带 <code>databaseId</code> 的相同语句，则后者会被舍弃。 为支持多厂商特性，只要像下面这样在 mybatis-config.xml 文件中加入 <code>databaseIdProvider</code> 即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;databaseIdProvider type=&#34;DB_VENDOR&#34; /&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>databaseIdProvider 对应的 DB_VENDOR 实现会将 databaseId 设置为 <code>DatabaseMetaData#getDatabaseProductName()</code> 返回的字符串。 由于通常情况下这些字符串都非常长，而且相同产品的不同版本会返回不同的值，你可能想通过设置属性别名来使其变短：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;databaseIdProvider type=&#34;DB_VENDOR&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;SQL Server&#34; value=&#34;sqlserver&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;DB2&#34; value=&#34;db2&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;Oracle&#34; value=&#34;oracle&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;/databaseIdProvider&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在提供了属性别名时，databaseIdProvider 的 DB_VENDOR 实现会将 databaseId 设置为数据库产品名与属性中的名称第一个相匹配的值，如果没有匹配的属性，将会设置为 “null”。 在这个例子中，如果 <code>getDatabaseProductName()</code> 返回“Oracle (DataDirect)”，databaseId 将被设置为“oracle”。</p>
<p>你可以通过实现接口 <code>org.apache.ibatis.mapping.DatabaseIdProvider</code> 并在 mybatis-config.xml 中注册来构建自己的 DatabaseIdProvider：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface DatabaseIdProvider {
</span></span><span class="line"><span class="cl">  default void setProperties(Properties p) { // 从 3.5.2 开始，该方法为默认方法
</span></span><span class="line"><span class="cl">    // 空实现
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  String getDatabaseId(DataSource dataSource) throws SQLException;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="映射器mappers" class="headerLink">
    <a href="#%e6%98%a0%e5%b0%84%e5%99%a8mappers" class="header-mark"></a>映射器（mappers）</h4><p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要来定义 SQL 映射语句了。 但首先，我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以最好的办法是直接告诉 MyBatis 到哪里去找映射文件。 你可以使用相对于类路径的资源引用，或完全限定资源定位符（包括 <code>file:///</code> 形式的 URL），或类名和包名等。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;!--</span> <span class="err">使用相对于类路径的资源引用</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">mappers</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&#34;org/mybatis/builder/AuthorMapper.xml&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&#34;org/mybatis/builder/BlogMapper.xml&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&#34;org/mybatis/builder/PostMapper.xml&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">mappers</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;!--</span> <span class="err">使用完全限定资源定位符（</span><span class="n">URL</span><span class="err">）</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">mappers</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="n">url</span><span class="o">=</span><span class="s2">&#34;file:///var/mappers/AuthorMapper.xml&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="n">url</span><span class="o">=</span><span class="s2">&#34;file:///var/mappers/BlogMapper.xml&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="n">url</span><span class="o">=</span><span class="s2">&#34;file:///var/mappers/PostMapper.xml&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">mappers</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;!--</span> <span class="err">使用映射器接口实现类的完全限定类名</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">mappers</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="k">class</span><span class="o">=</span><span class="s2">&#34;org.mybatis.builder.AuthorMapper&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="k">class</span><span class="o">=</span><span class="s2">&#34;org.mybatis.builder.BlogMapper&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">mapper</span> <span class="k">class</span><span class="o">=</span><span class="s2">&#34;org.mybatis.builder.PostMapper&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">mappers</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;!--</span> <span class="err">将包内的映射器接口实现全部注册为映射器</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">mappers</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">package</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;org.mybatis.builder&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">mappers</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这些配置会告诉 MyBatis 去哪里找映射文件，剩下的细节就应该是每个 SQL 映射文件了，也就是接下来我们要讨论的。</p>
<h3 id="xml-映射器" class="headerLink">
    <a href="#xml-%e6%98%a0%e5%b0%84%e5%99%a8" class="header-mark"></a>XML 映射器</h3><p>MyBatis 的真正强大在于它的语句映射，这是它的魔力所在。由于它的异常强大，映射器的 XML 文件就显得相对简单。如果拿它跟具有相同功能的 JDBC 代码进行对比，你会立即发现省掉了将近 95% 的代码。MyBatis 致力于减少使用成本，让用户能更专注于 SQL 代码。</p>
<p>SQL 映射文件只有很少的几个顶级元素（按照应被定义的顺序列出）：</p>
<ul>
<li><code>cache</code> – 该命名空间的缓存配置。</li>
<li><code>cache-ref</code> – 引用其它命名空间的缓存配置。</li>
<li><code>resultMap</code> – 描述如何从数据库结果集中加载对象，是最复杂也是最强大的元素。</li>
<li><code>parameterMap</code> – 老式风格的参数映射。此元素已被废弃，并可能在将来被移除！请使用行内参数映射。文档中不会介绍此元素。</li>
<li><code>sql</code> – 可被其它语句引用的可重用语句块。</li>
<li><code>insert</code> – 映射插入语句。</li>
<li><code>update</code> – 映射更新语句。</li>
<li><code>delete</code> – 映射删除语句。</li>
<li><code>select</code> – 映射查询语句。</li>
</ul>
<p>下一部分将从语句本身开始来描述每个元素的细节。</p>
<h4 id="select" class="headerLink">
    <a href="#select" class="header-mark"></a>select</h4><p>查询语句是 MyBatis 中最常用的元素之一——光能把数据存到数据库中价值并不大，还要能重新取出来才有用，多数应用也都是查询比修改要频繁。 MyBatis 的基本原则之一是：在每个插入、更新或删除操作之间，通常会执行多个查询操作。因此，MyBatis 在查询和结果映射做了相当多的改进。一个简单查询的 select 元素是非常简单的。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectPerson&#34; parameterType=&#34;int&#34; resultType=&#34;hashmap&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM PERSON WHERE ID = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个语句名为 selectPerson，接受一个 int（或 Integer）类型的参数，并返回一个 HashMap 类型的对象，其中的键是列名，值便是结果行中的对应值。</p>
<p>注意参数符号：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#{id}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这就告诉 MyBatis 创建一个预处理语句（PreparedStatement）参数，在 JDBC 中，这样的一个参数在 SQL 中会由一个“?”来标识，并被传递到一个新的预处理语句中，就像这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// 近似的 JDBC 代码，非 MyBatis 代码...
</span></span><span class="line"><span class="cl">String selectPerson = &#34;SELECT * FROM PERSON WHERE ID=?&#34;;
</span></span><span class="line"><span class="cl">PreparedStatement ps = conn.prepareStatement(selectPerson);
</span></span><span class="line"><span class="cl">ps.setInt(1,id);
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然，使用 JDBC 就意味着使用更多的代码，以便提取结果并将它们映射到对象实例中，而这就是 MyBatis 的拿手好戏。参数和结果映射的详细细节会分别在后面单独的小节中说明。</p>
<p>select 元素允许你配置很多属性来配置每条语句的行为细节。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select
</span></span><span class="line"><span class="cl">  id=&#34;selectPerson&#34;
</span></span><span class="line"><span class="cl">  parameterType=&#34;int&#34;
</span></span><span class="line"><span class="cl">  parameterMap=&#34;deprecated&#34;
</span></span><span class="line"><span class="cl">  resultType=&#34;hashmap&#34;
</span></span><span class="line"><span class="cl">  resultMap=&#34;personResultMap&#34;
</span></span><span class="line"><span class="cl">  flushCache=&#34;false&#34;
</span></span><span class="line"><span class="cl">  useCache=&#34;true&#34;
</span></span><span class="line"><span class="cl">  timeout=&#34;10&#34;
</span></span><span class="line"><span class="cl">  fetchSize=&#34;256&#34;
</span></span><span class="line"><span class="cl">  statementType=&#34;PREPARED&#34;
</span></span><span class="line"><span class="cl">  resultSetType=&#34;FORWARD_ONLY&#34;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>id</code></td>
<td style="text-align:left">在命名空间中唯一的标识符，可以被用来引用这条语句。</td>
</tr>
<tr>
<td style="text-align:left"><code>parameterType</code></td>
<td style="text-align:left">将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。</td>
</tr>
<tr>
<td style="text-align:left">parameterMap</td>
<td style="text-align:left">用于引用外部 parameterMap 的属性，目前已被废弃。请使用行内参数映射和 parameterType 属性。</td>
</tr>
<tr>
<td style="text-align:left"><code>resultType</code></td>
<td style="text-align:left">期望从这条语句中返回结果的类全限定名或别名。 注意，如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型。 resultType 和 resultMap 之间只能同时使用一个。</td>
</tr>
<tr>
<td style="text-align:left"><code>resultMap</code></td>
<td style="text-align:left">对外部 resultMap 的命名引用。结果映射是 MyBatis 最强大的特性，如果你对其理解透彻，许多复杂的映射问题都能迎刃而解。 resultType 和 resultMap 之间只能同时使用一个。</td>
</tr>
<tr>
<td style="text-align:left"><code>flushCache</code></td>
<td style="text-align:left">将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：false。</td>
</tr>
<tr>
<td style="text-align:left"><code>useCache</code></td>
<td style="text-align:left">将其设置为 true 后，将会导致本条语句的结果被二级缓存缓存起来，默认值：对 select 元素为 true。</td>
</tr>
<tr>
<td style="text-align:left"><code>timeout</code></td>
<td style="text-align:left">这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td>
</tr>
<tr>
<td style="text-align:left"><code>fetchSize</code></td>
<td style="text-align:left">这是一个给驱动的建议值，尝试让驱动程序每次批量返回的结果行数等于这个设置值。 默认值为未设置（unset）（依赖驱动）。</td>
</tr>
<tr>
<td style="text-align:left"><code>statementType</code></td>
<td style="text-align:left">可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td>
</tr>
<tr>
<td style="text-align:left"><code>resultSetType</code></td>
<td style="text-align:left">FORWARD_ONLY，SCROLL_SENSITIVE, SCROLL_INSENSITIVE 或 DEFAULT（等价于 unset） 中的一个，默认值为 unset （依赖数据库驱动）。</td>
</tr>
<tr>
<td style="text-align:left"><code>databaseId</code></td>
<td style="text-align:left">如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</td>
</tr>
<tr>
<td style="text-align:left"><code>resultOrdered</code></td>
<td style="text-align:left">这个设置仅针对嵌套结果 select 语句：如果为 true，则假设结果集以正确顺序（排序后）执行映射，当返回新的主结果行时，将不再发生对以前结果行的引用。 这样可以减少内存消耗。默认值：<code>false</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>resultSets</code></td>
<td style="text-align:left">这个设置仅适用于多结果集的情况。它将列出语句执行后返回的结果集并赋予每个结果集一个名称，多个名称之间以逗号分隔。</td>
</tr>
</tbody>
</table>
<h4 id="insert-update-和-delete" class="headerLink">
    <a href="#insert-update-%e5%92%8c-delete" class="header-mark"></a>insert, update 和 delete</h4><p>数据变更语句 insert，update 和 delete 的实现非常接近：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;insert
</span></span><span class="line"><span class="cl">  id=&#34;insertAuthor&#34;
</span></span><span class="line"><span class="cl">  parameterType=&#34;domain.blog.Author&#34;
</span></span><span class="line"><span class="cl">  flushCache=&#34;true&#34;
</span></span><span class="line"><span class="cl">  statementType=&#34;PREPARED&#34;
</span></span><span class="line"><span class="cl">  keyProperty=&#34;&#34;
</span></span><span class="line"><span class="cl">  keyColumn=&#34;&#34;
</span></span><span class="line"><span class="cl">  useGeneratedKeys=&#34;&#34;
</span></span><span class="line"><span class="cl">  timeout=&#34;20&#34;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;update
</span></span><span class="line"><span class="cl">  id=&#34;updateAuthor&#34;
</span></span><span class="line"><span class="cl">  parameterType=&#34;domain.blog.Author&#34;
</span></span><span class="line"><span class="cl">  flushCache=&#34;true&#34;
</span></span><span class="line"><span class="cl">  statementType=&#34;PREPARED&#34;
</span></span><span class="line"><span class="cl">  timeout=&#34;20&#34;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;delete
</span></span><span class="line"><span class="cl">  id=&#34;deleteAuthor&#34;
</span></span><span class="line"><span class="cl">  parameterType=&#34;domain.blog.Author&#34;
</span></span><span class="line"><span class="cl">  flushCache=&#34;true&#34;
</span></span><span class="line"><span class="cl">  statementType=&#34;PREPARED&#34;
</span></span><span class="line"><span class="cl">  timeout=&#34;20&#34;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>id</code></td>
<td style="text-align:left">在命名空间中唯一的标识符，可以被用来引用这条语句。</td>
</tr>
<tr>
<td style="text-align:left"><code>parameterType</code></td>
<td style="text-align:left">将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。</td>
</tr>
<tr>
<td style="text-align:left"><code>parameterMap</code></td>
<td style="text-align:left">用于引用外部 parameterMap 的属性，目前已被废弃。请使用行内参数映射和 parameterType 属性。</td>
</tr>
<tr>
<td style="text-align:left"><code>flushCache</code></td>
<td style="text-align:left">将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：（对 insert、update 和 delete 语句）true。</td>
</tr>
<tr>
<td style="text-align:left"><code>timeout</code></td>
<td style="text-align:left">这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td>
</tr>
<tr>
<td style="text-align:left"><code>statementType</code></td>
<td style="text-align:left">可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td>
</tr>
<tr>
<td style="text-align:left"><code>useGeneratedKeys</code></td>
<td style="text-align:left">（仅适用于 insert 和 update）这会令 MyBatis 使用 JDBC 的 getGeneratedKeys 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server 这样的关系型数据库管理系统的自动递增字段），默认值：false。</td>
</tr>
<tr>
<td style="text-align:left"><code>keyProperty</code></td>
<td style="text-align:left">（仅适用于 insert 和 update）指定能够唯一识别对象的属性，MyBatis 会使用 getGeneratedKeys 的返回值或 insert 语句的 selectKey 子元素设置它的值，默认值：未设置（<code>unset</code>）。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td style="text-align:left"><code>keyColumn</code></td>
<td style="text-align:left">（仅适用于 insert 和 update）设置生成键值在表中的列名，在某些数据库（像 PostgreSQL）中，当主键列不是表中的第一列的时候，是必须设置的。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td style="text-align:left"><code>databaseId</code></td>
<td style="text-align:left">如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</td>
</tr>
</tbody>
</table>
<p>下面是 insert，update 和 delete 语句的示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;insert id=&#34;insertAuthor&#34;&gt;
</span></span><span class="line"><span class="cl">  insert into Author (id,username,password,email,bio)
</span></span><span class="line"><span class="cl">  values (#{id},#{username},#{password},#{email},#{bio})
</span></span><span class="line"><span class="cl">&lt;/insert&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;update id=&#34;updateAuthor&#34;&gt;
</span></span><span class="line"><span class="cl">  update Author set
</span></span><span class="line"><span class="cl">    username = #{username},
</span></span><span class="line"><span class="cl">    password = #{password},
</span></span><span class="line"><span class="cl">    email = #{email},
</span></span><span class="line"><span class="cl">    bio = #{bio}
</span></span><span class="line"><span class="cl">  where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/update&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;delete id=&#34;deleteAuthor&#34;&gt;
</span></span><span class="line"><span class="cl">  delete from Author where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/delete&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如前所述，插入语句的配置规则更加丰富，在插入语句里面有一些额外的属性和子元素用来处理主键的生成，并且提供了多种生成方式。</p>
<p>首先，如果你的数据库支持自动生成主键的字段（比如 MySQL 和 SQL Server），那么你可以设置 useGeneratedKeys=”true”，然后再把 keyProperty 设置为目标属性就 OK 了。例如，如果上面的 Author 表已经在 id 列上使用了自动生成，那么语句可以修改为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;insert id=&#34;insertAuthor&#34; useGeneratedKeys=&#34;true&#34;
</span></span><span class="line"><span class="cl">    keyProperty=&#34;id&#34;&gt;
</span></span><span class="line"><span class="cl">  insert into Author (username,password,email,bio)
</span></span><span class="line"><span class="cl">  values (#{username},#{password},#{email},#{bio})
</span></span><span class="line"><span class="cl">&lt;/insert&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果你的数据库还支持多行插入, 你也可以传入一个 <code>Author</code> 数组或集合，并返回自动生成的主键。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;insert id=&#34;insertAuthor&#34; useGeneratedKeys=&#34;true&#34;
</span></span><span class="line"><span class="cl">    keyProperty=&#34;id&#34;&gt;
</span></span><span class="line"><span class="cl">  insert into Author (username, password, email, bio) values
</span></span><span class="line"><span class="cl">  &lt;foreach item=&#34;item&#34; collection=&#34;list&#34; separator=&#34;,&#34;&gt;
</span></span><span class="line"><span class="cl">    (#{item.username}, #{item.password}, #{item.email}, #{item.bio})
</span></span><span class="line"><span class="cl">  &lt;/foreach&gt;
</span></span><span class="line"><span class="cl">&lt;/insert&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于不支持自动生成主键列的数据库和可能不支持自动生成主键的 JDBC 驱动，MyBatis 有另外一种方法来生成主键。</p>
<p>这里有一个简单（也很傻）的示例，它可以生成一个随机 ID（不建议实际使用，这里只是为了展示 MyBatis 处理问题的灵活性和宽容度）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;insert id=&#34;insertAuthor&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;selectKey keyProperty=&#34;id&#34; resultType=&#34;int&#34; order=&#34;BEFORE&#34;&gt;
</span></span><span class="line"><span class="cl">    select CAST(RANDOM()*1000000 as INTEGER) a from SYSIBM.SYSDUMMY1
</span></span><span class="line"><span class="cl">  &lt;/selectKey&gt;
</span></span><span class="line"><span class="cl">  insert into Author
</span></span><span class="line"><span class="cl">    (id, username, password, email,bio, favourite_section)
</span></span><span class="line"><span class="cl">  values
</span></span><span class="line"><span class="cl">    (#{id}, #{username}, #{password}, #{email}, #{bio}, #{favouriteSection,jdbcType=VARCHAR})
</span></span><span class="line"><span class="cl">&lt;/insert&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在上面的示例中，首先会运行 selectKey 元素中的语句，并设置 Author 的 id，然后才会调用插入语句。这样就实现了数据库自动生成主键类似的行为，同时保持了 Java 代码的简洁。</p>
<p>selectKey 元素描述如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;selectKey
</span></span><span class="line"><span class="cl">  keyProperty=&#34;id&#34;
</span></span><span class="line"><span class="cl">  resultType=&#34;int&#34;
</span></span><span class="line"><span class="cl">  order=&#34;BEFORE&#34;
</span></span><span class="line"><span class="cl">  statementType=&#34;PREPARED&#34;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>keyProperty</code></td>
<td style="text-align:left"><code>selectKey</code> 语句结果应该被设置到的目标属性。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td style="text-align:left"><code>keyColumn</code></td>
<td style="text-align:left">返回结果集中生成列属性的列名。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td style="text-align:left"><code>resultType</code></td>
<td style="text-align:left">结果的类型。通常 MyBatis 可以推断出来，但是为了更加准确，写上也不会有什么问题。MyBatis 允许将任何简单类型用作主键的类型，包括字符串。如果生成列不止一个，则可以使用包含期望属性的 Object 或 Map。</td>
</tr>
<tr>
<td style="text-align:left"><code>order</code></td>
<td style="text-align:left">可以设置为 <code>BEFORE</code> 或 <code>AFTER</code>。如果设置为 <code>BEFORE</code>，那么它首先会生成主键，设置 <code>keyProperty</code> 再执行插入语句。如果设置为 <code>AFTER</code>，那么先执行插入语句，然后是 <code>selectKey</code> 中的语句 - 这和 Oracle 数据库的行为相似，在插入语句内部可能有嵌入索引调用。</td>
</tr>
<tr>
<td style="text-align:left"><code>statementType</code></td>
<td style="text-align:left">和前面一样，MyBatis 支持 <code>STATEMENT</code>，<code>PREPARED</code> 和 <code>CALLABLE</code> 类型的映射语句，分别代表 <code>Statement</code>, <code>PreparedStatement</code> 和 <code>CallableStatement</code> 类型。</td>
</tr>
</tbody>
</table>
<h4 id="sql" class="headerLink">
    <a href="#sql" class="header-mark"></a>sql</h4><p>这个元素可以用来定义可重用的 SQL 代码片段，以便在其它语句中使用。 参数可以静态地（在加载的时候）确定下来，并且可以在不同的 include 元素中定义不同的参数值。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;sql id=&#34;userColumns&#34;&gt; ${alias}.id,${alias}.username,${alias}.password &lt;/sql&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个 SQL 片段可以在其它语句中使用，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectUsers&#34; resultType=&#34;map&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">    &lt;include refid=&#34;userColumns&#34;&gt;&lt;property name=&#34;alias&#34; value=&#34;t1&#34;/&gt;&lt;/include&gt;,
</span></span><span class="line"><span class="cl">    &lt;include refid=&#34;userColumns&#34;&gt;&lt;property name=&#34;alias&#34; value=&#34;t2&#34;/&gt;&lt;/include&gt;
</span></span><span class="line"><span class="cl">  from some_table t1
</span></span><span class="line"><span class="cl">    cross join some_table t2
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>也可以在 include 元素的 refid 属性或内部语句中使用属性值，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;sql id=&#34;sometable&#34;&gt;
</span></span><span class="line"><span class="cl">  ${prefix}Table
</span></span><span class="line"><span class="cl">&lt;/sql&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;sql id=&#34;someinclude&#34;&gt;
</span></span><span class="line"><span class="cl">  from
</span></span><span class="line"><span class="cl">    &lt;include refid=&#34;${include_target}&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/sql&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;select id=&#34;select&#34; resultType=&#34;map&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">    field1, field2, field3
</span></span><span class="line"><span class="cl">  &lt;include refid=&#34;someinclude&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;property name=&#34;prefix&#34; value=&#34;Some&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;property name=&#34;include_target&#34; value=&#34;sometable&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;/include&gt;
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="参数" class="headerLink">
    <a href="#%e5%8f%82%e6%95%b0" class="header-mark"></a>参数</h4><p>之前见到的所有语句都使用了简单的参数形式。但实际上，参数是 MyBatis 非常强大的元素。对于大多数简单的使用场景，你都不需要使用复杂的参数，比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectUsers&#34; resultType=&#34;User&#34;&gt;
</span></span><span class="line"><span class="cl">  select id, username, password
</span></span><span class="line"><span class="cl">  from users
</span></span><span class="line"><span class="cl">  where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的这个示例说明了一个非常简单的命名参数映射。鉴于参数类型（parameterType）会被自动设置为 <code>int</code>，这个参数可以随意命名。原始类型或简单数据类型（比如 <code>Integer</code> 和 <code>String</code>）因为没有其它属性，会用它们的值来作为参数。 然而，如果传入一个复杂的对象，行为就会有点不一样了。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;insert id=&#34;insertUser&#34; parameterType=&#34;User&#34;&gt;
</span></span><span class="line"><span class="cl">  insert into users (id, username, password)
</span></span><span class="line"><span class="cl">  values (#{id}, #{username}, #{password})
</span></span><span class="line"><span class="cl">&lt;/insert&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果 User 类型的参数对象传递到了语句中，会查找 id、username 和 password 属性，然后将它们的值传入预处理语句的参数中。</p>
<p>对传递语句参数来说，这种方式真是干脆利落。不过参数映射的功能远不止于此。</p>
<p>首先，和 MyBatis 的其它部分一样，参数也可以指定一个特殊的数据类型。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#{property,javaType=int,jdbcType=NUMERIC}
</span></span></code></pre></td></tr></table>
</div>
</div><p>和 MyBatis 的其它部分一样，几乎总是可以根据参数对象的类型确定 javaType，除非该对象是一个 <code>HashMap</code>。这个时候，你需要显式指定 <code>javaType</code> 来确保正确的类型处理器（<code>TypeHandler</code>）被使用。</p>
<p><strong>提示</strong> JDBC 要求，如果一个列允许使用 null 值，并且会使用值为 null 的参数，就必须要指定 JDBC 类型（jdbcType）。阅读 <code>PreparedStatement.setNull()</code>的 JavaDoc 来获取更多信息。</p>
<p>要更进一步地自定义类型处理方式，可以指定一个特殊的类型处理器类（或别名），比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#{age,javaType=int,jdbcType=NUMERIC,typeHandler=MyTypeHandler}
</span></span></code></pre></td></tr></table>
</div>
</div><p>参数的配置好像越来越繁琐了，但实际上，很少需要如此繁琐的配置。</p>
<p>对于数值类型，还可以设置 <code>numericScale</code> 指定小数点后保留的位数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#{height,javaType=double,jdbcType=NUMERIC,numericScale=2}
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后，mode 属性允许你指定 <code>IN</code>，<code>OUT</code> 或 <code>INOUT</code> 参数。如果参数的 <code>mode</code> 为 <code>OUT</code> 或 <code>INOUT</code>，将会修改参数对象的属性值，以便作为输出参数返回。 如果 <code>mode</code> 为 <code>OUT</code>（或 <code>INOUT</code>），而且 <code>jdbcType</code> 为 <code>CURSOR</code>（也就是 Oracle 的 REFCURSOR），你必须指定一个 <code>resultMap</code> 引用来将结果集 <code>ResultSet</code> 映射到参数的类型上。要注意这里的 <code>javaType</code> 属性是可选的，如果留空并且 jdbcType 是 <code>CURSOR</code>，它会被自动地被设为 <code>ResultSet</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#{department, mode=OUT, jdbcType=CURSOR, javaType=ResultSet, resultMap=departmentResultMap}
</span></span></code></pre></td></tr></table>
</div>
</div><p>MyBatis 也支持很多高级的数据类型，比如结构体（structs），但是当使用 out 参数时，你必须显式设置类型的名称。比如（再次提示，在实际中要像这样不能换行）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#{middleInitial, mode=OUT, jdbcType=STRUCT, jdbcTypeName=MY_TYPE, resultMap=departmentResultMap}
</span></span></code></pre></td></tr></table>
</div>
</div><p>尽管上面这些选项很强大，但大多时候，你只须简单指定属性名，顶多要为可能为空的列指定 <code>jdbcType</code>，其他的事情交给 MyBatis 自己去推断就行了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#{firstName}
</span></span><span class="line"><span class="cl">#{middleInitial,jdbcType=VARCHAR}
</span></span><span class="line"><span class="cl">#{lastName}
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="字符串替换" class="headerLink">
    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%9b%bf%e6%8d%a2" class="header-mark"></a>字符串替换</h5><p>默认情况下，使用 <code>#{}</code> 参数语法时，MyBatis 会创建 <code>PreparedStatement</code> 参数占位符，并通过占位符安全地设置参数（就像使用 ? 一样）。 这样做更安全，更迅速，通常也是首选做法，不过有时你就是想直接在 SQL 语句中直接插入一个不转义的字符串。 比如 ORDER BY 子句，这时候你可以：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ORDER BY ${columnName}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样，MyBatis 就不会修改或转义该字符串了。</p>
<p>当 SQL 语句中的元数据（如表名或列名）是动态生成的时候，字符串替换将会非常有用。 举个例子，如果你想 <code>select</code> 一个表任意一列的数据时，不需要这样写：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Select(&#34;select * from user where id = #{id}&#34;)
</span></span><span class="line"><span class="cl">User findById(@Param(&#34;id&#34;) long id);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@Select(&#34;select * from user where name = #{name}&#34;)
</span></span><span class="line"><span class="cl">User findByName(@Param(&#34;name&#34;) String name);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@Select(&#34;select * from user where email = #{email}&#34;)
</span></span><span class="line"><span class="cl">User findByEmail(@Param(&#34;email&#34;) String email);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// 其它的 &#34;findByXxx&#34; 方法
</span></span></code></pre></td></tr></table>
</div>
</div><p>而是可以只写这样一个方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Select(&#34;select * from user where ${column} = #{value}&#34;)
</span></span><span class="line"><span class="cl">User findByColumn(@Param(&#34;column&#34;) String column, @Param(&#34;value&#34;) String value);
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中 <code>${column}</code> 会被直接替换，而 <code>#{value}</code> 会使用 <code>?</code> 预处理。 这样，就能完成同样的任务：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">User userOfId1 = userMapper.findByColumn(&#34;id&#34;, 1L);
</span></span><span class="line"><span class="cl">User userOfNameKid = userMapper.findByColumn(&#34;name&#34;, &#34;kid&#34;);
</span></span><span class="line"><span class="cl">User userOfEmail = userMapper.findByColumn(&#34;email&#34;, &#34;noone@nowhere.com&#34;);
</span></span></code></pre></td></tr></table>
</div>
</div><p>这种方式也同样适用于替换表名的情况。</p>
<p><strong>提示</strong> 用这种方式接受用户的输入，并用作语句参数是不安全的，会导致潜在的 SQL 注入攻击。因此，要么不允许用户输入这些字段，要么自行转义并检验这些参数。</p>
<h4 id="结果映射" class="headerLink">
    <a href="#%e7%bb%93%e6%9e%9c%e6%98%a0%e5%b0%84" class="header-mark"></a>结果映射</h4><p><code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素。它可以让你从 90% 的 JDBC <code>ResultSets</code> 数据提取代码中解放出来，并在一些情形下允许你进行一些 JDBC 不支持的操作。实际上，在为一些比如连接的复杂语句编写映射代码的时候，一份 <code>resultMap</code> 能够代替实现同等功能的数千行代码。ResultMap 的设计思想是，对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之间的关系就行了。</p>
<p>之前你已经见过简单映射语句的示例，它们没有显式指定 <code>resultMap</code>。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectUsers&#34; resultType=&#34;map&#34;&gt;
</span></span><span class="line"><span class="cl">  select id, username, hashedPassword
</span></span><span class="line"><span class="cl">  from some_table
</span></span><span class="line"><span class="cl">  where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述语句只是简单地将所有的列映射到 <code>HashMap</code> 的键上，这由 <code>resultType</code> 属性指定。虽然在大部分情况下都够用，但是 HashMap 并不是一个很好的领域模型。你的程序更可能会使用 JavaBean 或 POJO（Plain Old Java Objects，普通老式 Java 对象）作为领域模型。MyBatis 对两者都提供了支持。看看下面这个 JavaBean：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">com</span><span class="p">.</span><span class="nx">someapp</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">public</span> <span class="nx">class</span> <span class="nx">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">private</span> <span class="kt">int</span> <span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">private</span> <span class="nx">String</span> <span class="nx">username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">private</span> <span class="nx">String</span> <span class="nx">hashedPassword</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">public</span> <span class="nx">void</span> <span class="nf">setId</span><span class="p">(</span><span class="kt">int</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">this</span><span class="p">.</span><span class="nx">id</span> <span class="p">=</span> <span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">public</span> <span class="nx">String</span> <span class="nf">getUsername</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">public</span> <span class="nx">void</span> <span class="nf">setUsername</span><span class="p">(</span><span class="nx">String</span> <span class="nx">username</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">this</span><span class="p">.</span><span class="nx">username</span> <span class="p">=</span> <span class="nx">username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">public</span> <span class="nx">String</span> <span class="nf">getHashedPassword</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">hashedPassword</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">public</span> <span class="nx">void</span> <span class="nf">setHashedPassword</span><span class="p">(</span><span class="nx">String</span> <span class="nx">hashedPassword</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">this</span><span class="p">.</span><span class="nx">hashedPassword</span> <span class="p">=</span> <span class="nx">hashedPassword</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>基于 JavaBean 的规范，上面这个类有 3 个属性：id，username 和 hashedPassword。这些属性会对应到 select 语句中的列名。</p>
<p>这样的一个 JavaBean 可以被映射到 <code>ResultSet</code>，就像映射到 <code>HashMap</code> 一样简单。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectUsers&#34; resultType=&#34;com.someapp.model.User&#34;&gt;
</span></span><span class="line"><span class="cl">  select id, username, hashedPassword
</span></span><span class="line"><span class="cl">  from some_table
</span></span><span class="line"><span class="cl">  where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>类型别名是你的好帮手。使用它们，你就可以不用输入类的全限定名了。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!-- mybatis-config.xml 中 --&gt;
</span></span><span class="line"><span class="cl">&lt;typeAlias type=&#34;com.someapp.model.User&#34; alias=&#34;User&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;!-- SQL 映射 XML 中 --&gt;
</span></span><span class="line"><span class="cl">&lt;select id=&#34;selectUsers&#34; resultType=&#34;User&#34;&gt;
</span></span><span class="line"><span class="cl">  select id, username, hashedPassword
</span></span><span class="line"><span class="cl">  from some_table
</span></span><span class="line"><span class="cl">  where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这些情况下，MyBatis 会在幕后自动创建一个 <code>ResultMap</code>，再根据属性名来映射列到 JavaBean 的属性上。如果列名和属性名不能匹配上，可以在 SELECT 语句中设置列别名（这是一个基本的 SQL 特性）来完成匹配。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectUsers&#34; resultType=&#34;User&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">    user_id             as &#34;id&#34;,
</span></span><span class="line"><span class="cl">    user_name           as &#34;userName&#34;,
</span></span><span class="line"><span class="cl">    hashed_password     as &#34;hashedPassword&#34;
</span></span><span class="line"><span class="cl">  from some_table
</span></span><span class="line"><span class="cl">  where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在学习了上面的知识后，你会发现上面的例子没有一个需要显式配置 <code>ResultMap</code>，这就是 <code>ResultMap</code> 的优秀之处——你完全可以不用显式地配置它们。 虽然上面的例子不用显式配置 <code>ResultMap</code>。 但为了讲解，我们来看看如果在刚刚的示例中，显式使用外部的 <code>resultMap</code> 会怎样，这也是解决列名不匹配的另外一种方式。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;userResultMap&#34; type=&#34;User&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;user_id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;username&#34; column=&#34;user_name&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;password&#34; column=&#34;hashed_password&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后在引用它的语句中设置 <code>resultMap</code> 属性就行了（注意我们去掉了 <code>resultType</code> 属性）。比如:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectUsers&#34; resultMap=&#34;userResultMap&#34;&gt;
</span></span><span class="line"><span class="cl">  select user_id, user_name, hashed_password
</span></span><span class="line"><span class="cl">  from some_table
</span></span><span class="line"><span class="cl">  where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果这个世界总是这么简单就好了。</p>
<h5 id="高级结果映射" class="headerLink">
    <a href="#%e9%ab%98%e7%ba%a7%e7%bb%93%e6%9e%9c%e6%98%a0%e5%b0%84" class="header-mark"></a>高级结果映射</h5><p>MyBatis 创建时的一个思想是：数据库不可能永远是你所想或所需的那个样子。 我们希望每个数据库都具备良好的第三范式或 BCNF 范式，可惜它们并不都是那样。 如果能有一种数据库映射模式，完美适配所有的应用程序，那就太好了，但可惜也没有。 而 ResultMap 就是 MyBatis 对这个问题的答案。</p>
<p>比如，我们如何映射下面这个语句？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!-- 非常复杂的语句 --&gt;
</span></span><span class="line"><span class="cl">&lt;select id=&#34;selectBlogDetails&#34; resultMap=&#34;detailedBlogResultMap&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">       B.id as blog_id,
</span></span><span class="line"><span class="cl">       B.title as blog_title,
</span></span><span class="line"><span class="cl">       B.author_id as blog_author_id,
</span></span><span class="line"><span class="cl">       A.id as author_id,
</span></span><span class="line"><span class="cl">       A.username as author_username,
</span></span><span class="line"><span class="cl">       A.password as author_password,
</span></span><span class="line"><span class="cl">       A.email as author_email,
</span></span><span class="line"><span class="cl">       A.bio as author_bio,
</span></span><span class="line"><span class="cl">       A.favourite_section as author_favourite_section,
</span></span><span class="line"><span class="cl">       P.id as post_id,
</span></span><span class="line"><span class="cl">       P.blog_id as post_blog_id,
</span></span><span class="line"><span class="cl">       P.author_id as post_author_id,
</span></span><span class="line"><span class="cl">       P.created_on as post_created_on,
</span></span><span class="line"><span class="cl">       P.section as post_section,
</span></span><span class="line"><span class="cl">       P.subject as post_subject,
</span></span><span class="line"><span class="cl">       P.draft as draft,
</span></span><span class="line"><span class="cl">       P.body as post_body,
</span></span><span class="line"><span class="cl">       C.id as comment_id,
</span></span><span class="line"><span class="cl">       C.post_id as comment_post_id,
</span></span><span class="line"><span class="cl">       C.name as comment_name,
</span></span><span class="line"><span class="cl">       C.comment as comment_text,
</span></span><span class="line"><span class="cl">       T.id as tag_id,
</span></span><span class="line"><span class="cl">       T.name as tag_name
</span></span><span class="line"><span class="cl">  from Blog B
</span></span><span class="line"><span class="cl">       left outer join Author A on B.author_id = A.id
</span></span><span class="line"><span class="cl">       left outer join Post P on B.id = P.blog_id
</span></span><span class="line"><span class="cl">       left outer join Comment C on P.id = C.post_id
</span></span><span class="line"><span class="cl">       left outer join Post_Tag PT on PT.post_id = P.id
</span></span><span class="line"><span class="cl">       left outer join Tag T on PT.tag_id = T.id
</span></span><span class="line"><span class="cl">  where B.id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>你可能想把它映射到一个智能的对象模型，这个对象表示了一篇博客，它由某位作者所写，有很多的博文，每篇博文有零或多条的评论和标签。 我们先来看看下面这个完整的例子，它是一个非常复杂的结果映射（假设作者，博客，博文，评论和标签都是类型别名）。 不用紧张，我们会一步一步地来说明。虽然它看起来令人望而生畏，但其实非常简单。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;!--</span> <span class="err">非常复杂的结果映射</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">resultMap</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;detailedBlogResultMap&#34;</span> <span class="n">type</span><span class="o">=</span><span class="s2">&#34;Blog&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">constructor</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">idArg</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;blog_id&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;int&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;/</span><span class="n">constructor</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">result</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;title&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;blog_title&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">association</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;author&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;Author&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">id</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;id&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;author_id&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">result</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;username&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;author_username&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">result</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;password&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;author_password&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">result</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;email&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;author_email&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">result</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;bio&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;author_bio&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">result</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;favouriteSection&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;author_favourite_section&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;/</span><span class="n">association</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">collection</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;posts&#34;</span> <span class="n">ofType</span><span class="o">=</span><span class="s2">&#34;Post&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">id</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;id&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;post_id&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">result</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;subject&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;post_subject&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">association</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;author&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;Author&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">collection</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;comments&#34;</span> <span class="n">ofType</span><span class="o">=</span><span class="s2">&#34;Comment&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="n">id</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;id&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;comment_id&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">collection</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">collection</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;tags&#34;</span> <span class="n">ofType</span><span class="o">=</span><span class="s2">&#34;Tag&#34;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="n">id</span> <span class="n">property</span><span class="o">=</span><span class="s2">&#34;id&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;tag_id&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">collection</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">discriminator</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;int&#34;</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;draft&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="k">case</span> <span class="n">value</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="n">resultType</span><span class="o">=</span><span class="s2">&#34;DraftPost&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">discriminator</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;/</span><span class="n">collection</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">resultMap</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>resultMap</code> 元素有很多子元素和一个值得深入探讨的结构。 下面是<code>resultMap</code> 元素的概念视图。</p>
<h5 id="结果映射resultmap" class="headerLink">
    <a href="#%e7%bb%93%e6%9e%9c%e6%98%a0%e5%b0%84resultmap" class="header-mark"></a>结果映射（resultMap）</h5><ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">constructor</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>- 用于在实例化类时，注入结果到构造方法中</p>
<ul>
<li><code>idArg</code> - ID 参数；标记出作为 ID 的结果可以帮助提高整体性能</li>
<li><code>arg</code> - 将被注入到构造方法的一个普通结果</li>
</ul>
</li>
<li>
<p><code>id</code> – 一个 ID 结果；标记出作为 ID 的结果可以帮助提高整体性能</p>
</li>
<li>
<p><code>result</code> – 注入到字段或 JavaBean 属性的普通结果</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">association
</span></span></code></pre></td></tr></table>
</div>
</div><p>– 一个复杂类型的关联；许多结果将包装成这种类型</p>
<ul>
<li>嵌套结果映射 – 关联可以是 <code>resultMap</code> 元素，或是对其它结果映射的引用</li>
</ul>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">collection
</span></span></code></pre></td></tr></table>
</div>
</div><p>– 一个复杂类型的集合</p>
<ul>
<li>嵌套结果映射 – 集合可以是 <code>resultMap</code> 元素，或是对其它结果映射的引用</li>
</ul>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">discriminator
</span></span></code></pre></td></tr></table>
</div>
</div><p>– 使用结果值来决定使用哪个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">resultMap
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">case
</span></span></code></pre></td></tr></table>
</div>
</div><p>– 基于某些值的结果映射</p>
<ul>
<li>嵌套结果映射 – <code>case</code> 也是一个结果映射，因此具有相同的结构和元素；或者引用其它的结果映射</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>id</code></td>
<td style="text-align:left">当前命名空间中的一个唯一标识，用于标识一个结果映射。</td>
</tr>
<tr>
<td style="text-align:left"><code>type</code></td>
<td style="text-align:left">类的完全限定名, 或者一个类型别名（关于内置的类型别名，可以参考上面的表格）。</td>
</tr>
<tr>
<td style="text-align:left"><code>autoMapping</code></td>
<td style="text-align:left">如果设置这个属性，MyBatis 将会为本结果映射开启或者关闭自动映射。 这个属性会覆盖全局的属性 autoMappingBehavior。默认值：未设置（unset）。</td>
</tr>
</tbody>
</table>
<p><strong>最佳实践</strong> 最好逐步建立结果映射。单元测试可以在这个过程中起到很大帮助。 如果你尝试一次性创建像上面示例那么巨大的结果映射，不仅容易出错，难度也会直线上升。 所以，从最简单的形态开始，逐步迭代。而且别忘了单元测试！ 有时候，框架的行为像是一个黑盒子（无论是否开源）。因此，为了确保实现的行为与你的期望相一致，最好编写单元测试。 并且单元测试在提交 bug 时也能起到很大的作用。</p>
<p>下一部分将详细说明每个元素。</p>
<h5 id="id--result" class="headerLink">
    <a href="#id--result" class="header-mark"></a>id &amp; result</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;id property=&#34;id&#34; column=&#34;post_id&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;result property=&#34;subject&#34; column=&#34;post_subject&#34;/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这些元素是结果映射的基础。<em>id</em> 和 <em>result</em> 元素都将一个列的值映射到一个简单数据类型（String, int, double, Date 等）的属性或字段。</p>
<p>这两者之间的唯一不同是，<em>id</em> 元素对应的属性会被标记为对象的标识符，在比较对象实例时使用。 这样可以提高整体的性能，尤其是进行缓存和嵌套结果映射（也就是连接映射）的时候。</p>
<p>两个元素都有一些属性：</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>property</code></td>
<td style="text-align:left">映射到列结果的字段或属性。如果 JavaBean 有这个名字的属性（property），会先使用该属性。否则 MyBatis 将会寻找给定名称的字段（field）。 无论是哪一种情形，你都可以使用常见的点式分隔形式进行复杂属性导航。 比如，你可以这样映射一些简单的东西：“username”，或者映射到一些复杂的东西上：“address.street.number”。</td>
</tr>
<tr>
<td style="text-align:left"><code>column</code></td>
<td style="text-align:left">数据库中的列名，或者是列的别名。一般情况下，这和传递给 <code>resultSet.getString(columnName)</code> 方法的参数一样。</td>
</tr>
<tr>
<td style="text-align:left"><code>javaType</code></td>
<td style="text-align:left">一个 Java 类的全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</td>
</tr>
<tr>
<td style="text-align:left"><code>jdbcType</code></td>
<td style="text-align:left">JDBC 类型，所支持的 JDBC 类型参见这个表格之后的“支持的 JDBC 类型”。 只需要在可能执行插入、更新和删除的且允许空值的列上指定 JDBC 类型。这是 JDBC 的要求而非 MyBatis 的要求。如果你直接面向 JDBC 编程，你需要对可以为空值的列指定这个类型。</td>
</tr>
<tr>
<td style="text-align:left"><code>typeHandler</code></td>
<td style="text-align:left">我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的全限定名，或者是类型别名。</td>
</tr>
</tbody>
</table>
<h5 id="支持的-jdbc-类型" class="headerLink">
    <a href="#%e6%94%af%e6%8c%81%e7%9a%84-jdbc-%e7%b1%bb%e5%9e%8b" class="header-mark"></a>支持的 JDBC 类型</h5><p>为了以后可能的使用场景，MyBatis 通过内置的 jdbcType 枚举类型支持下面的 JDBC 类型。</p>
<table>
<thead>
<tr>
<th><code>BIT</code></th>
<th><code>FLOAT</code></th>
<th><code>CHAR</code></th>
<th><code>TIMESTAMP</code></th>
<th><code>OTHER</code></th>
<th><code>UNDEFINED</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TINYINT</code></td>
<td><code>REAL</code></td>
<td><code>VARCHAR</code></td>
<td><code>BINARY</code></td>
<td><code>BLOB</code></td>
<td><code>NVARCHAR</code></td>
</tr>
<tr>
<td><code>SMALLINT</code></td>
<td><code>DOUBLE</code></td>
<td><code>LONGVARCHAR</code></td>
<td><code>VARBINARY</code></td>
<td><code>CLOB</code></td>
<td><code>NCHAR</code></td>
</tr>
<tr>
<td><code>INTEGER</code></td>
<td><code>NUMERIC</code></td>
<td><code>DATE</code></td>
<td><code>LONGVARBINARY</code></td>
<td><code>BOOLEAN</code></td>
<td><code>NCLOB</code></td>
</tr>
<tr>
<td><code>BIGINT</code></td>
<td><code>DECIMAL</code></td>
<td><code>TIME</code></td>
<td><code>NULL</code></td>
<td><code>CURSOR</code></td>
<td><code>ARRAY</code></td>
</tr>
</tbody>
</table>
<h5 id="构造方法" class="headerLink">
    <a href="#%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95" class="header-mark"></a>构造方法</h5><p>通过修改对象属性的方式，可以满足大多数的数据传输对象（Data Transfer Object, DTO）以及绝大部分领域模型的要求。但有些情况下你想使用不可变类。 一般来说，很少改变或基本不变的包含引用或数据的表，很适合使用不可变类。 构造方法注入允许你在初始化时为类设置属性的值，而不用暴露出公有方法。MyBatis 也支持私有属性和私有 JavaBean 属性来完成注入，但有一些人更青睐于通过构造方法进行注入。 <em>constructor</em> 元素就是为此而生的。</p>
<p>看看下面这个构造方法:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public class User {
</span></span><span class="line"><span class="cl">   //...
</span></span><span class="line"><span class="cl">   public User(Integer id, String username, int age) {
</span></span><span class="line"><span class="cl">     //...
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">//...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>为了将结果注入构造方法，MyBatis 需要通过某种方式定位相应的构造方法。 在下面的例子中，MyBatis 搜索一个声明了三个形参的构造方法，参数类型以 <code>java.lang.Integer</code>, <code>java.lang.String</code> 和 <code>int</code> 的顺序给出。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">constructor</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">idArg</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;id&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;int&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">arg</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;username&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;String&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">arg</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;age&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;_int&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">constructor</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当你在处理一个带有多个形参的构造方法时，很容易搞乱 arg 元素的顺序。 从版本 3.4.3 开始，可以在指定参数名称的前提下，以任意顺序编写 arg 元素。 为了通过名称来引用构造方法参数，你可以添加 <code>@Param</code> 注解，或者使用 &lsquo;-parameters&rsquo; 编译选项并启用 <code>useActualParamName</code> 选项（默认开启）来编译项目。下面是一个等价的例子，尽管函数签名中第二和第三个形参的顺序与 constructor 元素中参数声明的顺序不匹配。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">constructor</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">idArg</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;id&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;int&#34;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;id&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">arg</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;age&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;_int&#34;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;age&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">arg</span> <span class="n">column</span><span class="o">=</span><span class="s2">&#34;username&#34;</span> <span class="n">javaType</span><span class="o">=</span><span class="s2">&#34;String&#34;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;username&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">constructor</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果存在名称和类型相同的属性，那么可以省略 <code>javaType</code> 。</p>
<p>剩余的属性和规则和普通的 id 和 result 元素是一样的。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>column</code></td>
<td style="text-align:left">数据库中的列名，或者是列的别名。一般情况下，这和传递给 <code>resultSet.getString(columnName)</code> 方法的参数一样。</td>
</tr>
<tr>
<td style="text-align:left"><code>javaType</code></td>
<td style="text-align:left">一个 Java 类的完全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</td>
</tr>
<tr>
<td style="text-align:left"><code>jdbcType</code></td>
<td style="text-align:left">JDBC 类型，所支持的 JDBC 类型参见这个表格之前的“支持的 JDBC 类型”。 只需要在可能执行插入、更新和删除的且允许空值的列上指定 JDBC 类型。这是 JDBC 的要求而非 MyBatis 的要求。如果你直接面向 JDBC 编程，你需要对可能存在空值的列指定这个类型。</td>
</tr>
<tr>
<td style="text-align:left"><code>typeHandler</code></td>
<td style="text-align:left">我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的完全限定名，或者是类型别名。</td>
</tr>
<tr>
<td style="text-align:left"><code>select</code></td>
<td style="text-align:left">用于加载复杂类型属性的映射语句的 ID，它会从 column 属性中指定的列检索数据，作为参数传递给此 select 语句。具体请参考关联元素。</td>
</tr>
<tr>
<td style="text-align:left"><code>resultMap</code></td>
<td style="text-align:left">结果映射的 ID，可以将嵌套的结果集映射到一个合适的对象树中。 它可以作为使用额外 select 语句的替代方案。它可以将多表连接操作的结果映射成一个单一的 <code>ResultSet</code>。这样的 <code>ResultSet</code> 将会将包含重复或部分数据重复的结果集。为了将结果集正确地映射到嵌套的对象树中，MyBatis 允许你 “串联”结果映射，以便解决嵌套结果集的问题。想了解更多内容，请参考下面的关联元素。</td>
</tr>
<tr>
<td style="text-align:left"><code>name</code></td>
<td style="text-align:left">构造方法形参的名字。从 3.4.3 版本开始，通过指定具体的参数名，你可以以任意顺序写入 arg 元素。参看上面的解释。</td>
</tr>
</tbody>
</table>
<h5 id="关联" class="headerLink">
    <a href="#%e5%85%b3%e8%81%94" class="header-mark"></a>关联</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;association property=&#34;author&#34; column=&#34;blog_author_id&#34; javaType=&#34;Author&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;author_id&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;username&#34; column=&#34;author_username&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/association&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>关联（association）元素处理“有一个”类型的关系。 比如，在我们的示例中，一个博客有一个用户。关联结果映射和其它类型的映射工作方式差不多。 你需要指定目标属性名以及属性的<code>javaType</code>（很多时候 MyBatis 可以自己推断出来），在必要的情况下你还可以设置 JDBC 类型，如果你想覆盖获取结果值的过程，还可以设置类型处理器。</p>
<p>关联的不同之处是，你需要告诉 MyBatis 如何加载关联。MyBatis 有两种不同的方式加载关联：</p>
<ul>
<li>嵌套 Select 查询：通过执行另外一个 SQL 映射语句来加载期望的复杂类型。</li>
<li>嵌套结果映射：使用嵌套的结果映射来处理连接结果的重复子集。</li>
</ul>
<p>首先，先让我们来看看这个元素的属性。你将会发现，和普通的结果映射相比，它只在 select 和 resultMap 属性上有所不同。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>property</code></td>
<td style="text-align:left">映射到列结果的字段或属性。如果用来匹配的 JavaBean 存在给定名字的属性，那么它将会被使用。否则 MyBatis 将会寻找给定名称的字段。 无论是哪一种情形，你都可以使用通常的点式分隔形式进行复杂属性导航。 比如，你可以这样映射一些简单的东西：“username”，或者映射到一些复杂的东西上：“address.street.number”。</td>
</tr>
<tr>
<td style="text-align:left"><code>javaType</code></td>
<td style="text-align:left">一个 Java 类的完全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</td>
</tr>
<tr>
<td style="text-align:left"><code>jdbcType</code></td>
<td style="text-align:left">JDBC 类型，所支持的 JDBC 类型参见这个表格之前的“支持的 JDBC 类型”。 只需要在可能执行插入、更新和删除的且允许空值的列上指定 JDBC 类型。这是 JDBC 的要求而非 MyBatis 的要求。如果你直接面向 JDBC 编程，你需要对可能存在空值的列指定这个类型。</td>
</tr>
<tr>
<td style="text-align:left"><code>typeHandler</code></td>
<td style="text-align:left">我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的完全限定名，或者是类型别名。</td>
</tr>
</tbody>
</table>
<h5 id="关联的嵌套-select-查询" class="headerLink">
    <a href="#%e5%85%b3%e8%81%94%e7%9a%84%e5%b5%8c%e5%a5%97-select-%e6%9f%a5%e8%af%a2" class="header-mark"></a>关联的嵌套 Select 查询</h5><table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>column</code></td>
<td style="text-align:left">数据库中的列名，或者是列的别名。一般情况下，这和传递给 <code>resultSet.getString(columnName)</code> 方法的参数一样。 注意：在使用复合主键的时候，你可以使用 <code>column=&quot;{prop1=col1,prop2=col2}&quot;</code> 这样的语法来指定多个传递给嵌套 Select 查询语句的列名。这会使得 <code>prop1</code> 和 <code>prop2</code> 作为参数对象，被设置为对应嵌套 Select 语句的参数。</td>
</tr>
<tr>
<td style="text-align:left"><code>select</code></td>
<td style="text-align:left">用于加载复杂类型属性的映射语句的 ID，它会从 column 属性指定的列中检索数据，作为参数传递给目标 select 语句。 具体请参考下面的例子。注意：在使用复合主键的时候，你可以使用 <code>column=&quot;{prop1=col1,prop2=col2}&quot;</code> 这样的语法来指定多个传递给嵌套 Select 查询语句的列名。这会使得 <code>prop1</code> 和 <code>prop2</code> 作为参数对象，被设置为对应嵌套 Select 语句的参数。</td>
</tr>
<tr>
<td style="text-align:left"><code>fetchType</code></td>
<td style="text-align:left">可选的。有效值为 <code>lazy</code> 和 <code>eager</code>。 指定属性后，将在映射中忽略全局配置参数 <code>lazyLoadingEnabled</code>，使用属性的值。</td>
</tr>
</tbody>
</table>
<p>示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;association property=&#34;author&#34; column=&#34;author_id&#34; javaType=&#34;Author&#34; select=&#34;selectAuthor&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; resultMap=&#34;blogResult&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG WHERE ID = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;select id=&#34;selectAuthor&#34; resultType=&#34;Author&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM AUTHOR WHERE ID = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>就是这么简单。我们有两个 select 查询语句：一个用来加载博客（Blog），另外一个用来加载作者（Author），而且博客的结果映射描述了应该使用 <code>selectAuthor</code> 语句加载它的 author 属性。</p>
<p>其它所有的属性将会被自动加载，只要它们的列名和属性名相匹配。</p>
<p>这种方式虽然很简单，但在大型数据集或大型数据表上表现不佳。这个问题被称为“N+1 查询问题”。 概括地讲，N+1 查询问题是这样子的：</p>
<ul>
<li>你执行了一个单独的 SQL 语句来获取结果的一个列表（就是“+1”）。</li>
<li>对列表返回的每条记录，你执行一个 select 查询语句来为每条记录加载详细信息（就是“N”）。</li>
</ul>
<p>这个问题会导致成百上千的 SQL 语句被执行。有时候，我们不希望产生这样的后果。</p>
<p>好消息是，MyBatis 能够对这样的查询进行延迟加载，因此可以将大量语句同时运行的开销分散开来。 然而，如果你加载记录列表之后立刻就遍历列表以获取嵌套的数据，就会触发所有的延迟加载查询，性能可能会变得很糟糕。</p>
<p>所以还有另外一种方法。</p>
<h5 id="关联的嵌套结果映射" class="headerLink">
    <a href="#%e5%85%b3%e8%81%94%e7%9a%84%e5%b5%8c%e5%a5%97%e7%bb%93%e6%9e%9c%e6%98%a0%e5%b0%84" class="header-mark"></a>关联的嵌套结果映射</h5><table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>resultMap</code></td>
<td style="text-align:left">结果映射的 ID，可以将此关联的嵌套结果集映射到一个合适的对象树中。 它可以作为使用额外 select 语句的替代方案。它可以将多表连接操作的结果映射成一个单一的 <code>ResultSet</code>。这样的 <code>ResultSet</code> 有部分数据是重复的。 为了将结果集正确地映射到嵌套的对象树中, MyBatis 允许你“串联”结果映射，以便解决嵌套结果集的问题。使用嵌套结果映射的一个例子在表格以后。</td>
</tr>
<tr>
<td style="text-align:left"><code>columnPrefix</code></td>
<td style="text-align:left">当连接多个表时，你可能会不得不使用列别名来避免在 <code>ResultSet</code> 中产生重复的列名。指定 columnPrefix 列名前缀允许你将带有这些前缀的列映射到一个外部的结果映射中。 详细说明请参考后面的例子。</td>
</tr>
<tr>
<td style="text-align:left"><code>notNullColumn</code></td>
<td style="text-align:left">默认情况下，在至少一个被映射到属性的列不为空时，子对象才会被创建。 你可以在这个属性上指定非空的列来改变默认行为，指定后，Mybatis 将只在这些列中任意一列非空时才创建一个子对象。可以使用逗号分隔来指定多个列。默认值：未设置（unset）。</td>
</tr>
<tr>
<td style="text-align:left"><code>autoMapping</code></td>
<td style="text-align:left">如果设置这个属性，MyBatis 将会为本结果映射开启或者关闭自动映射。 这个属性会覆盖全局的属性 autoMappingBehavior。注意，本属性对外部的结果映射无效，所以不能搭配 <code>select</code> 或 <code>resultMap</code> 元素使用。默认值：未设置（unset）。</td>
</tr>
</tbody>
</table>
<p>之前，你已经看到了一个非常复杂的嵌套关联的例子。 下面的例子则是一个非常简单的例子，用于演示嵌套结果映射如何工作。 现在我们将博客表和作者表连接在一起，而不是执行一个独立的查询语句，就像这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; resultMap=&#34;blogResult&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">    B.id            as blog_id,
</span></span><span class="line"><span class="cl">    B.title         as blog_title,
</span></span><span class="line"><span class="cl">    B.author_id     as blog_author_id,
</span></span><span class="line"><span class="cl">    A.id            as author_id,
</span></span><span class="line"><span class="cl">    A.username      as author_username,
</span></span><span class="line"><span class="cl">    A.password      as author_password,
</span></span><span class="line"><span class="cl">    A.email         as author_email,
</span></span><span class="line"><span class="cl">    A.bio           as author_bio
</span></span><span class="line"><span class="cl">  from Blog B left outer join Author A on B.author_id = A.id
</span></span><span class="line"><span class="cl">  where B.id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意查询中的连接，以及为确保结果能够拥有唯一且清晰的名字，我们设置的别名。 这使得进行映射非常简单。现在我们可以映射这个结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;blog_id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;title&#34; column=&#34;blog_title&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;association property=&#34;author&#34; column=&#34;blog_author_id&#34; javaType=&#34;Author&#34; resultMap=&#34;authorResult&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;resultMap id=&#34;authorResult&#34; type=&#34;Author&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;author_id&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;username&#34; column=&#34;author_username&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;password&#34; column=&#34;author_password&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;email&#34; column=&#34;author_email&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;bio&#34; column=&#34;author_bio&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在上面的例子中，你可以看到，博客（Blog）作者（author）的关联元素委托名为 “authorResult” 的结果映射来加载作者对象的实例。</p>
<p>非常重要： id 元素在嵌套结果映射中扮演着非常重要的角色。你应该总是指定一个或多个可以唯一标识结果的属性。 虽然，即使不指定这个属性，MyBatis 仍然可以工作，但是会产生严重的性能问题。 只需要指定可以唯一标识结果的最少属性。显然，你可以选择主键（复合主键也可以）。</p>
<p>现在，上面的示例使用了外部的结果映射元素来映射关联。这使得 Author 的结果映射可以被重用。 然而，如果你不打算重用它，或者你更喜欢将你所有的结果映射放在一个具有描述性的结果映射元素中。 你可以直接将结果映射作为子元素嵌套在内。这里给出使用这种方式的等效例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;blog_id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;title&#34; column=&#34;blog_title&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;association property=&#34;author&#34; javaType=&#34;Author&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;id property=&#34;id&#34; column=&#34;author_id&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;username&#34; column=&#34;author_username&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;password&#34; column=&#34;author_password&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;email&#34; column=&#34;author_email&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;bio&#34; column=&#34;author_bio&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;/association&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>那如果博客（blog）有一个共同作者（co-author）该怎么办？select 语句看起来会是这样的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; resultMap=&#34;blogResult&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">    B.id            as blog_id,
</span></span><span class="line"><span class="cl">    B.title         as blog_title,
</span></span><span class="line"><span class="cl">    A.id            as author_id,
</span></span><span class="line"><span class="cl">    A.username      as author_username,
</span></span><span class="line"><span class="cl">    A.password      as author_password,
</span></span><span class="line"><span class="cl">    A.email         as author_email,
</span></span><span class="line"><span class="cl">    A.bio           as author_bio,
</span></span><span class="line"><span class="cl">    CA.id           as co_author_id,
</span></span><span class="line"><span class="cl">    CA.username     as co_author_username,
</span></span><span class="line"><span class="cl">    CA.password     as co_author_password,
</span></span><span class="line"><span class="cl">    CA.email        as co_author_email,
</span></span><span class="line"><span class="cl">    CA.bio          as co_author_bio
</span></span><span class="line"><span class="cl">  from Blog B
</span></span><span class="line"><span class="cl">  left outer join Author A on B.author_id = A.id
</span></span><span class="line"><span class="cl">  left outer join Author CA on B.co_author_id = CA.id
</span></span><span class="line"><span class="cl">  where B.id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>回忆一下，Author 的结果映射定义如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;authorResult&#34; type=&#34;Author&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;author_id&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;username&#34; column=&#34;author_username&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;password&#34; column=&#34;author_password&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;email&#34; column=&#34;author_email&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;bio&#34; column=&#34;author_bio&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于结果中的列名与结果映射中的列名不同。你需要指定 <code>columnPrefix</code> 以便重复使用该结果映射来映射 co-author 的结果。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;blog_id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;title&#34; column=&#34;blog_title&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;association property=&#34;author&#34;
</span></span><span class="line"><span class="cl">    resultMap=&#34;authorResult&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;association property=&#34;coAuthor&#34;
</span></span><span class="line"><span class="cl">    resultMap=&#34;authorResult&#34;
</span></span><span class="line"><span class="cl">    columnPrefix=&#34;co_&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="关联的多结果集resultset" class="headerLink">
    <a href="#%e5%85%b3%e8%81%94%e7%9a%84%e5%a4%9a%e7%bb%93%e6%9e%9c%e9%9b%86resultset" class="header-mark"></a>关联的多结果集（ResultSet）</h5><table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>column</code></td>
<td style="text-align:left">当使用多个结果集时，该属性指定结果集中用于与 <code>foreignColumn</code> 匹配的列（多个列名以逗号隔开），以识别关系中的父类型与子类型。</td>
</tr>
<tr>
<td style="text-align:left"><code>foreignColumn</code></td>
<td style="text-align:left">指定外键对应的列名，指定的列将与父类型中 <code>column</code> 的给出的列进行匹配。</td>
</tr>
<tr>
<td style="text-align:left"><code>resultSet</code></td>
<td style="text-align:left">指定用于加载复杂类型的结果集名字。</td>
</tr>
</tbody>
</table>
<p>从版本 3.2.3 开始，MyBatis 提供了另一种解决 N+1 查询问题的方法。</p>
<p>某些数据库允许存储过程返回多个结果集，或一次性执行多个语句，每个语句返回一个结果集。 我们可以利用这个特性，在不使用连接的情况下，只访问数据库一次就能获得相关数据。</p>
<p>在例子中，存储过程执行下面的查询并返回两个结果集。第一个结果集会返回博客（Blog）的结果，第二个则返回作者（Author）的结果。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT * FROM BLOG WHERE ID = #{id}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SELECT * FROM AUTHOR WHERE ID = #{id}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在映射语句中，必须通过 <code>resultSets</code> 属性为每个结果集指定一个名字，多个名字使用逗号隔开。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; resultSets=&#34;blogs,authors&#34; resultMap=&#34;blogResult&#34; statementType=&#34;CALLABLE&#34;&gt;
</span></span><span class="line"><span class="cl">  {call getBlogsAndAuthors(#{id,jdbcType=INTEGER,mode=IN})}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在我们可以指定使用 “authors” 结果集的数据来填充 “author” 关联：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;title&#34; column=&#34;title&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;association property=&#34;author&#34; javaType=&#34;Author&#34; resultSet=&#34;authors&#34; column=&#34;author_id&#34; foreignColumn=&#34;id&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;id property=&#34;id&#34; column=&#34;id&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;username&#34; column=&#34;username&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;password&#34; column=&#34;password&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;email&#34; column=&#34;email&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;bio&#34; column=&#34;bio&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;/association&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>你已经在上面看到了如何处理“有一个”类型的关联。但是该怎么处理“有很多个”类型的关联呢？这就是我们接下来要介绍的。</p>
<h5 id="集合" class="headerLink">
    <a href="#%e9%9b%86%e5%90%88" class="header-mark"></a>集合</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;collection property=&#34;posts&#34; ofType=&#34;domain.blog.Post&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;post_id&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;subject&#34; column=&#34;post_subject&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;body&#34; column=&#34;post_body&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/collection&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>集合元素和关联元素几乎是一样的，它们相似的程度之高，以致于没有必要再介绍集合元素的相似部分。 所以让我们来关注它们的不同之处吧。</p>
<p>我们来继续上面的示例，一个博客（Blog）只有一个作者（Author)。但一个博客有很多文章（Post)。 在博客类中，这可以用下面的写法来表示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">private List&lt;Post&gt; posts;
</span></span></code></pre></td></tr></table>
</div>
</div><p>要像上面这样，映射嵌套结果集合到一个 List 中，可以使用集合元素。 和关联元素一样，我们可以使用嵌套 Select 查询，或基于连接的嵌套结果映射集合。</p>
<h5 id="集合的嵌套-select-查询" class="headerLink">
    <a href="#%e9%9b%86%e5%90%88%e7%9a%84%e5%b5%8c%e5%a5%97-select-%e6%9f%a5%e8%af%a2" class="header-mark"></a>集合的嵌套 Select 查询</h5><p>首先，让我们看看如何使用嵌套 Select 查询来为博客加载文章。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;collection property=&#34;posts&#34; javaType=&#34;ArrayList&#34; column=&#34;id&#34; ofType=&#34;Post&#34; select=&#34;selectPostsForBlog&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; resultMap=&#34;blogResult&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG WHERE ID = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;select id=&#34;selectPostsForBlog&#34; resultType=&#34;Post&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM POST WHERE BLOG_ID = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>你可能会立刻注意到几个不同，但大部分都和我们上面学习过的关联元素非常相似。 首先，你会注意到我们使用的是集合元素。 接下来你会注意到有一个新的 “ofType” 属性。这个属性非常重要，它用来将 JavaBean（或字段）属性的类型和集合存储的类型区分开来。 所以你可以按照下面这样来阅读映射：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;collection property=&#34;posts&#34; javaType=&#34;ArrayList&#34; column=&#34;id&#34; ofType=&#34;Post&#34; select=&#34;selectPostsForBlog&#34;/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>读作： “posts 是一个存储 Post 的 ArrayList 集合”</p>
<p>在一般情况下，MyBatis 可以推断 javaType 属性，因此并不需要填写。所以很多时候你可以简略成：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;collection property=&#34;posts&#34; column=&#34;id&#34; ofType=&#34;Post&#34; select=&#34;selectPostsForBlog&#34;/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="集合的嵌套结果映射" class="headerLink">
    <a href="#%e9%9b%86%e5%90%88%e7%9a%84%e5%b5%8c%e5%a5%97%e7%bb%93%e6%9e%9c%e6%98%a0%e5%b0%84" class="header-mark"></a>集合的嵌套结果映射</h5><p>现在你可能已经猜到了集合的嵌套结果映射是怎样工作的——除了新增的 “ofType” 属性，它和关联的完全相同。</p>
<p>首先, 让我们看看对应的 SQL 语句：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; resultMap=&#34;blogResult&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">  B.id as blog_id,
</span></span><span class="line"><span class="cl">  B.title as blog_title,
</span></span><span class="line"><span class="cl">  B.author_id as blog_author_id,
</span></span><span class="line"><span class="cl">  P.id as post_id,
</span></span><span class="line"><span class="cl">  P.subject as post_subject,
</span></span><span class="line"><span class="cl">  P.body as post_body,
</span></span><span class="line"><span class="cl">  from Blog B
</span></span><span class="line"><span class="cl">  left outer join Post P on B.id = P.blog_id
</span></span><span class="line"><span class="cl">  where B.id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们再次连接了博客表和文章表，并且为每一列都赋予了一个有意义的别名，以便映射保持简单。 要映射博客里面的文章集合，就这么简单：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;blog_id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;title&#34; column=&#34;blog_title&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;collection property=&#34;posts&#34; ofType=&#34;Post&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;id property=&#34;id&#34; column=&#34;post_id&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;subject&#34; column=&#34;post_subject&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;body&#34; column=&#34;post_body&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;/collection&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>再提醒一次，要记得上面 id 元素的重要性，如果你不记得了，请阅读关联部分的相关部分。</p>
<p>如果你喜欢更详略的、可重用的结果映射，你可以使用下面的等价形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;blog_id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;title&#34; column=&#34;blog_title&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;collection property=&#34;posts&#34; ofType=&#34;Post&#34; resultMap=&#34;blogPostResult&#34; columnPrefix=&#34;post_&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;resultMap id=&#34;blogPostResult&#34; type=&#34;Post&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;id&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;subject&#34; column=&#34;subject&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;body&#34; column=&#34;body&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="集合的多结果集resultset" class="headerLink">
    <a href="#%e9%9b%86%e5%90%88%e7%9a%84%e5%a4%9a%e7%bb%93%e6%9e%9c%e9%9b%86resultset" class="header-mark"></a>集合的多结果集（ResultSet）</h5><p>像关联元素那样，我们可以通过执行存储过程实现，它会执行两个查询并返回两个结果集，一个是博客的结果集，另一个是文章的结果集：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT * FROM BLOG WHERE ID = #{id}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SELECT * FROM POST WHERE BLOG_ID = #{id}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在映射语句中，必须通过 <code>resultSets</code> 属性为每个结果集指定一个名字，多个名字使用逗号隔开。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; resultSets=&#34;blogs,posts&#34; resultMap=&#34;blogResult&#34;&gt;
</span></span><span class="line"><span class="cl">  {call getBlogsAndPosts(#{id,jdbcType=INTEGER,mode=IN})}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们指定 “posts” 集合将会使用存储在 “posts” 结果集中的数据进行填充：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;title&#34; column=&#34;title&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;collection property=&#34;posts&#34; ofType=&#34;Post&#34; resultSet=&#34;posts&#34; column=&#34;id&#34; foreignColumn=&#34;blog_id&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;id property=&#34;id&#34; column=&#34;id&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;subject&#34; column=&#34;subject&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;result property=&#34;body&#34; column=&#34;body&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;/collection&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong> 对关联或集合的映射，并没有深度、广度或组合上的要求。但在映射时要留意性能问题。 在探索最佳实践的过程中，应用的单元测试和性能测试会是你的好帮手。 而 MyBatis 的好处在于，可以在不对你的代码引入重大变更（如果有）的情况下，允许你之后改变你的想法。</p>
<p>高级关联和集合映射是一个深度话题。文档的介绍只能到此为止。配合少许的实践，你会很快了解全部的用法。</p>
<h5 id="鉴别器" class="headerLink">
    <a href="#%e9%89%b4%e5%88%ab%e5%99%a8" class="header-mark"></a>鉴别器</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;discriminator javaType=&#34;int&#34; column=&#34;draft&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;case value=&#34;1&#34; resultType=&#34;DraftPost&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/discriminator&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>有时候，一个数据库查询可能会返回多个不同的结果集（但总体上还是有一定的联系的）。 鉴别器（discriminator）元素就是被设计来应对这种情况的，另外也能处理其它情况，例如类的继承层次结构。 鉴别器的概念很好理解——它很像 Java 语言中的 switch 语句。</p>
<p>一个鉴别器的定义需要指定 column 和 javaType 属性。column 指定了 MyBatis 查询被比较值的地方。 而 javaType 用来确保使用正确的相等测试（虽然很多情况下字符串的相等测试都可以工作）。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;vehicleResult&#34; type=&#34;Vehicle&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;vin&#34; column=&#34;vin&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;year&#34; column=&#34;year&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;make&#34; column=&#34;make&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;model&#34; column=&#34;model&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;color&#34; column=&#34;color&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;discriminator javaType=&#34;int&#34; column=&#34;vehicle_type&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;case value=&#34;1&#34; resultMap=&#34;carResult&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;case value=&#34;2&#34; resultMap=&#34;truckResult&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;case value=&#34;3&#34; resultMap=&#34;vanResult&#34;/&gt;
</span></span><span class="line"><span class="cl">    &lt;case value=&#34;4&#34; resultMap=&#34;suvResult&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;/discriminator&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这个示例中，MyBatis 会从结果集中得到每条记录，然后比较它的 vehicle type 值。 如果它匹配任意一个鉴别器的 case，就会使用这个 case 指定的结果映射。 这个过程是互斥的，也就是说，剩余的结果映射将被忽略（除非它是扩展的，我们将在稍后讨论它）。 如果不能匹配任何一个 case，MyBatis 就只会使用鉴别器块外定义的结果映射。 所以，如果 carResult 的声明如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;carResult&#34; type=&#34;Car&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;doorCount&#34; column=&#34;door_count&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>那么只有 doorCount 属性会被加载。这是为了即使鉴别器的 case 之间都能分为完全独立的一组，尽管和父结果映射可能没有什么关系。在上面的例子中，我们当然知道 cars 和 vehicles 之间有关系，也就是 Car 是一个 Vehicle。因此，我们希望剩余的属性也能被加载。而这只需要一个小修改。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;carResult&#34; type=&#34;Car&#34; extends=&#34;vehicleResult&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;doorCount&#34; column=&#34;door_count&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在 vehicleResult 和 carResult 的属性都会被加载了。</p>
<p>可能有人又会觉得映射的外部定义有点太冗长了。 因此，对于那些更喜欢简洁的映射风格的人来说，还有另一种语法可以选择。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;vehicleResult&#34; type=&#34;Vehicle&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;id property=&#34;id&#34; column=&#34;id&#34; /&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;vin&#34; column=&#34;vin&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;year&#34; column=&#34;year&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;make&#34; column=&#34;make&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;model&#34; column=&#34;model&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;color&#34; column=&#34;color&#34;/&gt;
</span></span><span class="line"><span class="cl">  &lt;discriminator javaType=&#34;int&#34; column=&#34;vehicle_type&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;case value=&#34;1&#34; resultType=&#34;carResult&#34;&gt;
</span></span><span class="line"><span class="cl">      &lt;result property=&#34;doorCount&#34; column=&#34;door_count&#34; /&gt;
</span></span><span class="line"><span class="cl">    &lt;/case&gt;
</span></span><span class="line"><span class="cl">    &lt;case value=&#34;2&#34; resultType=&#34;truckResult&#34;&gt;
</span></span><span class="line"><span class="cl">      &lt;result property=&#34;boxSize&#34; column=&#34;box_size&#34; /&gt;
</span></span><span class="line"><span class="cl">      &lt;result property=&#34;extendedCab&#34; column=&#34;extended_cab&#34; /&gt;
</span></span><span class="line"><span class="cl">    &lt;/case&gt;
</span></span><span class="line"><span class="cl">    &lt;case value=&#34;3&#34; resultType=&#34;vanResult&#34;&gt;
</span></span><span class="line"><span class="cl">      &lt;result property=&#34;powerSlidingDoor&#34; column=&#34;power_sliding_door&#34; /&gt;
</span></span><span class="line"><span class="cl">    &lt;/case&gt;
</span></span><span class="line"><span class="cl">    &lt;case value=&#34;4&#34; resultType=&#34;suvResult&#34;&gt;
</span></span><span class="line"><span class="cl">      &lt;result property=&#34;allWheelDrive&#34; column=&#34;all_wheel_drive&#34; /&gt;
</span></span><span class="line"><span class="cl">    &lt;/case&gt;
</span></span><span class="line"><span class="cl">  &lt;/discriminator&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>提示</strong> 请注意，这些都是结果映射，如果你完全不设置任何的 result 元素，MyBatis 将为你自动匹配列和属性。所以上面的例子大多都要比实际的更复杂。 这也表明，大多数数据库的复杂度都比较高，我们不太可能一直依赖于这种机制。</p>
<h4 id="自动映射" class="headerLink">
    <a href="#%e8%87%aa%e5%8a%a8%e6%98%a0%e5%b0%84" class="header-mark"></a>自动映射</h4><p>正如你在前面一节看到的，在简单的场景下，MyBatis 可以为你自动映射查询结果。但如果遇到复杂的场景，你需要构建一个结果映射。 但是在本节中，你将看到，你可以混合使用这两种策略。让我们深入了解一下自动映射是怎样工作的。</p>
<p>当自动映射查询结果时，MyBatis 会获取结果中返回的列名并在 Java 类中查找相同名字的属性（忽略大小写）。 这意味着如果发现了 <em>ID</em> 列和 <em>id</em> 属性，MyBatis 会将列 <em>ID</em> 的值赋给 <em>id</em> 属性。</p>
<p>通常数据库列使用大写字母组成的单词命名，单词间用下划线分隔；而 Java 属性一般遵循驼峰命名法约定。为了在这两种命名方式之间启用自动映射，需要将 <code>mapUnderscoreToCamelCase</code> 设置为 true。</p>
<p>甚至在提供了结果映射后，自动映射也能工作。在这种情况下，对于每一个结果映射，在 ResultSet 出现的列，如果没有设置手动映射，将被自动映射。在自动映射处理完毕后，再处理手动映射。 在下面的例子中，<em>id</em> 和 <em>userName</em> 列将被自动映射，<em>hashed_password</em> 列将根据配置进行映射。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectUsers&#34; resultMap=&#34;userResultMap&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">    user_id             as &#34;id&#34;,
</span></span><span class="line"><span class="cl">    user_name           as &#34;userName&#34;,
</span></span><span class="line"><span class="cl">    hashed_password
</span></span><span class="line"><span class="cl">  from some_table
</span></span><span class="line"><span class="cl">  where id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span><span class="line"><span class="cl">&lt;resultMap id=&#34;userResultMap&#34; type=&#34;User&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;password&#34; column=&#34;hashed_password&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>有三种自动映射等级：</p>
<ul>
<li><code>NONE</code> - 禁用自动映射。仅对手动映射的属性进行映射。</li>
<li><code>PARTIAL</code> - 对除在内部定义了嵌套结果映射（也就是连接的属性）以外的属性进行映射</li>
<li><code>FULL</code> - 自动映射所有属性。</li>
</ul>
<p>默认值是 <code>PARTIAL</code>，这是有原因的。当对连接查询的结果使用 <code>FULL</code> 时，连接查询会在同一行中获取多个不同实体的数据，因此可能导致非预期的映射。 下面的例子将展示这种风险：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; resultMap=&#34;blogResult&#34;&gt;
</span></span><span class="line"><span class="cl">  select
</span></span><span class="line"><span class="cl">    B.id,
</span></span><span class="line"><span class="cl">    B.title,
</span></span><span class="line"><span class="cl">    A.username,
</span></span><span class="line"><span class="cl">  from Blog B left outer join Author A on B.author_id = A.id
</span></span><span class="line"><span class="cl">  where B.id = #{id}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span><span class="line"><span class="cl">&lt;resultMap id=&#34;blogResult&#34; type=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;association property=&#34;author&#34; resultMap=&#34;authorResult&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;resultMap id=&#34;authorResult&#34; type=&#34;Author&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;username&#34; column=&#34;author_username&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在该结果映射中，<em>Blog</em> 和 <em>Author</em> 均将被自动映射。但是注意 <em>Author</em> 有一个 <em>id</em> 属性，在 ResultSet 中也有一个名为 <em>id</em> 的列，所以 Author 的 id 将填入 Blog 的 id，这可不是你期望的行为。 所以，要谨慎使用 <code>FULL</code>。</p>
<p>无论设置的自动映射等级是哪种，你都可以通过在结果映射上设置 <code>autoMapping</code> 属性来为指定的结果映射设置启用/禁用自动映射。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;resultMap id=&#34;userResultMap&#34; type=&#34;User&#34; autoMapping=&#34;false&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;result property=&#34;password&#34; column=&#34;hashed_password&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/resultMap&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="缓存" class="headerLink">
    <a href="#%e7%bc%93%e5%ad%98" class="header-mark"></a>缓存</h4><p>MyBatis 内置了一个强大的事务性查询缓存机制，它可以非常方便地配置和定制。 为了使它更加强大而且易于配置，我们对 MyBatis 3 中的缓存实现进行了许多改进。</p>
<p>默认情况下，只启用了本地的会话缓存，它仅仅对一个会话中的数据进行缓存。 要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加一行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;cache/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>基本上就是这样。这个简单语句的效果如下:</p>
<ul>
<li>映射语句文件中的所有 select 语句的结果将会被缓存。</li>
<li>映射语句文件中的所有 insert、update 和 delete 语句会刷新缓存。</li>
<li>缓存会使用最近最少使用算法（LRU, Least Recently Used）算法来清除不需要的缓存。</li>
<li>缓存不会定时进行刷新（也就是说，没有刷新间隔）。</li>
<li>缓存会保存列表或对象（无论查询方法返回哪种）的 1024 个引用。</li>
<li>缓存会被视为读/写缓存，这意味着获取到的对象并不是共享的，可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</li>
</ul>
<p><strong>提示</strong> 缓存只作用于 cache 标签所在的映射文件中的语句。如果你混合使用 Java API 和 XML 映射文件，在共用接口中的语句将不会被默认缓存。你需要使用 @CacheNamespaceRef 注解指定缓存作用域。</p>
<p>这些属性可以通过 cache 元素的属性来修改。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;cache
</span></span><span class="line"><span class="cl">  eviction=&#34;FIFO&#34;
</span></span><span class="line"><span class="cl">  flushInterval=&#34;60000&#34;
</span></span><span class="line"><span class="cl">  size=&#34;512&#34;
</span></span><span class="line"><span class="cl">  readOnly=&#34;true&#34;/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个更高级的配置创建了一个 FIFO 缓存，每隔 60 秒刷新，最多可以存储结果对象或列表的 512 个引用，而且返回的对象被认为是只读的，因此对它们进行修改可能会在不同线程中的调用者产生冲突。</p>
<p>可用的清除策略有：</p>
<ul>
<li><code>LRU</code> – 最近最少使用：移除最长时间不被使用的对象。</li>
<li><code>FIFO</code> – 先进先出：按对象进入缓存的顺序来移除它们。</li>
<li><code>SOFT</code> – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li>
<li><code>WEAK</code> – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</li>
</ul>
<p>默认的清除策略是 LRU。</p>
<p>flushInterval（刷新间隔）属性可以被设置为任意的正整数，设置的值应该是一个以毫秒为单位的合理时间量。 默认情况是不设置，也就是没有刷新间隔，缓存仅仅会在调用语句时刷新。</p>
<p>size（引用数目）属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。默认值是 1024。</p>
<p>readOnly（只读）属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升。而可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 false。</p>
<p><strong>提示</strong> 二级缓存是事务性的。这意味着，当 SqlSession 完成并提交时，或是完成并回滚，但没有执行 flushCache=true 的 insert/delete/update 语句时，缓存会获得更新。</p>
<h5 id="使用自定义缓存" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8%e8%87%aa%e5%ae%9a%e4%b9%89%e7%bc%93%e5%ad%98" class="header-mark"></a>使用自定义缓存</h5><p>除了上述自定义缓存的方式，你也可以通过实现你自己的缓存，或为其他第三方缓存方案创建适配器，来完全覆盖缓存行为。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;cache type=&#34;com.domain.something.MyCustomCache&#34;/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个示例展示了如何使用一个自定义的缓存实现。type 属性指定的类必须实现 org.apache.ibatis.cache.Cache 接口，且提供一个接受 String 参数作为 id 的构造器。 这个接口是 MyBatis 框架中许多复杂的接口之一，但是行为却非常简单。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface Cache {
</span></span><span class="line"><span class="cl">  String getId();
</span></span><span class="line"><span class="cl">  int getSize();
</span></span><span class="line"><span class="cl">  void putObject(Object key, Object value);
</span></span><span class="line"><span class="cl">  Object getObject(Object key);
</span></span><span class="line"><span class="cl">  boolean hasKey(Object key);
</span></span><span class="line"><span class="cl">  Object removeObject(Object key);
</span></span><span class="line"><span class="cl">  void clear();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>为了对你的缓存进行配置，只需要简单地在你的缓存实现中添加公有的 JavaBean 属性，然后通过 cache 元素传递属性值，例如，下面的例子将在你的缓存实现上调用一个名为 <code>setCacheFile(String file)</code> 的方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;cache type=&#34;com.domain.something.MyCustomCache&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;property name=&#34;cacheFile&#34; value=&#34;/tmp/my-custom-cache.tmp&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/cache&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>你可以使用所有简单类型作为 JavaBean 属性的类型，MyBatis 会进行转换。 你也可以使用占位符（如 <code>${cache.file}</code>），以便替换成在<a href="https://mybatis.org/mybatis-3/zh/configuration.html#properties" target="_blank" rel="noopener noreferrer">配置文件属性</a>中定义的值。</p>
<p>从版本 3.4.2 开始，MyBatis 已经支持在所有属性设置完毕之后，调用一个初始化方法。 如果想要使用这个特性，请在你的自定义缓存类里实现 <code>org.apache.ibatis.builder.InitializingObject</code> 接口。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface InitializingObject {
</span></span><span class="line"><span class="cl">  void initialize() throws Exception;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>提示</strong> 上一节中对缓存的配置（如清除策略、可读或可读写等），不能应用于自定义缓存。</p>
<p>请注意，缓存的配置和缓存实例会被绑定到 SQL 映射文件的命名空间中。 因此，同一命名空间中的所有语句和缓存将通过命名空间绑定在一起。 每条语句可以自定义与缓存交互的方式，或将它们完全排除于缓存之外，这可以通过在每条语句上使用两个简单属性来达成。 默认情况下，语句会这样来配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select ... flushCache=&#34;false&#34; useCache=&#34;true&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;insert ... flushCache=&#34;true&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;update ... flushCache=&#34;true&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;delete ... flushCache=&#34;true&#34;/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>鉴于这是默认行为，显然你永远不应该以这样的方式显式配置一条语句。但如果你想改变默认的行为，只需要设置 flushCache 和 useCache 属性。比如，某些情况下你可能希望特定 select 语句的结果排除于缓存之外，或希望一条 select 语句清空缓存。类似地，你可能希望某些 update 语句执行时不要刷新缓存。</p>
<h5 id="cache-ref" class="headerLink">
    <a href="#cache-ref" class="header-mark"></a>cache-ref</h5><p>回想一下上一节的内容，对某一命名空间的语句，只会使用该命名空间的缓存进行缓存或刷新。 但你可能会想要在多个命名空间中共享相同的缓存配置和实例。要实现这种需求，你可以使用 cache-ref 元素来引用另一个缓存。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;cache-ref namespace=&#34;com.someone.application.data.SomeMapper&#34;/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="动态-sql" class="headerLink">
    <a href="#%e5%8a%a8%e6%80%81-sql" class="header-mark"></a>动态 SQL</h3><p>动态 SQL 是 MyBatis 的强大特性之一。如果你使用过 JDBC 或其它类似的框架，你应该能理解根据不同条件拼接 SQL 语句有多痛苦，例如拼接时要确保不能忘记添加必要的空格，还要注意去掉列表最后一个列名的逗号。利用动态 SQL，可以彻底摆脱这种痛苦。</p>
<p>使用动态 SQL 并非一件易事，但借助可用于任何 SQL 映射语句中的强大的动态 SQL 语言，MyBatis 显著地提升了这一特性的易用性。</p>
<p>如果你之前用过 JSTL 或任何基于类 XML 语言的文本处理器，你对动态 SQL 元素可能会感觉似曾相识。在 MyBatis 之前的版本中，需要花时间了解大量的元素。借助功能强大的基于 OGNL 的表达式，MyBatis 3 替换了之前的大部分元素，大大精简了元素种类，现在要学习的元素种类比原来的一半还要少。</p>
<ul>
<li>if</li>
<li>choose (when, otherwise)</li>
<li>trim (where, set)</li>
<li>foreach</li>
</ul>
<h4 id="if" class="headerLink">
    <a href="#if" class="header-mark"></a>if</h4><p>使用动态 SQL 最常见情景是根据条件包含 where 子句的一部分。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;findActiveBlogWithTitleLike&#34;
</span></span><span class="line"><span class="cl">     resultType=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG
</span></span><span class="line"><span class="cl">  WHERE state = ‘ACTIVE’
</span></span><span class="line"><span class="cl">  &lt;if test=&#34;title != null&#34;&gt;
</span></span><span class="line"><span class="cl">    AND title like #{title}
</span></span><span class="line"><span class="cl">  &lt;/if&gt;
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这条语句提供了可选的查找文本功能。如果不传入 “title”，那么所有处于 “ACTIVE” 状态的 BLOG 都会返回；如果传入了 “title” 参数，那么就会对 “title” 一列进行模糊查找并返回对应的 BLOG 结果（细心的读者可能会发现，“title” 的参数值需要包含查找掩码或通配符字符）。</p>
<p>如果希望通过 “title” 和 “author” 两个参数进行可选搜索该怎么办呢？首先，我想先将语句名称修改成更名副其实的名称；接下来，只需要加入另一个条件即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;findActiveBlogLike&#34;
</span></span><span class="line"><span class="cl">     resultType=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’
</span></span><span class="line"><span class="cl">  &lt;if test=&#34;title != null&#34;&gt;
</span></span><span class="line"><span class="cl">    AND title like #{title}
</span></span><span class="line"><span class="cl">  &lt;/if&gt;
</span></span><span class="line"><span class="cl">  &lt;if test=&#34;author != null and author.name != null&#34;&gt;
</span></span><span class="line"><span class="cl">    AND author_name like #{author.name}
</span></span><span class="line"><span class="cl">  &lt;/if&gt;
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="choosewhenotherwise" class="headerLink">
    <a href="#choosewhenotherwise" class="header-mark"></a>choose、when、otherwise</h4><p>有时候，我们不想使用所有的条件，而只是想从多个条件中选择一个使用。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。</p>
<p>还是上面的例子，但是策略变为：传入了 “title” 就按 “title” 查找，传入了 “author” 就按 “author” 查找的情形。若两者都没有传入，就返回标记为 featured 的 BLOG（这可能是管理员认为，与其返回大量的无意义随机 Blog，还不如返回一些由管理员精选的 Blog）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;findActiveBlogLike&#34;
</span></span><span class="line"><span class="cl">     resultType=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’
</span></span><span class="line"><span class="cl">  &lt;choose&gt;
</span></span><span class="line"><span class="cl">    &lt;when test=&#34;title != null&#34;&gt;
</span></span><span class="line"><span class="cl">      AND title like #{title}
</span></span><span class="line"><span class="cl">    &lt;/when&gt;
</span></span><span class="line"><span class="cl">    &lt;when test=&#34;author != null and author.name != null&#34;&gt;
</span></span><span class="line"><span class="cl">      AND author_name like #{author.name}
</span></span><span class="line"><span class="cl">    &lt;/when&gt;
</span></span><span class="line"><span class="cl">    &lt;otherwise&gt;
</span></span><span class="line"><span class="cl">      AND featured = 1
</span></span><span class="line"><span class="cl">    &lt;/otherwise&gt;
</span></span><span class="line"><span class="cl">  &lt;/choose&gt;
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="trimwhereset" class="headerLink">
    <a href="#trimwhereset" class="header-mark"></a>trim、where、set</h4><p>前面几个例子已经方便地解决了一个臭名昭著的动态 SQL 问题。现在回到之前的 “if” 示例，这次我们将 “state = ‘ACTIVE’” 设置成动态条件，看看会发生什么。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;findActiveBlogLike&#34;
</span></span><span class="line"><span class="cl">     resultType=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG
</span></span><span class="line"><span class="cl">  WHERE
</span></span><span class="line"><span class="cl">  &lt;if test=&#34;state != null&#34;&gt;
</span></span><span class="line"><span class="cl">    state = #{state}
</span></span><span class="line"><span class="cl">  &lt;/if&gt;
</span></span><span class="line"><span class="cl">  &lt;if test=&#34;title != null&#34;&gt;
</span></span><span class="line"><span class="cl">    AND title like #{title}
</span></span><span class="line"><span class="cl">  &lt;/if&gt;
</span></span><span class="line"><span class="cl">  &lt;if test=&#34;author != null and author.name != null&#34;&gt;
</span></span><span class="line"><span class="cl">    AND author_name like #{author.name}
</span></span><span class="line"><span class="cl">  &lt;/if&gt;
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果没有匹配的条件会怎么样？最终这条 SQL 会变成这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT * FROM BLOG
</span></span><span class="line"><span class="cl">WHERE
</span></span></code></pre></td></tr></table>
</div>
</div><p>这会导致查询失败。如果匹配的只是第二个条件又会怎样？这条 SQL 会是这样:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT * FROM BLOG
</span></span><span class="line"><span class="cl">WHERE
</span></span><span class="line"><span class="cl">AND title like ‘someTitle’
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个查询也会失败。这个问题不能简单地用条件元素来解决。这个问题是如此的难以解决，以至于解决过的人不会再想碰到这种问题。</p>
<p>MyBatis 有一个简单且适合大多数场景的解决办法。而在其他场景中，可以对其进行自定义以符合需求。而这，只需要一处简单的改动：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;findActiveBlogLike&#34;
</span></span><span class="line"><span class="cl">     resultType=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG
</span></span><span class="line"><span class="cl">  &lt;where&gt;
</span></span><span class="line"><span class="cl">    &lt;if test=&#34;state != null&#34;&gt;
</span></span><span class="line"><span class="cl">         state = #{state}
</span></span><span class="line"><span class="cl">    &lt;/if&gt;
</span></span><span class="line"><span class="cl">    &lt;if test=&#34;title != null&#34;&gt;
</span></span><span class="line"><span class="cl">        AND title like #{title}
</span></span><span class="line"><span class="cl">    &lt;/if&gt;
</span></span><span class="line"><span class="cl">    &lt;if test=&#34;author != null and author.name != null&#34;&gt;
</span></span><span class="line"><span class="cl">        AND author_name like #{author.name}
</span></span><span class="line"><span class="cl">    &lt;/if&gt;
</span></span><span class="line"><span class="cl">  &lt;/where&gt;
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>where</em> 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。而且，若子句的开头为 “AND” 或 “OR”，<em>where</em> 元素也会将它们去除。</p>
<p>如果 <em>where</em> 元素与你期望的不太一样，你也可以通过自定义 trim 元素来定制 <em>where</em> 元素的功能。比如，和 <em>where</em> 元素等价的自定义 trim 元素为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;trim prefix=&#34;WHERE&#34; prefixOverrides=&#34;AND |OR &#34;&gt;
</span></span><span class="line"><span class="cl">  ...
</span></span><span class="line"><span class="cl">&lt;/trim&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>prefixOverrides</em> 属性会忽略通过管道符分隔的文本序列（注意此例中的空格是必要的）。上述例子会移除所有 <em>prefixOverrides</em> 属性中指定的内容，并且插入 <em>prefix</em> 属性中指定的内容。</p>
<p>用于动态更新语句的类似解决方案叫做 <em>set</em>。<em>set</em> 元素可以用于动态包含需要更新的列，忽略其它不更新的列。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;update id=&#34;updateAuthorIfNecessary&#34;&gt;
</span></span><span class="line"><span class="cl">  update Author
</span></span><span class="line"><span class="cl">    &lt;set&gt;
</span></span><span class="line"><span class="cl">      &lt;if test=&#34;username != null&#34;&gt;username=#{username},&lt;/if&gt;
</span></span><span class="line"><span class="cl">      &lt;if test=&#34;password != null&#34;&gt;password=#{password},&lt;/if&gt;
</span></span><span class="line"><span class="cl">      &lt;if test=&#34;email != null&#34;&gt;email=#{email},&lt;/if&gt;
</span></span><span class="line"><span class="cl">      &lt;if test=&#34;bio != null&#34;&gt;bio=#{bio}&lt;/if&gt;
</span></span><span class="line"><span class="cl">    &lt;/set&gt;
</span></span><span class="line"><span class="cl">  where id=#{id}
</span></span><span class="line"><span class="cl">&lt;/update&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子中，<em>set</em> 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号（这些逗号是在使用条件语句给列赋值时引入的）。</p>
<p>或者，你可以通过使用<em>trim</em>元素来达到同样的效果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;trim prefix=&#34;SET&#34; suffixOverrides=&#34;,&#34;&gt;
</span></span><span class="line"><span class="cl">  ...
</span></span><span class="line"><span class="cl">&lt;/trim&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意，我们覆盖了后缀值设置，并且自定义了前缀值。</p>
<h4 id="foreach" class="headerLink">
    <a href="#foreach" class="header-mark"></a>foreach</h4><p>动态 SQL 的另一个常见使用场景是对集合进行遍历（尤其是在构建 IN 条件语句的时候）。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectPostIn&#34; resultType=&#34;domain.blog.Post&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT *
</span></span><span class="line"><span class="cl">  FROM POST P
</span></span><span class="line"><span class="cl">  &lt;where&gt;
</span></span><span class="line"><span class="cl">    &lt;foreach item=&#34;item&#34; index=&#34;index&#34; collection=&#34;list&#34;
</span></span><span class="line"><span class="cl">        open=&#34;ID in (&#34; separator=&#34;,&#34; close=&#34;)&#34; nullable=&#34;true&#34;&gt;
</span></span><span class="line"><span class="cl">          #{item}
</span></span><span class="line"><span class="cl">    &lt;/foreach&gt;
</span></span><span class="line"><span class="cl">  &lt;/where&gt;
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>foreach</em> 元素的功能非常强大，它允许你指定一个集合，声明可以在元素体内使用的集合项（item）和索引（index）变量。它也允许你指定开头与结尾的字符串以及集合项迭代之间的分隔符。这个元素也不会错误地添加多余的分隔符，看它多智能！</p>
<p><strong>提示</strong> 你可以将任何可迭代对象（如 List、Set 等）、Map 对象或者数组对象作为集合参数传递给 <em>foreach</em>。当使用可迭代对象或者数组时，index 是当前迭代的序号，item 的值是本次迭代获取到的元素。当使用 Map 对象（或者 Map.Entry 对象的集合）时，index 是键，item 是值。</p>
<p>至此，我们已经完成了与 XML 配置及映射文件相关的讨论。下一章将详细探讨 Java API，以便你能充分利用已经创建的映射配置。</p>
<h4 id="script" class="headerLink">
    <a href="#script" class="header-mark"></a>script</h4><p>要在带注解的映射器接口类中使用动态 SQL，可以使用 <em>script</em> 元素。比如:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    @Update({&#34;&lt;script&gt;&#34;,
</span></span><span class="line"><span class="cl">      &#34;update Author&#34;,
</span></span><span class="line"><span class="cl">      &#34;  &lt;set&gt;&#34;,
</span></span><span class="line"><span class="cl">      &#34;    &lt;if test=&#39;username != null&#39;&gt;username=#{username},&lt;/if&gt;&#34;,
</span></span><span class="line"><span class="cl">      &#34;    &lt;if test=&#39;password != null&#39;&gt;password=#{password},&lt;/if&gt;&#34;,
</span></span><span class="line"><span class="cl">      &#34;    &lt;if test=&#39;email != null&#39;&gt;email=#{email},&lt;/if&gt;&#34;,
</span></span><span class="line"><span class="cl">      &#34;    &lt;if test=&#39;bio != null&#39;&gt;bio=#{bio}&lt;/if&gt;&#34;,
</span></span><span class="line"><span class="cl">      &#34;  &lt;/set&gt;&#34;,
</span></span><span class="line"><span class="cl">      &#34;where id=#{id}&#34;,
</span></span><span class="line"><span class="cl">      &#34;&lt;/script&gt;&#34;})
</span></span><span class="line"><span class="cl">    void updateAuthorValues(Author author);
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="bind" class="headerLink">
    <a href="#bind" class="header-mark"></a>bind</h4><p><code>bind</code> 元素允许你在 OGNL 表达式以外创建一个变量，并将其绑定到当前的上下文。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectBlogsLike&#34; resultType=&#34;Blog&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;bind name=&#34;pattern&#34; value=&#34;&#39;%&#39; + _parameter.getTitle() + &#39;%&#39;&#34; /&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG
</span></span><span class="line"><span class="cl">  WHERE title LIKE #{pattern}
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="多数据库支持" class="headerLink">
    <a href="#%e5%a4%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e6%94%af%e6%8c%81" class="header-mark"></a>多数据库支持</h4><p>如果配置了 databaseIdProvider，你就可以在动态代码中使用名为 “_databaseId” 的变量来为不同的数据库构建特定的语句。比如下面的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;insert id=&#34;insert&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;selectKey keyProperty=&#34;id&#34; resultType=&#34;int&#34; order=&#34;BEFORE&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;if test=&#34;_databaseId == &#39;oracle&#39;&#34;&gt;
</span></span><span class="line"><span class="cl">      select seq_users.nextval from dual
</span></span><span class="line"><span class="cl">    &lt;/if&gt;
</span></span><span class="line"><span class="cl">    &lt;if test=&#34;_databaseId == &#39;db2&#39;&#34;&gt;
</span></span><span class="line"><span class="cl">      select nextval for seq_users from sysibm.sysdummy1&#34;
</span></span><span class="line"><span class="cl">    &lt;/if&gt;
</span></span><span class="line"><span class="cl">  &lt;/selectKey&gt;
</span></span><span class="line"><span class="cl">  insert into users values (#{id}, #{name})
</span></span><span class="line"><span class="cl">&lt;/insert&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="动态-sql-中的插入脚本语言" class="headerLink">
    <a href="#%e5%8a%a8%e6%80%81-sql-%e4%b8%ad%e7%9a%84%e6%8f%92%e5%85%a5%e8%84%9a%e6%9c%ac%e8%af%ad%e8%a8%80" class="header-mark"></a>动态 SQL 中的插入脚本语言</h4><p>MyBatis 从 3.2 版本开始支持插入脚本语言，这允许你插入一种语言驱动，并基于这种语言来编写动态 SQL 查询语句。</p>
<p>可以通过实现以下接口来插入一种语言：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface LanguageDriver {
</span></span><span class="line"><span class="cl">  ParameterHandler createParameterHandler(MappedStatement mappedStatement, Object parameterObject, BoundSql boundSql);
</span></span><span class="line"><span class="cl">  SqlSource createSqlSource(Configuration configuration, XNode script, Class&lt;?&gt; parameterType);
</span></span><span class="line"><span class="cl">  SqlSource createSqlSource(Configuration configuration, String script, Class&lt;?&gt; parameterType);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>实现自定义语言驱动后，你就可以在 mybatis-config.xml 文件中将它设置为默认语言：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;typeAliases&gt;
</span></span><span class="line"><span class="cl">  &lt;typeAlias type=&#34;org.sample.MyLanguageDriver&#34; alias=&#34;myLanguage&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/typeAliases&gt;
</span></span><span class="line"><span class="cl">&lt;settings&gt;
</span></span><span class="line"><span class="cl">  &lt;setting name=&#34;defaultScriptingLanguage&#34; value=&#34;myLanguage&#34;/&gt;
</span></span><span class="line"><span class="cl">&lt;/settings&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者，你也可以使用 <code>lang</code> 属性为特定的语句指定语言：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;select id=&#34;selectBlog&#34; lang=&#34;myLanguage&#34;&gt;
</span></span><span class="line"><span class="cl">  SELECT * FROM BLOG
</span></span><span class="line"><span class="cl">&lt;/select&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者，在你的 mapper 接口上添加 <code>@Lang</code> 注解：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface Mapper {
</span></span><span class="line"><span class="cl">  @Lang(MyLanguageDriver.class)
</span></span><span class="line"><span class="cl">  @Select(&#34;SELECT * FROM BLOG&#34;)
</span></span><span class="line"><span class="cl">  List&lt;Blog&gt; selectBlog();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>提示</strong> 可以使用 Apache Velocity 作为动态语言，更多细节请参考 MyBatis-Velocity 项目。</p>
<p>你前面看到的所有 xml 标签都由默认 MyBatis 语言提供，而它由语言驱动 <code>org.apache.ibatis.scripting.xmltags.XmlLanguageDriver</code>（别名为 <code>xml</code>）所提供。</p>
<h2 id="扩展" class="headerLink">
    <a href="#%e6%89%a9%e5%b1%95" class="header-mark"></a>扩展</h2><h3 id="mybatis-plus" class="headerLink">
    <a href="#mybatis-plus" class="header-mark"></a>MyBatis-Plus</h3><p><a href="https://baomidou.com/" target="_blank" rel="noopener noreferrer">MyBatis-Plus</a>（简称 MP）是一个 MyBatis 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p>
<iframe
  class="website-card-embed"
  data-src="https://website-card-embed.dramacat.top/?url=https%3a%2f%2fbaomidou.com%2fpages%2f24112f%2f%23%25E7%2589%25B9%25E6%2580%25A7"
  style="width: 100%; height: 124px"
  frameborder="no"
></iframe>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;groupId&gt;</span>com.baomidou<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;artifactId&gt;</span>mybatis-plus-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;version&gt;</span>${mybatis-plus.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;groupId&gt;</span>com.baomidou<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;artifactId&gt;</span>mybatis-plus-generator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;version&gt;</span>${mybatis-plus-generator.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">	 <span class="nt">&lt;groupId&gt;</span>org.apache.velocity<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">	 <span class="nt">&lt;artifactId&gt;</span>velocity-engine-core<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">	 <span class="nt">&lt;version&gt;</span>${velocity.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">top.orionpax.learnspringboot.generator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.baomidou.mybatisplus.core.exceptions.MybatisPlusException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.baomidou.mybatisplus.generator.FastAutoGenerator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.baomidou.mybatisplus.generator.config.DataSourceConfig</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.baomidou.mybatisplus.generator.config.OutputFile</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Arrays</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collections</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Scanner</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * MyBatis Plus 逆向生成工具类
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author pax
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @since 2021-09-29
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyBatisPlusCodeGenerator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/** 数据源配置 */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DataSourceConfig</span><span class="p">.</span><span class="na">Builder</span><span class="w"> </span><span class="n">DATA_SOURCE_CONFIG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataSourceConfig</span><span class="p">.</span><span class="na">Builder</span><span class="p">(</span><span class="s">&#34;jdbc:mysql://host:port/database&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;username&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;password&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/** 根路径配置 */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">ROOT_PATH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;ROOT_PATH&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/** 父包名配置 */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">PARENT_PACKAGE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;PARENT_PACKAGE_NAME&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/** 过滤表前缀配置 */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">TABLE_PREFIX_LIST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#34;T_&#34;</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 执行 run
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scanner</span><span class="p">(</span><span class="s">&#34;作者&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">moduleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scanner</span><span class="p">(</span><span class="s">&#34;模块名&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">tableNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scanner</span><span class="p">(</span><span class="s">&#34;表名&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">FastAutoGenerator</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">DATA_SOURCE_CONFIG</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 全局配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">globalConfig</span><span class="p">(</span><span class="n">builder</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">builder</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置输出目录</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">outputDir</span><span class="p">(</span><span class="n">ROOT_PATH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;java&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置作者</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">author</span><span class="p">(</span><span class="n">author</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 包配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">packageConfig</span><span class="p">((</span><span class="n">scanner</span><span class="p">,</span><span class="w"> </span><span class="n">builder</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">builder</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置父包名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">parent</span><span class="p">(</span><span class="n">PARENT_PACKAGE_NAME</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置mapperXml生成路径</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">pathInfo</span><span class="p">(</span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonMap</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">.</span><span class="na">mapperXml</span><span class="p">,</span><span class="w"> </span><span class="n">ROOT_PATH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;resources/mapper/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">moduleName</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置模块名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">moduleName</span><span class="p">(</span><span class="n">moduleName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 策略配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">strategyConfig</span><span class="p">(</span><span class="n">builder</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">builder</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置表名，多个英文逗号分隔</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">addInclude</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">tableNames</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">)))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置过滤表前缀</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">addTablePrefix</span><span class="p">(</span><span class="n">TABLE_PREFIX_LIST</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置开启 lombok 模型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">entityBuilder</span><span class="p">().</span><span class="na">enableLombok</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置开启 启用 BaseResultMap 生成、启用 BaseColumnList 生成</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">mapperBuilder</span><span class="p">().</span><span class="na">enableBaseResultMap</span><span class="p">().</span><span class="na">enableBaseColumnList</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 设置开启生成 @RestController 控制器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">controllerBuilder</span><span class="p">().</span><span class="na">enableRestStyle</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 读取控制台内容
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">scanner</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">tip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Scanner</span><span class="w"> </span><span class="n">scanner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;请输入&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tip</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;：&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scanner</span><span class="p">.</span><span class="na">hasNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">scanner</span><span class="p">.</span><span class="na">next</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MybatisPlusException</span><span class="p">(</span><span class="s">&#34;请输入正确的&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tip</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;！&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="java-api" class="headerLink">
    <a href="#java-api" class="header-mark"></a>Java API</h3><p>既然你已经知道如何配置 MyBatis 以及如何创建映射，是时候来尝点甜头了。MyBatis 的 Java API 就是这个甜头。稍后你将看到，和 JDBC 相比，MyBatis 大幅简化你的代码并力图保持其简洁、容易理解和维护。为了使得 SQL 映射更加优秀，MyBatis 3 引入了许多重要的改进。</p>
<h4 id="目录结构" class="headerLink">
    <a href="#%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84" class="header-mark"></a>目录结构</h4><p>在我们深入 Java API 之前，理解关于目录结构的最佳实践是很重要的。MyBatis 非常灵活，你可以随意安排你的文件。但和其它框架一样，目录结构有一种最佳实践。</p>
<p>让我们看一下典型的应用目录结构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/my_application
</span></span><span class="line"><span class="cl">  /bin
</span></span><span class="line"><span class="cl">  /devlib
</span></span><span class="line"><span class="cl">  /lib                &lt;-- MyBatis *.jar 文件在这里。
</span></span><span class="line"><span class="cl">  /src
</span></span><span class="line"><span class="cl">    /org/myapp/
</span></span><span class="line"><span class="cl">      /action
</span></span><span class="line"><span class="cl">      /data           &lt;-- MyBatis 配置文件在这里，包括映射器类、XML 配置、XML 映射文件。
</span></span><span class="line"><span class="cl">        /mybatis-config.xml
</span></span><span class="line"><span class="cl">        /BlogMapper.java
</span></span><span class="line"><span class="cl">        /BlogMapper.xml
</span></span><span class="line"><span class="cl">      /model
</span></span><span class="line"><span class="cl">      /service
</span></span><span class="line"><span class="cl">      /view
</span></span><span class="line"><span class="cl">    /properties       &lt;-- 在 XML 配置中出现的属性值在这里。
</span></span><span class="line"><span class="cl">  /test
</span></span><span class="line"><span class="cl">    /org/myapp/
</span></span><span class="line"><span class="cl">      /action
</span></span><span class="line"><span class="cl">      /data
</span></span><span class="line"><span class="cl">      /model
</span></span><span class="line"><span class="cl">      /service
</span></span><span class="line"><span class="cl">      /view
</span></span><span class="line"><span class="cl">    /properties
</span></span><span class="line"><span class="cl">  /web
</span></span><span class="line"><span class="cl">    /WEB-INF
</span></span><span class="line"><span class="cl">      /web.xml
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然，这是推荐的目录结构，并非强制要求，但使用一个通用的目录结构将更有利于大家沟通。</p>
<p>本章接下来的示例将假定你遵循这种目录结构。</p>
<h4 id="sqlsession-1" class="headerLink">
    <a href="#sqlsession-1" class="header-mark"></a>SqlSession</h4><p>使用 MyBatis 的主要 Java 接口就是 SqlSession。你可以通过这个接口来执行命令，获取映射器实例和管理事务。在介绍 SqlSession 接口之前，我们先来了解如何获取一个 SqlSession 实例。SqlSessions 是由 SqlSessionFactory 实例创建的。SqlSessionFactory 对象包含创建 SqlSession 实例的各种方法。而 SqlSessionFactory 本身是由 SqlSessionFactoryBuilder 创建的，它可以从 XML、注解或 Java 配置代码来创建 SqlSessionFactory。</p>
<p><strong>提示</strong> 当 Mybatis 与一些依赖注入框架（如 Spring 或者 Guice）搭配使用时，SqlSession 将被依赖注入框架创建并注入，所以你不需要使用 SqlSessionFactoryBuilder 或者 SqlSessionFactory，可以直接阅读 SqlSession 这一节。请参考 Mybatis-Spring 或者 Mybatis-Guice 手册以了解更多信息。</p>
<h5 id="sqlsessionfactorybuilder-1" class="headerLink">
    <a href="#sqlsessionfactorybuilder-1" class="header-mark"></a>SqlSessionFactoryBuilder</h5><p>SqlSessionFactoryBuilder 有五个 build() 方法，每一种都允许你从不同的资源中创建一个 SqlSessionFactory 实例。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SqlSessionFactory build(InputStream inputStream)
</span></span><span class="line"><span class="cl">SqlSessionFactory build(InputStream inputStream, String environment)
</span></span><span class="line"><span class="cl">SqlSessionFactory build(InputStream inputStream, Properties properties)
</span></span><span class="line"><span class="cl">SqlSessionFactory build(InputStream inputStream, String env, Properties props)
</span></span><span class="line"><span class="cl">SqlSessionFactory build(Configuration config)
</span></span></code></pre></td></tr></table>
</div>
</div><p>第一种方法是最常用的，它接受一个指向 XML 文件（也就是之前讨论的 mybatis-config.xml 文件）的 InputStream 实例。可选的参数是 environment 和 properties。environment 决定加载哪种环境，包括数据源和事务管理器。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;environments default=&#34;development&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;environment id=&#34;development&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;transactionManager type=&#34;JDBC&#34;&gt;
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">    &lt;dataSource type=&#34;POOLED&#34;&gt;
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">  &lt;/environment&gt;
</span></span><span class="line"><span class="cl">  &lt;environment id=&#34;production&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;transactionManager type=&#34;MANAGED&#34;&gt;
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">    &lt;dataSource type=&#34;JNDI&#34;&gt;
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">  &lt;/environment&gt;
</span></span><span class="line"><span class="cl">&lt;/environments&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果你调用了带 environment 参数的 build 方法，那么 MyBatis 将使用该环境对应的配置。当然，如果你指定了一个无效的环境，会收到错误。如果你调用了不带 environment 参数的 build 方法，那么就会使用默认的环境配置（在上面的示例中，通过 default=&ldquo;development&rdquo; 指定了默认环境）。</p>
<p>如果你调用了接受 properties 实例的方法，那么 MyBatis 就会加载这些属性，并在配置中提供使用。绝大多数场合下，可以用 ${propName} 形式引用这些配置值。</p>
<p>回想一下，在 mybatis-config.xml 中，可以引用属性值，也可以直接指定属性值。因此，理解属性的优先级是很重要的。在之前的文档中，我们已经介绍过了相关内容，但为了方便查阅，这里再重新介绍一下：</p>
<hr>
<p>如果一个属性存在于下面的多个位置，那么 MyBatis 将按照以下顺序来加载它们：</p>
<ul>
<li>首先，读取在 properties 元素体中指定的属性；</li>
<li>其次，读取在 properties 元素的类路径 resource 或 url 指定的属性，且会覆盖已经指定了的重复属性；</li>
<li>最后，读取作为方法参数传递的属性，且会覆盖已经从 properties 元素体和 resource 或 url 属性中加载了的重复属性。</li>
</ul>
<p>因此，通过方法参数传递的属性的优先级最高，resource 或 url 指定的属性优先级中等，在 properties 元素体中指定的属性优先级最低。</p>
<hr>
<p>总结一下，前四个方法很大程度上是相同的，但提供了不同的覆盖选项，允许你可选地指定 environment 和/或 properties。以下给出一个从 mybatis-config.xml 文件创建 SqlSessionFactory 的示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">String resource = &#34;org/mybatis/builder/mybatis-config.xml&#34;;
</span></span><span class="line"><span class="cl">InputStream inputStream = Resources.getResourceAsStream(resource);
</span></span><span class="line"><span class="cl">SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
</span></span><span class="line"><span class="cl">SqlSessionFactory factory = builder.build(inputStream);
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意，这里我们使用了 Resources 工具类，这个类在 org.apache.ibatis.io 包中。Resources 类正如其名，会帮助你从类路径下、文件系统或一个 web URL 中加载资源文件。在略读该类的源代码或用 IDE 查看该类信息后，你会发现一整套相当实用的方法。这里给出一个简表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">URL</span> <span class="n">getResourceURL</span><span class="p">(</span><span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">URL</span> <span class="n">getResourceURL</span><span class="p">(</span><span class="n">ClassLoader</span> <span class="n">loader</span><span class="p">,</span> <span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">InputStream</span> <span class="n">getResourceAsStream</span><span class="p">(</span><span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">InputStream</span> <span class="n">getResourceAsStream</span><span class="p">(</span><span class="n">ClassLoader</span> <span class="n">loader</span><span class="p">,</span> <span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Properties</span> <span class="n">getResourceAsProperties</span><span class="p">(</span><span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Properties</span> <span class="n">getResourceAsProperties</span><span class="p">(</span><span class="n">ClassLoader</span> <span class="n">loader</span><span class="p">,</span> <span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Reader</span> <span class="n">getResourceAsReader</span><span class="p">(</span><span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Reader</span> <span class="n">getResourceAsReader</span><span class="p">(</span><span class="n">ClassLoader</span> <span class="n">loader</span><span class="p">,</span> <span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="ne">File</span> <span class="n">getResourceAsFile</span><span class="p">(</span><span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="ne">File</span> <span class="n">getResourceAsFile</span><span class="p">(</span><span class="n">ClassLoader</span> <span class="n">loader</span><span class="p">,</span> <span class="ne">String</span> <span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">InputStream</span> <span class="n">getUrlAsStream</span><span class="p">(</span><span class="ne">String</span> <span class="n">urlString</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Reader</span> <span class="n">getUrlAsReader</span><span class="p">(</span><span class="ne">String</span> <span class="n">urlString</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Properties</span> <span class="n">getUrlAsProperties</span><span class="p">(</span><span class="ne">String</span> <span class="n">urlString</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Class</span> <span class="n">classForName</span><span class="p">(</span><span class="ne">String</span> <span class="n">className</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后一个 build 方法接受一个 Configuration 实例。Configuration 类包含了对一个 SqlSessionFactory 实例你可能关心的所有内容。在检查配置时，Configuration 类很有用，它允许你查找和操纵 SQL 映射（但当应用开始接收请求时不推荐使用）。你之前学习过的所有配置开关都存在于 Configuration 类，只不过它们是以 Java API 形式暴露的。以下是一个简单的示例，演示如何手动配置 Configuration 实例，然后将它传递给 build() 方法来创建 SqlSessionFactory。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">DataSource dataSource = BaseDataTest.createBlogDataSource();
</span></span><span class="line"><span class="cl">TransactionFactory transactionFactory = new JdbcTransactionFactory();
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Environment environment = new Environment(&#34;development&#34;, transactionFactory, dataSource);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Configuration configuration = new Configuration(environment);
</span></span><span class="line"><span class="cl">configuration.setLazyLoadingEnabled(true);
</span></span><span class="line"><span class="cl">configuration.setEnhancementEnabled(true);
</span></span><span class="line"><span class="cl">configuration.getTypeAliasRegistry().registerAlias(Blog.class);
</span></span><span class="line"><span class="cl">configuration.getTypeAliasRegistry().registerAlias(Post.class);
</span></span><span class="line"><span class="cl">configuration.getTypeAliasRegistry().registerAlias(Author.class);
</span></span><span class="line"><span class="cl">configuration.addMapper(BoundBlogMapper.class);
</span></span><span class="line"><span class="cl">configuration.addMapper(BoundAuthorMapper.class);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
</span></span><span class="line"><span class="cl">SqlSessionFactory factory = builder.build(configuration);
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在你就获得一个可以用来创建 SqlSession 实例的 SqlSessionFactory 了。</p>
<h5 id="sqlsessionfactory-1" class="headerLink">
    <a href="#sqlsessionfactory-1" class="header-mark"></a>SqlSessionFactory</h5><p>SqlSessionFactory 有六个方法创建 SqlSession 实例。通常来说，当你选择其中一个方法时，你需要考虑以下几点：</p>
<ul>
<li><strong>事务处理</strong>：你希望在 session 作用域中使用事务作用域，还是使用自动提交（auto-commit）？（对很多数据库和/或 JDBC 驱动来说，等同于关闭事务支持）</li>
<li><strong>数据库连接</strong>：你希望 MyBatis 帮你从已配置的数据源获取连接，还是使用自己提供的连接？</li>
<li><strong>语句执行</strong>：你希望 MyBatis 复用 PreparedStatement 和/或批量更新语句（包括插入语句和删除语句）吗？</li>
</ul>
<p>基于以上需求，有下列已重载的多个 openSession() 方法供使用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SqlSession openSession()
</span></span><span class="line"><span class="cl">SqlSession openSession(boolean autoCommit)
</span></span><span class="line"><span class="cl">SqlSession openSession(Connection connection)
</span></span><span class="line"><span class="cl">SqlSession openSession(TransactionIsolationLevel level)
</span></span><span class="line"><span class="cl">SqlSession openSession(ExecutorType execType, TransactionIsolationLevel level)
</span></span><span class="line"><span class="cl">SqlSession openSession(ExecutorType execType)
</span></span><span class="line"><span class="cl">SqlSession openSession(ExecutorType execType, boolean autoCommit)
</span></span><span class="line"><span class="cl">SqlSession openSession(ExecutorType execType, Connection connection)
</span></span><span class="line"><span class="cl">Configuration getConfiguration();
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认的 openSession() 方法没有参数，它会创建具备如下特性的 SqlSession：</p>
<ul>
<li>事务作用域将会开启（也就是不自动提交）。</li>
<li>将由当前环境配置的 DataSource 实例中获取 Connection 对象。</li>
<li>事务隔离级别将会使用驱动或数据源的默认设置。</li>
<li>预处理语句不会被复用，也不会批量处理更新。</li>
</ul>
<p>相信你已经能从方法签名中知道这些方法的区别。向 <code>autoCommit</code> 可选参数传递 <code>true</code> 值即可开启自动提交功能。若要使用自己的 <code>Connection</code> 实例，传递一个 <code>Connection</code> 实例给 <code>connection</code> 参数即可。注意，我们没有提供同时设置 <code>Connection</code> 和 <code>autoCommit</code> 的方法，这是因为 MyBatis 会依据传入的 Connection 来决定是否启用 autoCommit。对于事务隔离级别，MyBatis 使用了一个 Java 枚举包装器来表示，称为 <code>TransactionIsolationLevel</code>，事务隔离级别支持 JDBC 的五个隔离级别（<code>NONE</code>、<code>READ_UNCOMMITTED</code>、<code>READ_COMMITTED</code>、<code>REPEATABLE_READ</code> 和 <code>SERIALIZABLE</code>），并且与预期的行为一致。</p>
<p>你可能对 <code>ExecutorType</code> 参数感到陌生。这个枚举类型定义了三个值:</p>
<ul>
<li><code>ExecutorType.SIMPLE</code>：该类型的执行器没有特别的行为。它为每个语句的执行创建一个新的预处理语句。</li>
<li><code>ExecutorType.REUSE</code>：该类型的执行器会复用预处理语句。</li>
<li><code>ExecutorType.BATCH</code>：该类型的执行器会批量执行所有更新语句，如果 SELECT 在多个更新中间执行，将在必要时将多条更新语句分隔开来，以方便理解。</li>
</ul>
<p><strong>提示</strong> 在 SqlSessionFactory 中还有一个方法我们没有提及，就是 getConfiguration()。这个方法会返回一个 Configuration 实例，你可以在运行时使用它来检查 MyBatis 的配置。</p>
<p><strong>提示</strong> 如果你使用过 MyBatis 的旧版本，可能还记得 session、事务和批量操作是相互独立的。在新版本中则不是这样。上述三者都包含在 session 作用域内。你不必分别处理事务或批量操作就能得到想要的全部效果。</p>
<h5 id="sqlsession-2" class="headerLink">
    <a href="#sqlsession-2" class="header-mark"></a>SqlSession</h5><p>正如之前所提到的，SqlSession 在 MyBatis 中是非常强大的一个类。它包含了所有执行语句、提交或回滚事务以及获取映射器实例的方法。</p>
<p>SqlSession 类的方法超过了 20 个，为了方便理解，我们将它们分成几种组别。</p>
<h6 id="语句执行方法" class="headerLink">
    <a href="#%e8%af%ad%e5%8f%a5%e6%89%a7%e8%a1%8c%e6%96%b9%e6%b3%95" class="header-mark"></a>语句执行方法</h6><p>这些方法被用来执行定义在 SQL 映射 XML 文件中的 SELECT、INSERT、UPDATE 和 DELETE 语句。你可以通过名字快速了解它们的作用，每一方法都接受语句的 ID 以及参数对象，参数可以是原始类型（支持自动装箱或包装类）、JavaBean、POJO 或 Map。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;T&gt; T selectOne(String statement, Object parameter)
</span></span><span class="line"><span class="cl">&lt;E&gt; List&lt;E&gt; selectList(String statement, Object parameter)
</span></span><span class="line"><span class="cl">&lt;T&gt; Cursor&lt;T&gt; selectCursor(String statement, Object parameter)
</span></span><span class="line"><span class="cl">&lt;K,V&gt; Map&lt;K,V&gt; selectMap(String statement, Object parameter, String mapKey)
</span></span><span class="line"><span class="cl">int insert(String statement, Object parameter)
</span></span><span class="line"><span class="cl">int update(String statement, Object parameter)
</span></span><span class="line"><span class="cl">int delete(String statement, Object parameter)
</span></span></code></pre></td></tr></table>
</div>
</div><p>selectOne 和 selectList 的不同仅仅是 selectOne 必须返回一个对象或 null 值。如果返回值多于一个，就会抛出异常。如果你不知道返回对象会有多少，请使用 selectList。如果需要查看某个对象是否存在，最好的办法是查询一个 count 值（0 或 1）。selectMap 稍微特殊一点，它会将返回对象的其中一个属性作为 key 值，将对象作为 value 值，从而将多个结果集转为 Map 类型值。由于并不是所有语句都需要参数，所以这些方法都具有一个不需要参数的重载形式。</p>
<p>游标（Cursor）与列表（List）返回的结果相同，不同的是，游标借助迭代器实现了数据的惰性加载。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">try (Cursor&lt;MyEntity&gt; entities = session.selectCursor(statement, param)) {
</span></span><span class="line"><span class="cl">   for (MyEntity entity:entities) {
</span></span><span class="line"><span class="cl">      // 处理单个实体
</span></span><span class="line"><span class="cl">   }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>insert、update 以及 delete 方法返回的值表示受该语句影响的行数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;T&gt; T selectOne(String statement)
</span></span><span class="line"><span class="cl">&lt;E&gt; List&lt;E&gt; selectList(String statement)
</span></span><span class="line"><span class="cl">&lt;T&gt; Cursor&lt;T&gt; selectCursor(String statement)
</span></span><span class="line"><span class="cl">&lt;K,V&gt; Map&lt;K,V&gt; selectMap(String statement, String mapKey)
</span></span><span class="line"><span class="cl">int insert(String statement)
</span></span><span class="line"><span class="cl">int update(String statement)
</span></span><span class="line"><span class="cl">int delete(String statement)
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后，还有 select 方法的三个高级版本，它们允许你限制返回行数的范围，或是提供自定义结果处理逻辑，通常在数据集非常庞大的情形下使用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;E&gt; List&lt;E&gt; selectList (String statement, Object parameter, RowBounds rowBounds)
</span></span><span class="line"><span class="cl">&lt;T&gt; Cursor&lt;T&gt; selectCursor(String statement, Object parameter, RowBounds rowBounds)
</span></span><span class="line"><span class="cl">&lt;K,V&gt; Map&lt;K,V&gt; selectMap(String statement, Object parameter, String mapKey, RowBounds rowbounds)
</span></span><span class="line"><span class="cl">void select (String statement, Object parameter, ResultHandler&lt;T&gt; handler)
</span></span><span class="line"><span class="cl">void select (String statement, Object parameter, RowBounds rowBounds, ResultHandler&lt;T&gt; handler)
</span></span></code></pre></td></tr></table>
</div>
</div><p>RowBounds 参数会告诉 MyBatis 略过指定数量的记录，并限制返回结果的数量。RowBounds 类的 offset 和 limit 值只有在构造函数时才能传入，其它时候是不能修改的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int offset = 100;
</span></span><span class="line"><span class="cl">int limit = 25;
</span></span><span class="line"><span class="cl">RowBounds rowBounds = new RowBounds(offset, limit);
</span></span></code></pre></td></tr></table>
</div>
</div><p>数据库驱动决定了略过记录时的查询效率。为了获得最佳的性能，建议将 ResultSet 类型设置为 SCROLL_SENSITIVE 或 SCROLL_INSENSITIVE（换句话说：不要使用 FORWARD_ONLY）。</p>
<p>ResultHandler 参数允许自定义每行结果的处理过程。你可以将它添加到 List 中、创建 Map 和 Set，甚至丢弃每个返回值，只保留计算后的统计结果。你可以使用 ResultHandler 做很多事，这其实就是 MyBatis 构建 结果列表的内部实现办法。</p>
<p>从版本 3.4.6 开始，<code>ResultHandler</code> 会在存储过程的 REFCURSOR 输出参数中传递使用的 <code>CALLABLE</code> 语句。</p>
<p>它的接口很简单：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">ibatis</span><span class="o">.</span><span class="n">session</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">public</span> <span class="n">interface</span> <span class="n">ResultHandler</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">void</span> <span class="n">handleResult</span><span class="p">(</span><span class="n">ResultContext</span><span class="o">&lt;</span><span class="err">?</span> <span class="k">extends</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ResultContext 参数允许你访问结果对象和当前已被创建的对象数目，另外还提供了一个返回值为 Boolean 的 stop 方法，你可以使用此 stop 方法来停止 MyBatis 加载更多的结果。</p>
<p>使用 ResultHandler 的时候需要注意以下两个限制：</p>
<ul>
<li>使用带 ResultHandler 参数的方法时，收到的数据不会被缓存。</li>
<li>当使用高级的结果映射集（resultMap）时，MyBatis 很可能需要数行结果来构造一个对象。如果你使用了 ResultHandler，你可能会接收到关联（association）或者集合（collection）中尚未被完整填充的对象。</li>
</ul>
<h6 id="立即批量更新方法" class="headerLink">
    <a href="#%e7%ab%8b%e5%8d%b3%e6%89%b9%e9%87%8f%e6%9b%b4%e6%96%b0%e6%96%b9%e6%b3%95" class="header-mark"></a>立即批量更新方法</h6><p>当你将 <code>ExecutorType</code> 设置为 <code>ExecutorType.BATCH</code> 时，可以使用这个方法清除（执行）缓存在 JDBC 驱动类中的批量更新语句。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">List&lt;BatchResult&gt; flushStatements()
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="事务控制方法" class="headerLink">
    <a href="#%e4%ba%8b%e5%8a%a1%e6%8e%a7%e5%88%b6%e6%96%b9%e6%b3%95" class="header-mark"></a>事务控制方法</h6><p>有四个方法用来控制事务作用域。当然，如果你已经设置了自动提交或你使用了外部事务管理器，这些方法就没什么作用了。然而，如果你正在使用由 Connection 实例控制的 JDBC 事务管理器，那么这四个方法就会派上用场：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void commit()
</span></span><span class="line"><span class="cl">void commit(boolean force)
</span></span><span class="line"><span class="cl">void rollback()
</span></span><span class="line"><span class="cl">void rollback(boolean force)
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认情况下 MyBatis 不会自动提交事务，除非它侦测到调用了插入、更新或删除方法改变了数据库。如果你没有使用这些方法提交修改，那么你可以在 commit 和 rollback 方法参数中传入 true 值，来保证事务被正常提交（注意，在自动提交模式或者使用了外部事务管理器的情况下，设置 force 值对 session 无效）。大部分情况下你无需调用 rollback()，因为 MyBatis 会在你没有调用 commit 时替你完成回滚操作。不过，当你要在一个可能多次提交或回滚的 session 中详细控制事务，回滚操作就派上用场了。</p>
<p><strong>提示</strong> MyBatis-Spring 和 MyBatis-Guice 提供了声明式事务处理，所以如果你在使用 Mybatis 的同时使用了 Spring 或者 Guice，请参考它们的手册以获取更多的内容。</p>
<h6 id="本地缓存" class="headerLink">
    <a href="#%e6%9c%ac%e5%9c%b0%e7%bc%93%e5%ad%98" class="header-mark"></a>本地缓存</h6><p>Mybatis 使用到了两种缓存：本地缓存（local cache）和二级缓存（second level cache）。</p>
<p>每当一个新 session 被创建，MyBatis 就会创建一个与之相关联的本地缓存。任何在 session 执行过的查询结果都会被保存在本地缓存中，所以，当再次执行参数相同的相同查询时，就不需要实际查询数据库了。本地缓存将会在做出修改、事务提交或回滚，以及关闭 session 时清空。</p>
<p>默认情况下，本地缓存数据的生命周期等同于整个 session 的周期。由于缓存会被用来解决循环引用问题和加快重复嵌套查询的速度，所以无法将其完全禁用。但是你可以通过设置 localCacheScope=STATEMENT 来只在语句执行时使用缓存。</p>
<p>注意，如果 localCacheScope 被设置为 SESSION，对于某个对象，MyBatis 将返回在本地缓存中唯一对象的引用。对返回的对象（例如 list）做出的任何修改将会影响本地缓存的内容，进而将会影响到在本次 session 中从缓存返回的值。因此，不要对 MyBatis 所返回的对象作出更改，以防后患。</p>
<p>你可以随时调用以下方法来清空本地缓存：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void clearCache()
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="确保-sqlsession-被关闭" class="headerLink">
    <a href="#%e7%a1%ae%e4%bf%9d-sqlsession-%e8%a2%ab%e5%85%b3%e9%97%ad" class="header-mark"></a>确保 SqlSession 被关闭</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于你打开的任何 session，你都要保证它们被妥善关闭，这很重要。保证妥善关闭的最佳代码模式是这样的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SqlSession session = sqlSessionFactory.openSession();
</span></span><span class="line"><span class="cl">try (SqlSession session = sqlSessionFactory.openSession()) {
</span></span><span class="line"><span class="cl">    // 假设下面三行代码是你的业务逻辑
</span></span><span class="line"><span class="cl">    session.insert(...);
</span></span><span class="line"><span class="cl">    session.update(...);
</span></span><span class="line"><span class="cl">    session.delete(...);
</span></span><span class="line"><span class="cl">    session.commit();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>提示</strong> 和 SqlSessionFactory 一样，你可以调用当前使用的 SqlSession 的 getConfiguration 方法来获得 Configuration 实例。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Configuration getConfiguration()
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="使用映射器" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8%e6%98%a0%e5%b0%84%e5%99%a8" class="header-mark"></a>使用映射器</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;T&gt; T getMapper(Class&lt;T&gt; type)
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述的各个 insert、update、delete 和 select 方法都很强大，但也有些繁琐，它们并不符合类型安全，对你的 IDE 和单元测试也不是那么友好。因此，使用映射器类来执行映射语句是更常见的做法。</p>
<p>我们已经在之前的入门章节中见到过一个使用映射器的示例。一个映射器类就是一个仅需声明与 SqlSession 方法相匹配方法的接口。下面的示例展示了一些方法签名以及它们是如何映射到 SqlSession 上的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public interface AuthorMapper {
</span></span><span class="line"><span class="cl">  // (Author) selectOne(&#34;selectAuthor&#34;,5);
</span></span><span class="line"><span class="cl">  Author selectAuthor(int id);
</span></span><span class="line"><span class="cl">  // (List&lt;Author&gt;) selectList(“selectAuthors”)
</span></span><span class="line"><span class="cl">  List&lt;Author&gt; selectAuthors();
</span></span><span class="line"><span class="cl">  // (Map&lt;Integer,Author&gt;) selectMap(&#34;selectAuthors&#34;, &#34;id&#34;)
</span></span><span class="line"><span class="cl">  @MapKey(&#34;id&#34;)
</span></span><span class="line"><span class="cl">  Map&lt;Integer, Author&gt; selectAuthors();
</span></span><span class="line"><span class="cl">  // insert(&#34;insertAuthor&#34;, author)
</span></span><span class="line"><span class="cl">  int insertAuthor(Author author);
</span></span><span class="line"><span class="cl">  // updateAuthor(&#34;updateAuthor&#34;, author)
</span></span><span class="line"><span class="cl">  int updateAuthor(Author author);
</span></span><span class="line"><span class="cl">  // delete(&#34;deleteAuthor&#34;,5)
</span></span><span class="line"><span class="cl">  int deleteAuthor(int id);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>总之，每个映射器方法签名应该匹配相关联的 SqlSession 方法，字符串参数 ID 无需匹配。而是由方法名匹配映射语句的 ID。</p>
<p>此外，返回类型必须匹配期望的结果类型，返回单个值时，返回类型应该是返回值的类，返回多个值时，则为数组或集合类，另外也可以是游标（Cursor）。所有常用的类型都是支持的，包括：原始类型、Map、POJO 和 JavaBean。</p>
<p><strong>提示</strong> 映射器接口不需要去实现任何接口或继承自任何类。只要方法签名可以被用来唯一识别对应的映射语句就可以了。</p>
<p><strong>提示</strong> 映射器接口可以继承自其他接口。在使用 XML 来绑定映射器接口时，保证语句处于合适的命名空间中即可。唯一的限制是，不能在两个具有继承关系的接口中拥有相同的方法签名（这是潜在的危险做法，不可取）。</p>
<p>你可以传递多个参数给一个映射器方法。在多个参数的情况下，默认它们将会以 param 加上它们在参数列表中的位置来命名，比如：#{param1}、#{param2}等。如果你想（在有多个参数时）自定义参数的名称，那么你可以在参数上使用 @Param(&ldquo;paramName&rdquo;) 注解。</p>
<p>你也可以给方法传递一个 RowBounds 实例来限制查询结果。</p>
<h6 id="映射器注解" class="headerLink">
    <a href="#%e6%98%a0%e5%b0%84%e5%99%a8%e6%b3%a8%e8%a7%a3" class="header-mark"></a>映射器注解</h6><p>设计初期的 MyBatis 是一个 XML 驱动的框架。配置信息是基于 XML 的，映射语句也是定义在 XML 中的。而在 MyBatis 3 中，我们提供了其它的配置方式。MyBatis 3 构建在全面且强大的基于 Java 语言的配置 API 之上。它是 XML 和注解配置的基础。注解提供了一种简单且低成本的方式来实现简单的映射语句。</p>
<p><strong>提示</strong> 不幸的是，Java 注解的表达能力和灵活性十分有限。尽管我们花了很多时间在调查、设计和试验上，但最强大的 MyBatis 映射并不能用注解来构建——我们真没开玩笑。而 C# 属性就没有这些限制，因此 MyBatis.NET 的配置会比 XML 有更大的选择余地。虽说如此，基于 Java 注解的配置还是有它的好处的。</p>
<p><strong>注解如下表所示：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">注解</th>
<th style="text-align:left">使用对象</th>
<th style="text-align:left">XML 等价形式</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>@CacheNamespace</code></td>
<td style="text-align:left"><code>类</code></td>
<td style="text-align:left"><code>&lt;cache&gt;</code></td>
<td style="text-align:left">为给定的命名空间（比如类）配置缓存。属性：<code>implemetation</code>、<code>eviction</code>、<code>flushInterval</code>、<code>size</code>、<code>readWrite</code>、<code>blocking</code>、<code>properties</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Property</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left"><code>&lt;property&gt;</code></td>
<td style="text-align:left">指定参数值或占位符（placeholder）（该占位符能被 <code>mybatis-config.xml</code> 内的配置属性替换）。属性：<code>name</code>、<code>value</code>。（仅在 MyBatis 3.4.2 以上可用）</td>
</tr>
<tr>
<td style="text-align:left"><code>@CacheNamespaceRef</code></td>
<td style="text-align:left"><code>类</code></td>
<td style="text-align:left"><code>&lt;cacheRef&gt;</code></td>
<td style="text-align:left">引用另外一个命名空间的缓存以供使用。注意，即使共享相同的全限定类名，在 XML 映射文件中声明的缓存仍被识别为一个独立的命名空间。属性：<code>value</code>、<code>name</code>。如果你使用了这个注解，你应设置 <code>value</code> 或者 <code>name</code> 属性的其中一个。<code>value</code> 属性用于指定能够表示该命名空间的 Java 类型（命名空间名就是该 Java 类型的全限定类名），<code>name</code> 属性（这个属性仅在 MyBatis 3.4.2 以上可用）则直接指定了命名空间的名字。</td>
</tr>
<tr>
<td style="text-align:left"><code>@ConstructorArgs</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left"><code>&lt;constructor&gt;</code></td>
<td style="text-align:left">收集一组结果以传递给一个结果对象的构造方法。属性：<code>value</code>，它是一个 <code>Arg</code> 数组。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Arg</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left"><code>&lt;arg&gt;``&lt;idArg&gt;</code></td>
<td style="text-align:left">ConstructorArgs 集合的一部分，代表一个构造方法参数。属性：<code>id</code>、<code>column</code>、<code>javaType</code>、<code>jdbcType</code>、<code>typeHandler</code>、<code>select</code>、<code>resultMap</code>。id 属性和 XML 元素 <code>&lt;idArg&gt;</code> 相似，它是一个布尔值，表示该属性是否用于唯一标识和比较对象。从版本 3.5.4 开始，该注解变为可重复注解。</td>
</tr>
<tr>
<td style="text-align:left"><code>@TypeDiscriminator</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left"><code>&lt;discriminator&gt;</code></td>
<td style="text-align:left">决定使用何种结果映射的一组取值（case）。属性：<code>column</code>、<code>javaType</code>、<code>jdbcType</code>、<code>typeHandler</code>、<code>cases</code>。cases 属性是一个 <code>Case</code> 的数组。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Case</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left"><code>&lt;case&gt;</code></td>
<td style="text-align:left">表示某个值的一个取值以及该取值对应的映射。属性：<code>value</code>、<code>type</code>、<code>results</code>。results 属性是一个 <code>Results</code> 的数组，因此这个注解实际上和 <code>ResultMap</code> 很相似，由下面的 <code>Results</code> 注解指定。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Results</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left"><code>&lt;resultMap&gt;</code></td>
<td style="text-align:left">一组结果映射，指定了对某个特定结果列，映射到某个属性或字段的方式。属性：<code>value</code>、<code>id</code>。value 属性是一个 <code>Result</code> 注解的数组。而 id 属性则是结果映射的名称。从版本 3.5.4 开始，该注解变为可重复注解。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Result</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left"><code>&lt;result&gt;``&lt;id&gt;</code></td>
<td style="text-align:left">在列和属性或字段之间的单个结果映射。属性：<code>id</code>、<code>column</code>、<code>javaType</code>、<code>jdbcType</code>、<code>typeHandler</code>、<code>one</code>、<code>many</code>。id 属性和 XML 元素 <code>&lt;id&gt;</code> 相似，它是一个布尔值，表示该属性是否用于唯一标识和比较对象。one 属性是一个关联，和 <code>&lt;association&gt;</code> 类似，而 many 属性则是集合关联，和 <code>&lt;collection&gt;</code> 类似。这样命名是为了避免产生名称冲突。</td>
</tr>
<tr>
<td style="text-align:left"><code>@One</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left"><code>&lt;association&gt;</code></td>
<td style="text-align:left">复杂类型的单个属性映射。属性： <code>select</code>，指定可加载合适类型实例的映射语句（也就是映射器方法）全限定名； <code>fetchType</code>，指定在该映射中覆盖全局配置参数 <code>lazyLoadingEnabled</code>； <code>resultMap</code>（3.5.5 以上可用）, 结果集的完全限定名，该结果映射到查询结果中的集合对象； <code>columnPrefix</code>（3.5.5 以上可用），在嵌套的结果集中对所查询的列进行分组的列前缀。 <strong>提示</strong> 注解 API 不支持联合映射。这是由于 Java 注解不允许产生循环引用。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Many</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left"><code>&lt;collection&gt;</code></td>
<td style="text-align:left">复杂类型的集合属性映射。属性： <code>select</code>，指定可加载合适类型实例集合的映射语句（也就是映射器方法）全限定名； <code>fetchType</code>，指定在该映射中覆盖全局配置参数 <code>lazyLoadingEnabled</code> ； <code>resultMap</code>（3.5.5 以上可用），结果集的完全限定名，该结果映射到查询结果中的集合对象； <code>columnPrefix</code>（3.5.5 以上可用），在嵌套的结果集中对所查询的列进行分组的列前缀。 <strong>提示</strong> 注解 API 不支持联合映射。这是由于 Java 注解不允许产生循环引用。</td>
</tr>
<tr>
<td style="text-align:left"><code>@MapKey</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left"></td>
<td style="text-align:left">供返回值为 Map 的方法使用的注解。它使用对象的某个属性作为 key，将对象 List 转化为 Map。属性：<code>value</code>，指定作为 Map 的 key 值的对象属性名。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Options</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left">映射语句的属性</td>
<td style="text-align:left">该注解允许你指定大部分开关和配置选项，它们通常在映射语句上作为属性出现。与在注解上提供大量的属性相比，<code>Options</code> 注解提供了一致、清晰的方式来指定选项。属性：<code>useCache=true</code>、<code>flushCache=FlushCachePolicy.DEFAULT</code>、<code>resultSetType=DEFAULT</code>、<code>statementType=PREPARED</code>、<code>fetchSize=-1</code>、<code>timeout=-1</code>、<code>useGeneratedKeys=false</code>、<code>keyProperty=&quot;&quot;</code>、<code>keyColumn=&quot;&quot;</code>、<code>resultSets=&quot;&quot;</code>, <code>databaseId=&quot;&quot;</code>。注意，Java 注解无法指定 <code>null</code> 值。因此，一旦你使用了 <code>Options</code> 注解，你的语句就会被上述属性的默认值所影响。要注意避免默认值带来的非预期行为。 <code>databaseId</code>（3.5.5 以上可用）, 如果有一个配置好的 <code>DatabaseIdProvider</code>, MyBatis 会加载不带 <code>databaseId</code> 属性和带有匹配当前数据库 <code>databaseId</code> 属性的所有语句。如果同时存在带 <code>databaseId</code> 和不带 <code>databaseId</code> 属性的相同语句，则后者会被舍弃。 注意：<code>keyColumn</code> 属性只在某些数据库中有效（如 Oracle、PostgreSQL 等）。要了解更多关于 <code>keyColumn</code> 和 <code>keyProperty</code> 可选值信息，请查看“insert, update 和 delete”一节。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Insert``@Update``@Delete``@Select</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left"><code>&lt;insert&gt;``&lt;update&gt;``&lt;delete&gt;``&lt;select&gt;</code></td>
<td style="text-align:left">每个注解分别代表将会被执行的 SQL 语句。它们用字符串数组（或单个字符串）作为参数。如果传递的是字符串数组，字符串数组会被连接成单个完整的字符串，每个字符串之间加入一个空格。这有效地避免了用 Java 代码构建 SQL 语句时产生的“丢失空格”问题。当然，你也可以提前手动连接好字符串。属性：<code>value</code>，指定用来组成单个 SQL 语句的字符串数组。 <code>databaseId</code>（3.5.5 以上可用）, 如果有一个配置好的 <code>DatabaseIdProvider</code>, MyBatis 会加载不带 <code>databaseId</code> 属性和带有匹配当前数据库 <code>databaseId</code> 属性的所有语句。如果同时存在带 <code>databaseId</code> 和不带 <code>databaseId</code> 属性的相同语句，则后者会被舍弃。</td>
</tr>
<tr>
<td style="text-align:left"><code>@InsertProvider``@UpdateProvider``@DeleteProvider``@SelectProvider</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left"><code>&lt;insert&gt;``&lt;update&gt;``&lt;delete&gt;``&lt;select&gt;</code></td>
<td style="text-align:left">允许构建动态 SQL。这些备选的 SQL 注解允许你指定返回 SQL 语句的类和方法，以供运行时执行。（从 MyBatis 3.4.6 开始，可以使用 <code>CharSequence</code> 代替 <code>String</code> 来作为返回类型）。当执行映射语句时，MyBatis 会实例化注解指定的类，并调用注解指定的方法。你可以通过 <code>ProviderContext</code> 传递映射方法接收到的参数、&ldquo;Mapper interface type&rdquo; 和 &ldquo;Mapper method&rdquo;（仅在 MyBatis 3.4.5 以上支持）作为参数。（MyBatis 3.4 以上支持传入多个参数） 属性：<code>value</code>、<code>type</code>、<code>method</code>、<code>databaseId</code>。 <code>value</code> and <code>type</code> 属性用于指定类名 (<code>type</code> 属性是 <code>value</code> 的别名, 你必须指定任意一个。 但是你如果在全局配置中指定 <code>defaultSqlProviderType</code> ，两个属性都可以忽略)。 <code>method</code> 用于指定该类的方法名（从版本 3.5.1 开始，可以省略 <code>method</code> 属性，MyBatis 将会使用 <code>ProviderMethodResolver</code> 接口解析方法的具体实现。如果解析失败，MyBatis 将会使用名为 <code>provideSql</code> 的降级实现）。<strong>提示</strong> 接下来的“SQL 语句构建器”一章将会讨论该话题，以帮助你以更清晰、更便于阅读的方式构建动态 SQL。 <code>databaseId</code>（3.5.5 以上可用）, 如果有一个配置好的 <code>DatabaseIdProvider</code>, MyBatis 会加载不带 <code>databaseId</code> 属性和带有匹配当前数据库 <code>databaseId</code> 属性的所有语句。如果同时存在带 <code>databaseId</code> 和不带 <code>databaseId</code> 属性的相同语句，则后者会被舍弃。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Param</code></td>
<td style="text-align:left"><code>参数</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">如果你的映射方法接受多个参数，就可以使用这个注解自定义每个参数的名字。否则在默认情况下，除 <code>RowBounds</code> 以外的参数会以 &ldquo;param&rdquo; 加参数位置被命名。例如 <code>#{param1}</code>, <code>#{param2}</code>。如果使用了 <code>@Param(&quot;person&quot;)</code>，参数就会被命名为 <code>#{person}</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>@SelectKey</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left"><code>&lt;selectKey&gt;</code></td>
<td style="text-align:left">这个注解的功能与 <code>&lt;selectKey&gt;</code> 标签完全一致。该注解只能在 <code>@Insert</code> 或 <code>@InsertProvider</code> 或 <code>@Update</code> 或 <code>@UpdateProvider</code> 标注的方法上使用，否则将会被忽略。如果标注了 <code>@SelectKey</code> 注解，MyBatis 将会忽略掉由 <code>@Options</code> 注解所设置的生成主键或设置（configuration）属性。属性：<code>statement</code> 以字符串数组形式指定将会被执行的 SQL 语句，<code>keyProperty</code> 指定作为参数传入的对象对应属性的名称，该属性将会更新成新的值，<code>before</code> 可以指定为 <code>true</code> 或 <code>false</code> 以指明 SQL 语句应被在插入语句的之前还是之后执行。<code>resultType</code> 则指定 <code>keyProperty</code> 的 Java 类型。<code>statementType</code> 则用于选择语句类型，可以选择 <code>STATEMENT</code>、<code>PREPARED</code> 或 <code>CALLABLE</code> 之一，它们分别对应于 <code>Statement</code>、<code>PreparedStatement</code> 和 <code>CallableStatement</code>。默认值是 <code>PREPARED</code>。 <code>databaseId</code>（3.5.5 以上可用）, 如果有一个配置好的 <code>DatabaseIdProvider</code>, MyBatis 会加载不带 <code>databaseId</code> 属性和带有匹配当前数据库 <code>databaseId</code> 属性的所有语句。如果同时存在带 <code>databaseId</code> 和不带 <code>databaseId</code> 属性的相同语句，则后者会被舍弃。</td>
</tr>
<tr>
<td style="text-align:left"><code>@ResultMap</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">这个注解为 <code>@Select</code> 或者 <code>@SelectProvider</code> 注解指定 XML 映射中 <code>&lt;resultMap&gt;</code> 元素的 id。这使得注解的 select 可以复用已在 XML 中定义的 ResultMap。如果标注的 select 注解中存在 <code>@Results</code> 或者 <code>@ConstructorArgs</code> 注解，这两个注解将被此注解覆盖。</td>
</tr>
<tr>
<td style="text-align:left"><code>@ResultType</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">在使用了结果处理器的情况下，需要使用此注解。由于此时的返回类型为 void，所以 Mybatis 需要有一种方法来判断每一行返回的对象类型。如果在 XML 有对应的结果映射，请使用 <code>@ResultMap</code> 注解。如果结果类型在 XML 的 <code>&lt;select&gt;</code> 元素中指定了，就不需要使用其它注解了。否则就需要使用此注解。比如，如果一个标注了 @Select 的方法想要使用结果处理器，那么它的返回类型必须是 void，并且必须使用这个注解（或者 @ResultMap）。这个注解仅在方法返回类型是 void 的情况下生效。</td>
</tr>
<tr>
<td style="text-align:left"><code>@Flush</code></td>
<td style="text-align:left"><code>方法</code></td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">如果使用了这个注解，定义在 Mapper 接口中的方法就能够调用 <code>SqlSession#flushStatements()</code> 方法。（Mybatis 3.3 以上可用）</td>
</tr>
</tbody>
</table>
<h6 id="映射注解示例" class="headerLink">
    <a href="#%e6%98%a0%e5%b0%84%e6%b3%a8%e8%a7%a3%e7%a4%ba%e4%be%8b" class="header-mark"></a>映射注解示例</h6><p>这个例子展示了如何使用 @SelectKey 注解来在插入前读取数据库序列的值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Insert(&#34;insert into table3 (id, name) values(#{nameId}, #{name})&#34;)
</span></span><span class="line"><span class="cl">@SelectKey(statement=&#34;call next value for TestSequence&#34;, keyProperty=&#34;nameId&#34;, before=true, resultType=int.class)
</span></span><span class="line"><span class="cl">int insertTable3(Name name);
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子展示了如何使用 @SelectKey 注解来在插入后读取数据库自增列的值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Insert(&#34;insert into table2 (name) values(#{name})&#34;)
</span></span><span class="line"><span class="cl">@SelectKey(statement=&#34;call identity()&#34;, keyProperty=&#34;nameId&#34;, before=false, resultType=int.class)
</span></span><span class="line"><span class="cl">int insertTable2(Name name);
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子展示了如何使用 <code>@Flush</code> 注解来调用 <code>SqlSession#flushStatements()</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Flush
</span></span><span class="line"><span class="cl">List&lt;BatchResult&gt; flush();
</span></span></code></pre></td></tr></table>
</div>
</div><p>这些例子展示了如何通过指定 @Result 的 id 属性来命名结果集：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Results(id = &#34;userResult&#34;, value = {
</span></span><span class="line"><span class="cl">  @Result(property = &#34;id&#34;, column = &#34;uid&#34;, id = true),
</span></span><span class="line"><span class="cl">  @Result(property = &#34;firstName&#34;, column = &#34;first_name&#34;),
</span></span><span class="line"><span class="cl">  @Result(property = &#34;lastName&#34;, column = &#34;last_name&#34;)
</span></span><span class="line"><span class="cl">})
</span></span><span class="line"><span class="cl">@Select(&#34;select * from users where id = #{id}&#34;)
</span></span><span class="line"><span class="cl">User getUserById(Integer id);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@Results(id = &#34;companyResults&#34;)
</span></span><span class="line"><span class="cl">@ConstructorArgs({
</span></span><span class="line"><span class="cl">  @Arg(column = &#34;cid&#34;, javaType = Integer.class, id = true),
</span></span><span class="line"><span class="cl">  @Arg(column = &#34;name&#34;, javaType = String.class)
</span></span><span class="line"><span class="cl">})
</span></span><span class="line"><span class="cl">@Select(&#34;select * from company where id = #{id}&#34;)
</span></span><span class="line"><span class="cl">Company getCompanyById(Integer id);
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子展示了如何使用单个参数的 @SqlProvider 注解：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@SelectProvider(type = UserSqlBuilder.class, method = &#34;buildGetUsersByName&#34;)
</span></span><span class="line"><span class="cl">List&lt;User&gt; getUsersByName(String name);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class UserSqlBuilder {
</span></span><span class="line"><span class="cl">  public static String buildGetUsersByName(final String name) {
</span></span><span class="line"><span class="cl">    return new SQL(){{
</span></span><span class="line"><span class="cl">      SELECT(&#34;*&#34;);
</span></span><span class="line"><span class="cl">      FROM(&#34;users&#34;);
</span></span><span class="line"><span class="cl">      if (name != null) {
</span></span><span class="line"><span class="cl">        WHERE(&#34;name like #{value} || &#39;%&#39;&#34;);
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">      ORDER_BY(&#34;id&#34;);
</span></span><span class="line"><span class="cl">    }}.toString();
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子展示了如何使用多个参数的 @SqlProvider 注解：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@SelectProvider(type = UserSqlBuilder.class, method = &#34;buildGetUsersByName&#34;)
</span></span><span class="line"><span class="cl">List&lt;User&gt; getUsersByName(
</span></span><span class="line"><span class="cl">    @Param(&#34;name&#34;) String name, @Param(&#34;orderByColumn&#34;) String orderByColumn);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class UserSqlBuilder {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  // 如果不使用 @Param，就应该定义与 mapper 方法相同的参数
</span></span><span class="line"><span class="cl">  public static String buildGetUsersByName(
</span></span><span class="line"><span class="cl">      final String name, final String orderByColumn) {
</span></span><span class="line"><span class="cl">    return new SQL(){{
</span></span><span class="line"><span class="cl">      SELECT(&#34;*&#34;);
</span></span><span class="line"><span class="cl">      FROM(&#34;users&#34;);
</span></span><span class="line"><span class="cl">      WHERE(&#34;name like #{name} || &#39;%&#39;&#34;);
</span></span><span class="line"><span class="cl">      ORDER_BY(orderByColumn);
</span></span><span class="line"><span class="cl">    }}.toString();
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  // 如果使用 @Param，就可以只定义需要使用的参数
</span></span><span class="line"><span class="cl">  public static String buildGetUsersByName(@Param(&#34;orderByColumn&#34;) final String orderByColumn) {
</span></span><span class="line"><span class="cl">    return new SQL(){{
</span></span><span class="line"><span class="cl">      SELECT(&#34;*&#34;);
</span></span><span class="line"><span class="cl">      FROM(&#34;users&#34;);
</span></span><span class="line"><span class="cl">      WHERE(&#34;name like #{name} || &#39;%&#39;&#34;);
</span></span><span class="line"><span class="cl">      ORDER_BY(orderByColumn);
</span></span><span class="line"><span class="cl">    }}.toString();
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这是一个在全局配置下让所有映射方法在同一个 sql provider 类里面的例子（3.5.6 后可用）:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Configuration configuration = new Configuration();
</span></span><span class="line"><span class="cl">configuration.setDefaultSqlProviderType(TemplateFilePathProvider.class); // 让所有映射方法在同一个 sql provider 类里面
</span></span><span class="line"><span class="cl">// ...
</span></span><span class="line"><span class="cl">// 在 sql provider 注解上可以省略 type/value 属性
</span></span><span class="line"><span class="cl">// 如果省略，MyBatis 将使用 defaultSqlProviderType 所指定的类
</span></span><span class="line"><span class="cl">public interface UserMapper {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  @SelectProvider // 等价于 @SelectProvider(TemplateFilePathProvider.class)
</span></span><span class="line"><span class="cl">  User findUser(int id);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  @InsertProvider // 等价于 @InsertProvider(TemplateFilePathProvider.class)
</span></span><span class="line"><span class="cl">  void createUser(User user);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  @UpdateProvider // 等价于 @UpdateProvider(TemplateFilePathProvider.class)
</span></span><span class="line"><span class="cl">  void updateUser(User user);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  @DeleteProvider // 等价于 @DeleteProvider(TemplateFilePathProvider.class)
</span></span><span class="line"><span class="cl">  void deleteUser(int id);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>以下例子展示了 <code>ProviderMethodResolver</code>（3.5.1 后可用）的默认实现使用方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@SelectProvider(UserSqlProvider.class)
</span></span><span class="line"><span class="cl">List&lt;User&gt; getUsersByName(String name);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// 在你的 provider 类中实现 ProviderMethodResolver 接口
</span></span><span class="line"><span class="cl">class UserSqlProvider implements ProviderMethodResolver {
</span></span><span class="line"><span class="cl">  // 默认实现中，会将映射器方法的调用解析到实现的同名方法上
</span></span><span class="line"><span class="cl">  public static String getUsersByName(final String name) {
</span></span><span class="line"><span class="cl">    return new SQL(){{
</span></span><span class="line"><span class="cl">      SELECT(&#34;*&#34;);
</span></span><span class="line"><span class="cl">      FROM(&#34;users&#34;);
</span></span><span class="line"><span class="cl">      if (name != null) {
</span></span><span class="line"><span class="cl">        WHERE(&#34;name like #{value} || &#39;%&#39;&#34;);
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">      ORDER_BY(&#34;id&#34;);
</span></span><span class="line"><span class="cl">    }}.toString();
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子展现了如何在声明注解时使用 <code>databaseId</code> 属性（3.5.5 后可用）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Select(value = &#34;SELECT SYS_GUID() FROM dual&#34;, databaseId = &#34;oracle&#34;) // 如果 DatabaseIdProvider 提供的是 &#34;oracle&#34;，使用这条语句
</span></span><span class="line"><span class="cl">@Select(value = &#34;SELECT uuid_generate_v4()&#34;, databaseId = &#34;postgres&#34;) // 如果 DatabaseIdProvider 提供的是 &#34;postgres&#34;，使用这条语句
</span></span><span class="line"><span class="cl">@Select(&#34;SELECT RANDOM_UUID()&#34;) // 如果 DatabaseIdProvider 没有配置或者没有对应的 databaseId, 使用这条语句
</span></span><span class="line"><span class="cl">String generateId();
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="sql-语句构建器" class="headerLink">
    <a href="#sql-%e8%af%ad%e5%8f%a5%e6%9e%84%e5%bb%ba%e5%99%a8" class="header-mark"></a>SQL 语句构建器</h3><h4 id="问题" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98" class="header-mark"></a>问题</h4><p>Java 程序员面对的最痛苦的事情之一就是在 Java 代码中嵌入 SQL 语句。这通常是因为需要动态生成 SQL 语句，不然我们可以将它们放到外部文件或者存储过程中。如你所见，MyBatis 在 XML 映射中具备强大的 SQL 动态生成能力。但有时，我们还是需要在 Java 代码里构建 SQL 语句。此时，MyBatis 有另外一个特性可以帮到你，让你从处理典型问题中解放出来，比如加号、引号、换行、格式化问题、嵌入条件的逗号管理及 AND 连接。确实，在 Java 代码中动态生成 SQL 代码真的就是一场噩梦。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">String sql = &#34;SELECT P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME, &#34;
</span></span><span class="line"><span class="cl">&#34;P.LAST_NAME,P.CREATED_ON, P.UPDATED_ON &#34; +
</span></span><span class="line"><span class="cl">&#34;FROM PERSON P, ACCOUNT A &#34; +
</span></span><span class="line"><span class="cl">&#34;INNER JOIN DEPARTMENT D on D.ID = P.DEPARTMENT_ID &#34; +
</span></span><span class="line"><span class="cl">&#34;INNER JOIN COMPANY C on D.COMPANY_ID = C.ID &#34; +
</span></span><span class="line"><span class="cl">&#34;WHERE (P.ID = A.ID AND P.FIRST_NAME like ?) &#34; +
</span></span><span class="line"><span class="cl">&#34;OR (P.LAST_NAME like ?) &#34; +
</span></span><span class="line"><span class="cl">&#34;GROUP BY P.ID &#34; +
</span></span><span class="line"><span class="cl">&#34;HAVING (P.LAST_NAME like ?) &#34; +
</span></span><span class="line"><span class="cl">&#34;OR (P.FIRST_NAME like ?) &#34; +
</span></span><span class="line"><span class="cl">&#34;ORDER BY P.ID, P.FULL_NAME&#34;;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="解决方案" class="headerLink">
    <a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" class="header-mark"></a>解决方案</h4><p>MyBatis 3 提供了方便的工具类来帮助解决此问题。借助 SQL 类，我们只需要简单地创建一个实例，并调用它的方法即可生成 SQL 语句。让我们来用 SQL 类重写上面的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">private String selectPersonSql() {
</span></span><span class="line"><span class="cl">  return new SQL() {{
</span></span><span class="line"><span class="cl">    SELECT(&#34;P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME&#34;);
</span></span><span class="line"><span class="cl">    SELECT(&#34;P.LAST_NAME, P.CREATED_ON, P.UPDATED_ON&#34;);
</span></span><span class="line"><span class="cl">    FROM(&#34;PERSON P&#34;);
</span></span><span class="line"><span class="cl">    FROM(&#34;ACCOUNT A&#34;);
</span></span><span class="line"><span class="cl">    INNER_JOIN(&#34;DEPARTMENT D on D.ID = P.DEPARTMENT_ID&#34;);
</span></span><span class="line"><span class="cl">    INNER_JOIN(&#34;COMPANY C on D.COMPANY_ID = C.ID&#34;);
</span></span><span class="line"><span class="cl">    WHERE(&#34;P.ID = A.ID&#34;);
</span></span><span class="line"><span class="cl">    WHERE(&#34;P.FIRST_NAME like ?&#34;);
</span></span><span class="line"><span class="cl">    OR();
</span></span><span class="line"><span class="cl">    WHERE(&#34;P.LAST_NAME like ?&#34;);
</span></span><span class="line"><span class="cl">    GROUP_BY(&#34;P.ID&#34;);
</span></span><span class="line"><span class="cl">    HAVING(&#34;P.LAST_NAME like ?&#34;);
</span></span><span class="line"><span class="cl">    OR();
</span></span><span class="line"><span class="cl">    HAVING(&#34;P.FIRST_NAME like ?&#34;);
</span></span><span class="line"><span class="cl">    ORDER_BY(&#34;P.ID&#34;);
</span></span><span class="line"><span class="cl">    ORDER_BY(&#34;P.FULL_NAME&#34;);
</span></span><span class="line"><span class="cl">  }}.toString();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子有什么特别之处吗？仔细看一下你会发现，你不用担心可能会重复出现的 &ldquo;AND&rdquo; 关键字，或者要做出用 &ldquo;WHERE&rdquo; 拼接还是 &ldquo;AND&rdquo; 拼接还是不用拼接的选择。SQL 类已经为你处理了哪里应该插入 &ldquo;WHERE&rdquo;、哪里应该使用 &ldquo;AND&rdquo; 的问题，并帮你完成所有的字符串拼接工作。</p>
<h4 id="sql-类" class="headerLink">
    <a href="#sql-%e7%b1%bb" class="header-mark"></a>SQL 类</h4><p>这里有一些示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// 匿名内部类风格
</span></span><span class="line"><span class="cl">public String deletePersonSql() {
</span></span><span class="line"><span class="cl">  return new SQL() {{
</span></span><span class="line"><span class="cl">    DELETE_FROM(&#34;PERSON&#34;);
</span></span><span class="line"><span class="cl">    WHERE(&#34;ID = #{id}&#34;);
</span></span><span class="line"><span class="cl">  }}.toString();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Builder / Fluent 风格
</span></span><span class="line"><span class="cl">public String insertPersonSql() {
</span></span><span class="line"><span class="cl">  String sql = new SQL()
</span></span><span class="line"><span class="cl">    .INSERT_INTO(&#34;PERSON&#34;)
</span></span><span class="line"><span class="cl">    .VALUES(&#34;ID, FIRST_NAME&#34;, &#34;#{id}, #{firstName}&#34;)
</span></span><span class="line"><span class="cl">    .VALUES(&#34;LAST_NAME&#34;, &#34;#{lastName}&#34;)
</span></span><span class="line"><span class="cl">    .toString();
</span></span><span class="line"><span class="cl">  return sql;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// 动态条件（注意参数需要使用 final 修饰，以便匿名内部类对它们进行访问）
</span></span><span class="line"><span class="cl">public String selectPersonLike(final String id, final String firstName, final String lastName) {
</span></span><span class="line"><span class="cl">  return new SQL() {{
</span></span><span class="line"><span class="cl">    SELECT(&#34;P.ID, P.USERNAME, P.PASSWORD, P.FIRST_NAME, P.LAST_NAME&#34;);
</span></span><span class="line"><span class="cl">    FROM(&#34;PERSON P&#34;);
</span></span><span class="line"><span class="cl">    if (id != null) {
</span></span><span class="line"><span class="cl">      WHERE(&#34;P.ID like #{id}&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    if (firstName != null) {
</span></span><span class="line"><span class="cl">      WHERE(&#34;P.FIRST_NAME like #{firstName}&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    if (lastName != null) {
</span></span><span class="line"><span class="cl">      WHERE(&#34;P.LAST_NAME like #{lastName}&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    ORDER_BY(&#34;P.LAST_NAME&#34;);
</span></span><span class="line"><span class="cl">  }}.toString();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public String deletePersonSql() {
</span></span><span class="line"><span class="cl">  return new SQL() {{
</span></span><span class="line"><span class="cl">    DELETE_FROM(&#34;PERSON&#34;);
</span></span><span class="line"><span class="cl">    WHERE(&#34;ID = #{id}&#34;);
</span></span><span class="line"><span class="cl">  }}.toString();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public String insertPersonSql() {
</span></span><span class="line"><span class="cl">  return new SQL() {{
</span></span><span class="line"><span class="cl">    INSERT_INTO(&#34;PERSON&#34;);
</span></span><span class="line"><span class="cl">    VALUES(&#34;ID, FIRST_NAME&#34;, &#34;#{id}, #{firstName}&#34;);
</span></span><span class="line"><span class="cl">    VALUES(&#34;LAST_NAME&#34;, &#34;#{lastName}&#34;);
</span></span><span class="line"><span class="cl">  }}.toString();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public String updatePersonSql() {
</span></span><span class="line"><span class="cl">  return new SQL() {{
</span></span><span class="line"><span class="cl">    UPDATE(&#34;PERSON&#34;);
</span></span><span class="line"><span class="cl">    SET(&#34;FIRST_NAME = #{firstName}&#34;);
</span></span><span class="line"><span class="cl">    WHERE(&#34;ID = #{id}&#34;);
</span></span><span class="line"><span class="cl">  }}.toString();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:left">方法</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>SELECT(String)``SELECT(String...)</code></td>
<td style="text-align:left">开始新的或追加到已有的 <code>SELECT</code>子句。可以被多次调用，参数会被追加到 <code>SELECT</code> 子句。 参数通常使用逗号分隔的列名和别名列表，但也可以是数据库驱动程序接受的任意参数。</td>
</tr>
<tr>
<td style="text-align:left"><code>SELECT_DISTINCT(String)``SELECT_DISTINCT(String...)</code></td>
<td style="text-align:left">开始新的或追加到已有的 <code>SELECT</code>子句，并添加 <code>DISTINCT</code> 关键字到生成的查询中。可以被多次调用，参数会被追加到 <code>SELECT</code> 子句。 参数通常使用逗号分隔的列名和别名列表，但也可以是数据库驱动程序接受的任意参数。</td>
</tr>
<tr>
<td style="text-align:left"><code>FROM(String)``FROM(String...)</code></td>
<td style="text-align:left">开始新的或追加到已有的 <code>FROM</code>子句。可以被多次调用，参数会被追加到 <code>FROM</code>子句。 参数通常是一个表名或别名，也可以是数据库驱动程序接受的任意参数。</td>
</tr>
<tr>
<td style="text-align:left"><code>JOIN(String)``JOIN(String...)``INNER_JOIN(String)``INNER_JOIN(String...)``LEFT_OUTER_JOIN(String)``LEFT_OUTER_JOIN(String...)``RIGHT_OUTER_JOIN(String)``RIGHT_OUTER_JOIN(String...)</code></td>
<td style="text-align:left">基于调用的方法，添加新的合适类型的 <code>JOIN</code> 子句。 参数可以包含一个由列和连接条件构成的标准连接。</td>
</tr>
<tr>
<td style="text-align:left"><code>WHERE(String)``WHERE(String...)</code></td>
<td style="text-align:left">插入新的 <code>WHERE</code> 子句条件，并使用 <code>AND</code> 拼接。可以被多次调用，对于每一次调用产生的新条件，会使用 <code>AND</code> 拼接起来。要使用 <code>OR</code> 分隔，请使用 <code>OR()</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>OR()</code></td>
<td style="text-align:left">使用 <code>OR</code> 来分隔当前的 <code>WHERE</code> 子句条件。 可以被多次调用，但在一行中多次调用会生成错误的 <code>SQL</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>AND()</code></td>
<td style="text-align:left">使用 <code>AND</code> 来分隔当前的 <code>WHERE</code>子句条件。 可以被多次调用，但在一行中多次调用会生成错误的 <code>SQL</code>。由于 <code>WHERE</code> 和 <code>HAVING</code>都会自动使用 <code>AND</code> 拼接, 因此这个方法并不常用，只是为了完整性才被定义出来。</td>
</tr>
<tr>
<td style="text-align:left"><code>GROUP_BY(String)``GROUP_BY(String...)</code></td>
<td style="text-align:left">追加新的 <code>GROUP BY</code> 子句，使用逗号拼接。可以被多次调用，每次调用都会使用逗号将新的条件拼接起来。</td>
</tr>
<tr>
<td style="text-align:left"><code>HAVING(String)``HAVING(String...)</code></td>
<td style="text-align:left">追加新的 <code>HAVING</code> 子句。使用 AND 拼接。可以被多次调用，每次调用都使用<code>AND</code>来拼接新的条件。要使用 <code>OR</code> 分隔，请使用 <code>OR()</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>ORDER_BY(String)``ORDER_BY(String...)</code></td>
<td style="text-align:left">追加新的 <code>ORDER BY</code> 子句，使用逗号拼接。可以多次被调用，每次调用会使用逗号拼接新的条件。</td>
</tr>
<tr>
<td style="text-align:left"><code>LIMIT(String)``LIMIT(int)</code></td>
<td style="text-align:left">追加新的 <code>LIMIT</code> 子句。 仅在 SELECT()、UPDATE()、DELETE() 时有效。 当在 SELECT() 中使用时，应该配合 OFFSET() 使用。（于 3.5.2 引入）</td>
</tr>
<tr>
<td style="text-align:left"><code>OFFSET(String)``OFFSET(long)</code></td>
<td style="text-align:left">追加新的 <code>OFFSET</code> 子句。 仅在 SELECT() 时有效。 当在 SELECT() 时使用时，应该配合 LIMIT() 使用。（于 3.5.2 引入）</td>
</tr>
<tr>
<td style="text-align:left"><code>OFFSET_ROWS(String)``OFFSET_ROWS(long)</code></td>
<td style="text-align:left">追加新的 <code>OFFSET n ROWS</code> 子句。 仅在 SELECT() 时有效。 该方法应该配合 FETCH_FIRST_ROWS_ONLY() 使用。（于 3.5.2 加入）</td>
</tr>
<tr>
<td style="text-align:left"><code>FETCH_FIRST_ROWS_ONLY(String)``FETCH_FIRST_ROWS_ONLY(int)</code></td>
<td style="text-align:left">追加新的 <code>FETCH FIRST n ROWS ONLY</code> 子句。 仅在 SELECT() 时有效。 该方法应该配合 OFFSET_ROWS() 使用。（于 3.5.2 加入）</td>
</tr>
<tr>
<td style="text-align:left"><code>DELETE_FROM(String)</code></td>
<td style="text-align:left">开始新的 delete 语句，并指定删除表的表名。通常它后面都会跟着一个 WHERE 子句！</td>
</tr>
<tr>
<td style="text-align:left"><code>INSERT_INTO(String)</code></td>
<td style="text-align:left">开始新的 insert 语句，并指定插入数据表的表名。后面应该会跟着一个或多个 VALUES() 调用，或 INTO_COLUMNS() 和 INTO_VALUES() 调用。</td>
</tr>
<tr>
<td style="text-align:left"><code>SET(String)``SET(String...)</code></td>
<td style="text-align:left">对 update 语句追加 &ldquo;set&rdquo; 属性的列表</td>
</tr>
<tr>
<td style="text-align:left"><code>UPDATE(String)</code></td>
<td style="text-align:left">开始新的 update 语句，并指定更新表的表名。后面都会跟着一个或多个 SET() 调用，通常也会有一个 WHERE() 调用。</td>
</tr>
<tr>
<td style="text-align:left"><code>VALUES(String, String)</code></td>
<td style="text-align:left">追加数据值到 insert 语句中。第一个参数是数据插入的列名，第二个参数则是数据值。</td>
</tr>
<tr>
<td style="text-align:left"><code>INTO_COLUMNS(String...)</code></td>
<td style="text-align:left">追加插入列子句到 insert 语句中。应与 INTO_VALUES() 一同使用。</td>
</tr>
<tr>
<td style="text-align:left"><code>INTO_VALUES(String...)</code></td>
<td style="text-align:left">追加插入值子句到 insert 语句中。应与 INTO_COLUMNS() 一同使用。</td>
</tr>
<tr>
<td style="text-align:left"><code>ADD_ROW()</code></td>
<td style="text-align:left">添加新的一行数据，以便执行批量插入。（于 3.5.2 引入）</td>
</tr>
</tbody>
</table>
<p><strong>提示</strong> 注意，SQL 类将原样插入 <code>LIMIT</code>、<code>OFFSET</code>、<code>OFFSET n ROWS</code> 以及 <code>FETCH FIRST n ROWS ONLY</code> 子句。换句话说，类库不会为不支持这些子句的数据库执行任何转换。 因此，用户应该要了解目标数据库是否支持这些子句。如果目标数据库不支持这些子句，产生的 SQL 可能会引起运行错误。</p>
<p>从版本 3.4.2 开始，你可以像下面这样使用可变长度参数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public String selectPersonSql() {
</span></span><span class="line"><span class="cl">  return new SQL()
</span></span><span class="line"><span class="cl">    .SELECT(&#34;P.ID&#34;, &#34;A.USERNAME&#34;, &#34;A.PASSWORD&#34;, &#34;P.FULL_NAME&#34;, &#34;D.DEPARTMENT_NAME&#34;, &#34;C.COMPANY_NAME&#34;)
</span></span><span class="line"><span class="cl">    .FROM(&#34;PERSON P&#34;, &#34;ACCOUNT A&#34;)
</span></span><span class="line"><span class="cl">    .INNER_JOIN(&#34;DEPARTMENT D on D.ID = P.DEPARTMENT_ID&#34;, &#34;COMPANY C on D.COMPANY_ID = C.ID&#34;)
</span></span><span class="line"><span class="cl">    .WHERE(&#34;P.ID = A.ID&#34;, &#34;P.FULL_NAME like #{name}&#34;)
</span></span><span class="line"><span class="cl">    .ORDER_BY(&#34;P.ID&#34;, &#34;P.FULL_NAME&#34;)
</span></span><span class="line"><span class="cl">    .toString();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public String insertPersonSql() {
</span></span><span class="line"><span class="cl">  return new SQL()
</span></span><span class="line"><span class="cl">    .INSERT_INTO(&#34;PERSON&#34;)
</span></span><span class="line"><span class="cl">    .INTO_COLUMNS(&#34;ID&#34;, &#34;FULL_NAME&#34;)
</span></span><span class="line"><span class="cl">    .INTO_VALUES(&#34;#{id}&#34;, &#34;#{fullName}&#34;)
</span></span><span class="line"><span class="cl">    .toString();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public String updatePersonSql() {
</span></span><span class="line"><span class="cl">  return new SQL()
</span></span><span class="line"><span class="cl">    .UPDATE(&#34;PERSON&#34;)
</span></span><span class="line"><span class="cl">    .SET(&#34;FULL_NAME = #{fullName}&#34;, &#34;DATE_OF_BIRTH = #{dateOfBirth}&#34;)
</span></span><span class="line"><span class="cl">    .WHERE(&#34;ID = #{id}&#34;)
</span></span><span class="line"><span class="cl">    .toString();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>从版本 3.5.2 开始，你可以像下面这样构建批量插入语句：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public String insertPersonsSql() {
</span></span><span class="line"><span class="cl">  // INSERT INTO PERSON (ID, FULL_NAME)
</span></span><span class="line"><span class="cl">  //     VALUES (#{mainPerson.id}, #{mainPerson.fullName}) , (#{subPerson.id}, #{subPerson.fullName})
</span></span><span class="line"><span class="cl">  return new SQL()
</span></span><span class="line"><span class="cl">    .INSERT_INTO(&#34;PERSON&#34;)
</span></span><span class="line"><span class="cl">    .INTO_COLUMNS(&#34;ID&#34;, &#34;FULL_NAME&#34;)
</span></span><span class="line"><span class="cl">    .INTO_VALUES(&#34;#{mainPerson.id}&#34;, &#34;#{mainPerson.fullName}&#34;)
</span></span><span class="line"><span class="cl">    .ADD_ROW()
</span></span><span class="line"><span class="cl">    .INTO_VALUES(&#34;#{subPerson.id}&#34;, &#34;#{subPerson.fullName}&#34;)
</span></span><span class="line"><span class="cl">    .toString();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>从版本 3.5.2 开始，你可以像下面这样构建限制返回结果数的 SELECT 语句,：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public String selectPersonsWithOffsetLimitSql() {
</span></span><span class="line"><span class="cl">  // SELECT id, name FROM PERSON
</span></span><span class="line"><span class="cl">  //     LIMIT #{limit} OFFSET #{offset}
</span></span><span class="line"><span class="cl">  return new SQL()
</span></span><span class="line"><span class="cl">    .SELECT(&#34;id&#34;, &#34;name&#34;)
</span></span><span class="line"><span class="cl">    .FROM(&#34;PERSON&#34;)
</span></span><span class="line"><span class="cl">    .LIMIT(&#34;#{limit}&#34;)
</span></span><span class="line"><span class="cl">    .OFFSET(&#34;#{offset}&#34;)
</span></span><span class="line"><span class="cl">    .toString();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public String selectPersonsWithFetchFirstSql() {
</span></span><span class="line"><span class="cl">  // SELECT id, name FROM PERSON
</span></span><span class="line"><span class="cl">  //     OFFSET #{offset} ROWS FETCH FIRST #{limit} ROWS ONLY
</span></span><span class="line"><span class="cl">  return new SQL()
</span></span><span class="line"><span class="cl">    .SELECT(&#34;id&#34;, &#34;name&#34;)
</span></span><span class="line"><span class="cl">    .FROM(&#34;PERSON&#34;)
</span></span><span class="line"><span class="cl">    .OFFSET_ROWS(&#34;#{offset}&#34;)
</span></span><span class="line"><span class="cl">    .FETCH_FIRST_ROWS_ONLY(&#34;#{limit}&#34;)
</span></span><span class="line"><span class="cl">    .toString();
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="spring-整合-mybatis-时mybatis-的一级缓存为何失效" class="headerLink">
    <a href="#spring-%e6%95%b4%e5%90%88-mybatis-%e6%97%b6mybatis-%e7%9a%84%e4%b8%80%e7%ba%a7%e7%bc%93%e5%ad%98%e4%b8%ba%e4%bd%95%e5%a4%b1%e6%95%88" class="header-mark"></a>Spring 整合 Mybatis 时，Mybatis 的一级缓存为何“失效”?</h3><p>Spring 整合 Mybatis 时，只有在事务内部 Mybatis 的一级缓存才会生效这是为什么呢？首先我们要知道 Mybatis 的一级缓存生效的范围是 SqlSession。那么从结果来看应该是只有在事务的内部，查询方法才会使用同一 SqlSession，而没有事务的时候应该是创建了新的 SqlSssion，让我们看源码确认下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Spring 在使用 SqlSession 对其进行了动态代理，其方法调用的拦截器就是 SqlSessionTemplate 的内部类 SqlSessionInterceptor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SqlSessionInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">InvocationHandler</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">SqlSessionInterceptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 在执行方法时获取到 SqlSession</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SqlSession</span><span class="w"> </span><span class="n">sqlSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SqlSessionUtils</span><span class="p">.</span><span class="na">getSqlSession</span><span class="p">(</span><span class="n">SqlSessionTemplate</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">sqlSessionFactory</span><span class="p">,</span><span class="w"> </span><span class="n">SqlSessionTemplate</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">executorType</span><span class="p">,</span><span class="w"> </span><span class="n">SqlSessionTemplate</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">exceptionTranslator</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">unwrapped</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Object</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">sqlSession</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">SqlSessionUtils</span><span class="p">.</span><span class="na">isSqlSessionTransactional</span><span class="p">(</span><span class="n">sqlSession</span><span class="p">,</span><span class="w"> </span><span class="n">SqlSessionTemplate</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">sqlSessionFactory</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">sqlSession</span><span class="p">.</span><span class="na">commit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">unwrapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">var11</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">unwrapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExceptionUtil</span><span class="p">.</span><span class="na">unwrapThrowable</span><span class="p">(</span><span class="n">var11</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SqlSessionTemplate</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">exceptionTranslator</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">unwrapped</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">PersistenceException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">SqlSessionUtils</span><span class="p">.</span><span class="na">closeSqlSession</span><span class="p">(</span><span class="n">sqlSession</span><span class="p">,</span><span class="w"> </span><span class="n">SqlSessionTemplate</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">sqlSessionFactory</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">sqlSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Throwable</span><span class="w"> </span><span class="n">translated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SqlSessionTemplate</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">exceptionTranslator</span><span class="p">.</span><span class="na">translateExceptionIfPossible</span><span class="p">((</span><span class="n">PersistenceException</span><span class="p">)</span><span class="n">unwrapped</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">translated</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">unwrapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">translated</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="p">)</span><span class="n">unwrapped</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sqlSession</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">SqlSessionUtils</span><span class="p">.</span><span class="na">closeSqlSession</span><span class="p">(</span><span class="n">sqlSession</span><span class="p">,</span><span class="w"> </span><span class="n">SqlSessionTemplate</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">sqlSessionFactory</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">unwrapped</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// 让我们再来看下 getSqlSession 方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">SqlSession</span><span class="w"> </span><span class="nf">getSqlSession</span><span class="p">(</span><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">sessionFactory</span><span class="p">,</span><span class="w"> </span><span class="n">ExecutorType</span><span class="w"> </span><span class="n">executorType</span><span class="p">,</span><span class="w"> </span><span class="n">PersistenceExceptionTranslator</span><span class="w"> </span><span class="n">exceptionTranslator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">notNull</span><span class="p">(</span><span class="n">sessionFactory</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;No SqlSessionFactory specified&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">notNull</span><span class="p">(</span><span class="n">executorType</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;No ExecutorType specified&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 维护了一个 SqlSessionHolder 用来关联事务和 SqlSession</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SqlSessionHolder</span><span class="w"> </span><span class="n">holder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SqlSessionHolder</span><span class="p">)</span><span class="n">TransactionSynchronizationManager</span><span class="p">.</span><span class="na">getResource</span><span class="p">(</span><span class="n">sessionFactory</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 首先从 SqlSessionHolder 里取 SqlSession</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SqlSession</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sessionHolder</span><span class="p">(</span><span class="n">executorType</span><span class="p">,</span><span class="w"> </span><span class="n">holder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">session</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 没有当前事务关联的 SqlSession 就直接创建一个新的返回</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">debug</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Creating a new SqlSession&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sessionFactory</span><span class="p">.</span><span class="na">openSession</span><span class="p">(</span><span class="n">executorType</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">registerSessionHolder</span><span class="p">(</span><span class="n">sessionFactory</span><span class="p">,</span><span class="w"> </span><span class="n">executorType</span><span class="p">,</span><span class="w"> </span><span class="n">exceptionTranslator</span><span class="p">,</span><span class="w"> </span><span class="n">session</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">session</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="应用场景" class="headerLink">
    <a href="#%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" class="header-mark"></a>应用场景</h2><h3 id="spring-boot-如何整合-mybatis" class="headerLink">
    <a href="#spring-boot-%e5%a6%82%e4%bd%95%e6%95%b4%e5%90%88-mybatis" class="header-mark"></a>Spring Boot 如何整合 Mybatis?</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># application.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 配置数据源</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/learn_mybatis?characterEncoding=utf-8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 配置Mybatis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mybatis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># 配置实体包的位置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type-aliases-package</span><span class="p">:</span><span class="w"> </span><span class="l">com.orionpax.learn.mybatis.entity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Mapper 接口和 Mapper.xml 不在同一包下时，配置 Mapper.xml 的位置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">mybatis.mapper-locations=classpath:mapper/*Mapper.xml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 配置开启懒加载</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">lazy-loading-enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- Mapper 接口和 Mapper.xml 在同一包下时配置 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;resources&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;resource&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;directory&gt;</span>src/main/java<span class="nt">&lt;/directory&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;includes&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/includes&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;filtering&gt;</span>false<span class="nt">&lt;/filtering&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/resource&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/resources&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 配置 Mapper 包的位置，如果不设置的话需要在每个 Mapper 接口上配置 @Mapper 注解。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@MapperScan</span><span class="p">(</span><span class="s">&#34;com.orionpax.learn.mybatis.mapper&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MybatisApplication</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">MybatisApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="如何使用逆向工程" class="headerLink">
    <a href="#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b" class="header-mark"></a>如何使用逆向工程？</h3><p>使用 Mybatis Generator 配置如下，实际更复杂的逆向工程的需求可以自己实现。</p>
<ol>
<li><code>pom.xml</code> 添加插件</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.mybatis.generator<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>mybatis-generator-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--允许移动生成的文件 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;verbose&gt;</span>true<span class="nt">&lt;/verbose&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 是否覆盖 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;overwrite&gt;</span>true<span class="nt">&lt;/overwrite&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;configurationFile</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&gt;</span>${project.basedir}/generatorConfig.xml<span class="nt">&lt;/configurationFile&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&lt;version&gt;</span>8.0.19<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>org.mybatis.generator<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>mybatis-generator-core<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/plugin&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>设置插件配置文件 <code>generatorConfig.xml</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE generatorConfiguration PUBLIC
</span></span></span><span class="line"><span class="cl"><span class="cp">  &#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp">  &#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&#34;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;generatorConfiguration&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;context</span> <span class="na">id=</span><span class="s">&#34;testTables&#34;</span> <span class="na">targetRuntime=</span><span class="s">&#34;MyBatis3&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;commentGenerator&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suppressAllComments&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/commentGenerator&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--数据库连接的信息：驱动类、连接地址、用户名、密码 --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jdbcConnection</span>
</span></span><span class="line"><span class="cl">      <span class="na">driverClass=</span><span class="s">&#34;com.mysql.cj.jdbc.Driver&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">connectionURL=</span><span class="s">&#34;jdbc:mysql://localhost:3306/learn_mybatis?characterEncoding=utf-8&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">userId=</span><span class="s">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">password=</span><span class="s">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jdbcConnection&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- 默认false，把JDBC DECIMAL 和 NUMERIC 类型解析为 Integer，为 true时把JDBC DECIMAL 和
</span></span></span><span class="line"><span class="cl"><span class="c">           NUMERIC 类型解析为java.math.BigDecimal --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;javaTypeResolver&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;forceBigDecimals&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/javaTypeResolver&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- targetProject:生成POJO类的位置 --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;javaModelGenerator</span>
</span></span><span class="line"><span class="cl">      <span class="na">targetPackage=</span><span class="s">&#34;com.orionpax.learn.entity&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">targetProject=</span><span class="s">&#34;src/main/java&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;enableSubPackages&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- 从数据库返回的值被清理前后的空格 --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;trimStrings&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/javaModelGenerator&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- targetProject:mapper映射文件生成的位置
</span></span></span><span class="line"><span class="cl"><span class="c">           如果maven工程只是单独的一个工程，targetProject=&#34;src/main/java&#34;
</span></span></span><span class="line"><span class="cl"><span class="c">           若果maven工程是分模块的工程，targetProject=&#34;所属模块的名称&#34;，例如：
</span></span></span><span class="line"><span class="cl"><span class="c">           targetProject=&#34;ecps-manager-mapper&#34;，下同--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;sqlMapGenerator</span>
</span></span><span class="line"><span class="cl">      <span class="na">targetPackage=</span><span class="s">&#34;com.orionpax.learn.mapper&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">targetProject=</span><span class="s">&#34;src/main/java&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;enableSubPackages&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/sqlMapGenerator&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- targetPackage：mapper接口生成的位置 --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;javaClientGenerator</span>
</span></span><span class="line"><span class="cl">      <span class="na">type=</span><span class="s">&#34;XMLMAPPER&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">targetPackage=</span><span class="s">&#34;com.orionpax.learn.mapper&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">targetProject=</span><span class="s">&#34;src/main/java&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;enableSubPackages&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/javaClientGenerator&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- 指定数据库表  多个表示,可用多个table标签--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;table</span>
</span></span><span class="line"><span class="cl">      <span class="na">tableName=</span><span class="s">&#34;far&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">enableSelectByExample=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/table&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;table</span>
</span></span><span class="line"><span class="cl">      <span class="na">tableName=</span><span class="s">&#34;bar&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">enableSelectByExample=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/table&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/context&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/generatorConfiguration&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>运行插件</li>
</ol>
<h3 id="如何用-mybatis-实现一对多分页" class="headerLink">
    <a href="#%e5%a6%82%e4%bd%95%e7%94%a8-mybatis-%e5%ae%9e%e7%8e%b0%e4%b8%80%e5%af%b9%e5%a4%9a%e5%88%86%e9%a1%b5" class="header-mark"></a>如何用 MyBatis 实现一对多分页</h3><p>一对多的数据分页是非常常见的需求，但是很多人会在这里遇到分页的误区，得到不正确的结果。今天就来分析并解决这个问题。</p>
<p><figure><a class="lightgallery" href="https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/%e6%95%b0%e6%8d%ae%e5%ba%93%e5%85%b3%e7%b3%bb%e5%9b%be.2ib2rgt17vs.webp" title="数据库关系图" data-thumbnail="https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/数据库关系图.2ib2rgt17vs.webp" data-sub-html="<h2>数据库关系图</h2><p>数据库关系图</p>">
        <img
            
            loading="lazy"
            src="https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/%e6%95%b0%e6%8d%ae%e5%ba%93%e5%85%b3%e7%b3%bb%e5%9b%be.2ib2rgt17vs.webp"
            srcset="https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/%e6%95%b0%e6%8d%ae%e5%ba%93%e5%85%b3%e7%b3%bb%e5%9b%be.2ib2rgt17vs.webp, https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/%e6%95%b0%e6%8d%ae%e5%ba%93%e5%85%b3%e7%b3%bb%e5%9b%be.2ib2rgt17vs.webp 1.5x, https://jsd.cdn.zzko.cn/gh/orionpax1997/picx-images-hosting@master/Development/%e6%95%b0%e6%8d%ae%e5%ba%93%e5%85%b3%e7%b3%bb%e5%9b%be.2ib2rgt17vs.webp 2x"
            alt="数据库关系图">
    </a><figcaption class="image-caption">数据库关系图</figcaption>
    </figure></p>
<ul>
<li>
<p>错误的写法，使用各种框架的分页拦截器会碰到类似问题。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;BaseResultMap&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Foo&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&#34;ID&#34;</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;NAME&#34;</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;CREATE_TIME&#34;</span> <span class="na">property=</span><span class="s">&#34;createTime&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;DEL_STATUS&#34;</span> <span class="na">property=</span><span class="s">&#34;delStatus&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;FooResultMap1&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Foo&#34;</span> <span class="na">extends=</span><span class="s">&#34;BaseResultMap&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&#34;barList&#34;</span> <span class="na">javaType=</span><span class="s">&#34;java.util.List&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;BarResultMap1&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;BarResultMap1&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Bar&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&#34;B_ID&#34;</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;B_FOO_ID&#34;</span> <span class="na">property=</span><span class="s">&#34;fooId&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;B_NAME&#34;</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;B_CREATE_TIME&#34;</span> <span class="na">property=</span><span class="s">&#34;createTime&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;B_DEL_STATUS&#34;</span> <span class="na">property=</span><span class="s">&#34;delStatus&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;listByMybatisOneToManyAndPage1&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;FooResultMap1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    SELECT TF.ID, TF.NAME, TF.CREATE_TIME, TF.DEL_STATUS,
</span></span><span class="line"><span class="cl">           TB.ID B_ID, TB.FOO_ID B_FOO_ID, TB.NAME B_NAME, TB.CREATE_TIME B_CREATE_TIME, TB.DEL_STATUS B_DEL_STATUS
</span></span><span class="line"><span class="cl">    FROM T_FOO TF
</span></span><span class="line"><span class="cl">    LEFT JOIN T_BAR TB ON TF.ID = TB.FOO_ID
</span></span><span class="line"><span class="cl">    LIMIT #{current}, #{size}
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/select&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>(推荐)先分页后关联的方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;BaseResultMap&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Foo&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&#34;ID&#34;</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;NAME&#34;</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;CREATE_TIME&#34;</span> <span class="na">property=</span><span class="s">&#34;createTime&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;DEL_STATUS&#34;</span> <span class="na">property=</span><span class="s">&#34;delStatus&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;FooResultMap1&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Foo&#34;</span> <span class="na">extends=</span><span class="s">&#34;BaseResultMap&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&#34;barList&#34;</span> <span class="na">javaType=</span><span class="s">&#34;java.util.List&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;BarResultMap1&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;BarResultMap1&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Bar&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&#34;B_ID&#34;</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;B_FOO_ID&#34;</span> <span class="na">property=</span><span class="s">&#34;fooId&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;B_NAME&#34;</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;B_CREATE_TIME&#34;</span> <span class="na">property=</span><span class="s">&#34;createTime&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;B_DEL_STATUS&#34;</span> <span class="na">property=</span><span class="s">&#34;delStatus&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;listByMybatisOneToManyAndPage2&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;FooResultMap1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    SELECT TF.ID, TF.NAME, TF.CREATE_TIME, TF.DEL_STATUS,
</span></span><span class="line"><span class="cl">           TB.ID B_ID, TB.FOO_ID B_FOO_ID, TB.NAME B_NAME, TB.CREATE_TIME B_CREATE_TIME, TB.DEL_STATUS B_DEL_STATUS
</span></span><span class="line"><span class="cl">    FROM (SELECT ID, NAME, CREATE_TIME, DEL_STATUS FROM T_FOO LIMIT #{current}, #{size}) TF
</span></span><span class="line"><span class="cl">    LEFT JOIN T_BAR TB ON TF.ID = TB.FOO_ID
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/select&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>MyBatis 关联 select 方式，会执行 1 + N 条 SQL</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;BaseResultMap&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Foo&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&#34;ID&#34;</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;NAME&#34;</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;CREATE_TIME&#34;</span> <span class="na">property=</span><span class="s">&#34;createTime&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;DEL_STATUS&#34;</span> <span class="na">property=</span><span class="s">&#34;delStatus&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;BarResultMap2&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Bar&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&#34;ID&#34;</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;FOO_ID&#34;</span> <span class="na">property=</span><span class="s">&#34;fooId&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;NAME&#34;</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;CREATE_TIME&#34;</span> <span class="na">property=</span><span class="s">&#34;createTime&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;DEL_STATUS&#34;</span> <span class="na">property=</span><span class="s">&#34;delStatus&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;listBarByFooId&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;BarResultMap2&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    SELECT ID, FOO_ID, NAME, CREATE_TIME, DEL_STATUS FROM T_BAR WHERE FOO_ID = #{fooId}
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/select&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;FooResultMap2&#34;</span> <span class="na">type=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Foo&#34;</span> <span class="na">extends=</span><span class="s">&#34;BaseResultMap&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&#34;barList&#34;</span> <span class="na">ofType=</span><span class="s">&#34;top.orionpax.learnspringboot.test.entity.Bar&#34;</span> <span class="na">select=</span><span class="s">&#34;listBarByFooId&#34;</span> <span class="na">column=</span><span class="s">&#34;ID&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;listByMybatisOneToManyAndPage3&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;FooResultMap2&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    SELECT ID, NAME, CREATE_TIME, DEL_STATUS FROM T_FOO
</span></span><span class="line"><span class="cl">    LIMIT #{current}, #{size}
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/select&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2024-04-06&nbsp;<a class="git-hash" href="https://github.com/Humble-Xiang/hugo-blog/commit/c35233da6a399af77c2401e6978337d21f10d657" target="_blank" title="commit by OrionPax(orionpax.1997@outlook.com) c35233da6a399af77c2401e6978337d21f10d657: update" rel="noopener noreferrer">
                                    <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M440.667 182.109l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l14.623-81.891C377.123 38.754 371.468 32 363.997 32h-40.632a12 12 0 0 0-11.813 9.891L296.175 128H197.54l14.623-81.891C213.477 38.754 207.822 32 200.35 32h-40.632a12 12 0 0 0-11.813 9.891L132.528 128H53.432a12 12 0 0 0-11.813 9.891l-7.143 40C33.163 185.246 38.818 192 46.289 192h74.81L98.242 320H19.146a12 12 0 0 0-11.813 9.891l-7.143 40C-1.123 377.246 4.532 384 12.003 384h74.81L72.19 465.891C70.877 473.246 76.532 480 84.003 480h40.632a12 12 0 0 0 11.813-9.891L151.826 384h98.634l-14.623 81.891C234.523 473.246 240.178 480 247.65 480h40.632a12 12 0 0 0 11.813-9.891L315.472 384h79.096a12 12 0 0 0 11.813-9.891l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l22.857-128h79.096a12 12 0 0 0 11.813-9.891zM261.889 320h-98.634l22.857-128h98.634l-22.857 128z"/></svg>c35233d</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line print:!tw-hidden">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/mybatis/index.md target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                    </span><span>|&nbsp;<a class="link-to-source" href=https://github.com/Humble-Xiang/hugo-blog/blob/main/content/posts/mybatis.md target="_blank" rel="noopener noreferrer">查看源代码</a>
                    </span><span>|&nbsp;<a class="link-to-edit" href=https://github.com/Humble-Xiang/hugo-blog/edit/main/content/posts/mybatis.md target="_blank" rel="noopener noreferrer">编辑此页</a>
                    </span><span>|&nbsp;<a class="link-to-report" href=https://github.com/Humble-Xiang/hugo-blog/issues/new?title=[bug]%20Mybatis+%E7%9A%84%E4%BD%BF%E7%94%A8&body=|Field|Value|%0A|-|-|%0A|Title|Mybatis+%E7%9A%84%E4%BD%BF%E7%94%A8|%0A|Url|http://localhost:1313/mybatis/|%0A|Filename|https://github.com/Humble-Xiang/hugo-blog/blob/main/content/posts/mybatis.md| target="_blank" rel="noopener noreferrer">报告问题</a>
                    </span></div>
            <div class="post-info-share"></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg>&nbsp;<a href="/tags/backend-framework/">Backend Framework</a></section>
        <section class="print:!tw-hidden">
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav print:tw-hidden"><a href="/flutter/" class="prev" rel="prev" title="Flutter 的使用"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"/></svg>Flutter 的使用</a>
            <a href="/spring-initializr/" class="next" rel="next" title="通过 Spring Initializr 了解常用后端框架">通过 Spring Initializr 了解常用后端框架<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.125.7">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg> DoIt</a>
                </div><div class="footer-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 448c-110.532 0-200-89.451-200-200 0-110.531 89.451-200 200-200 110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200zm107.351-101.064c-9.614 9.712-45.53 41.396-104.065 41.396-82.43 0-140.484-61.425-140.484-141.567 0-79.152 60.275-139.401 139.762-139.401 55.531 0 88.738 26.62 97.593 34.779a11.965 11.965 0 0 1 1.936 15.322l-18.155 28.113c-3.841 5.95-11.966 7.282-17.499 2.921-8.595-6.776-31.814-22.538-61.708-22.538-48.303 0-77.916 35.33-77.916 80.082 0 41.589 26.888 83.692 78.277 83.692 32.657 0 56.843-19.039 65.726-27.225 5.27-4.857 13.596-4.039 17.82 1.738l19.865 27.17a11.947 11.947 0 0 1-1.152 15.518z"/></svg>2019 - 2024<span class="author">&nbsp;<a href="https://github.com/Humble-Xiang" target="_blank" rel="noopener noreferrer">Humble.Xiang</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons" class="print:!tw-hidden"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"/></svg>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":15},"comment":{},"data":{"desktop-header-typeit":"Humble.X","mobile-header-typeit":"Humble.X"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":true,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":50,"threshold":0.1,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"table":{"sort":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script
    src="/lib/tablesort/tablesort.min.js"
    
  ></script><script
    src="/lib/lightgallery/lightgallery.min.js"
    
  ></script><script
    src="/lib/lightgallery/lg-thumbnail.min.js"
    
  ></script><script
    src="/lib/lightgallery/lg-zoom.min.js"
    
  ></script><script
    src="/lib/clipboard/clipboard.min.js"
    
  ></script><script
    src="/lib/sharer/sharer.min.js"
    
  ></script><script
    src="/lib/typeit/typeit.min.js"
    
  ></script><script
    src="https://website-card-embed.dramacat.top/website-card-embed-loveit.js"
    
  ></script><script
    src="/js/theme.min.js"
    
      defer
    
  ></script></div>
</body>

</html>
